<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Mod_cluster doc</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.72.0"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e1"/>Mod_cluster doc</h1></div></div><hr/></div><div class="toc"><dl><dt><span class="chapter"><a href="#Intro">1. Overview</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e12">1.1. Platforms</a></span></dt><dt><span class="sect1"><a href="#d0e33">1.2. Advantages</a></span></dt><dt><span class="sect1"><a href="#d0e65">1.3. Requirements</a></span></dt><dt><span class="sect1"><a href="#d0e77">1.4. 
      Downloads</a></span></dt><dt><span class="sect1"><a href="#d0e125">1.5. Quick Start</a></span></dt><dt><span class="sect1"><a href="#d0e133">1.6. Configuration</a></span></dt><dt><span class="sect1"><a href="#d0e155">1.7. Migration</a></span></dt><dt><span class="sect1"><a href="#d0e173">1.8. SSL support</a></span></dt><dt><span class="sect1"><a href="#d0e187">1.9. Load Balancing Demo Application</a></span></dt><dt><span class="sect1"><a href="#d0e195">1.10. Strong cryptography warning</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Quick_Start_Guide">2. Quick Start Guide</a></span></dt><dt><span class="chapter"><a href="#nativeconfig">3. native configuration</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e418">3.1. Apache httpd configuration</a></span></dt><dt><span class="sect1"><a href="#d0e435">3.2. mod_proxy configuration</a></span></dt><dt><span class="sect1"><a href="#d0e440">3.3. mod_slotmem configuration</a></span></dt><dt><span class="sect1"><a href="#d0e445">3.4. mod_proxy_cluster</a></span></dt><dt><span class="sect1"><a href="#d0e505">3.5. mod_manager</a></span></dt><dt><span class="sect1"><a href="#mod_advertise">3.6. mod_advertise</a></span></dt><dt><span class="sect1"><a href="#d0e575">3.7. Minimal Example</a></span></dt></dl></dd><dt><span class="chapter"><a href="#building">4. Building mod_cluster from sources</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e584">4.1. Build a patched httpd from it sources</a></span></dt><dt><span class="sect1"><a href="#d0e604">4.2. Build the 4 modules of mod_cluster</a></span></dt><dt><span class="sect1"><a href="#d0e630">4.3. Build the mod_proxy module</a></span></dt></dl></dd><dt><span class="chapter"><a href="#nativeinstall">5. Installation of the httpd part</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e648">5.1. Configuration</a></span></dt><dt><span class="sect1"><a href="#d0e659">5.2. Installing and using the bundles</a></span></dt></dl></dd><dt><span class="chapter"><a href="#javaconf">6. java configuration</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e681">6.1. JBoss AS</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e689">6.1.1. Lifecycle listener</a></span></dt><dt><span class="sect2"><a href="#d0e715">6.1.2. Connectors</a></span></dt><dt><span class="sect2"><a href="#d0e734">6.1.3. Node Identity</a></span></dt><dt><span class="sect2"><a href="#local">6.1.4. Non-Clustered Mode</a></span></dt><dt><span class="sect2"><a href="#HAModClusterService">6.1.5. Clustered Mode</a></span></dt></dl></dd><dt><span class="sect1"><a href="#tomcat">6.2. JBoss Web &amp; Tomcat</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e830">6.2.1. Lifecycle Listener</a></span></dt><dt><span class="sect2"><a href="#d0e841">6.2.2. Additional Tomcat dependencies</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#javabuilding">7. Building mod_cluster's Java components from source</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e871">7.1. Build products</a></span></dt></dl></dd><dt><span class="chapter"><a href="#javaproperties">8. java properties</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e903">8.1. Configuration Properties</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e911">8.1.1. 
      Proxy Discovery Configuration</a></span></dt><dt><span class="sect2"><a href="#d0e1136">8.1.2. 
      Proxy Configuration</a></span></dt><dt><span class="sect2"><a href="#d0e1386">8.1.3. 
      SSL Configuration</a></span></dt><dt><span class="sect2"><a href="#d0e1675">8.1.4. 
      HA Configuration</a></span></dt><dt><span class="sect2"><a href="#d0e1721">8.1.5. 
      Load Configuration</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#javaload">9. Load Metrics</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e1816">9.1. Server-Side Load Metrics</a></span></dt><dt><span class="sect1"><a href="#d0e1883">9.2. Web Container metrics</a></span></dt><dt><span class="sect1"><a href="#d0e2051">9.3. System/JVM metrics</a></span></dt><dt><span class="sect1"><a href="#d0e2121">9.4. Other metrics</a></span></dt></dl></dd><dt><span class="chapter"><a href="#javainstall">10. Installation of the java part</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e2160">10.1. Install the Java-side binaries</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2167">10.1.1. Installing in JBoss AS 6.0.0.M1 and up</a></span></dt><dt><span class="sect2"><a href="#d0e2172">10.1.2. Installing in JBoss AS 5.x</a></span></dt><dt><span class="sect2"><a href="#d0e2179">10.1.3. Installing in JBoss Web or Tomcat</a></span></dt><dt><span class="sect2"><a href="#d0e2186">10.1.4. Installing in JBoss AS 4.2.x or 4.3.x</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#mod_proxy_https">11. Using https between httpd and JBossWEB</a></span></dt><dt><span class="chapter"><a href="#UsingSSL">12. Using SSL in mod_cluster</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e2209">12.1. Using SSL between JBossWEB and httpd</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2214">12.1.1. Apache httpd configuration part</a></span></dt><dt><span class="sect2"><a href="#d0e2229">12.1.2. ClusterListener configuration part</a></span></dt><dt><span class="sect2"><a href="#d0e2243">12.1.3. mod-cluster-jboss-beans configuration part</a></span></dt><dt><span class="sect2"><a href="#d0e2253">12.1.4. How the diferent files were created</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e2328">12.2. Using SSL between httpd and JBossWEB</a></span></dt><dt><span class="sect1"><a href="#d0e2338">12.3. Forwarding SSL browser informations when using http/https between
    httpd and JBossWEB</a></span></dt></dl></dd><dt><span class="chapter"><a href="#mod_jk">13. Migration from mod_jk</a></span></dt><dt><span class="chapter"><a href="#mod_proxy">14. Migration from mod_proxy</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e2648">14.1. Workers</a></span></dt><dt><span class="sect1"><a href="#d0e2845">14.2. Balancers</a></span></dt></dl></dd><dt><span class="chapter"><a href="#demo">15. Load Balancing Demo Application</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e2916">15.1. Overview</a></span></dt><dt><span class="sect1"><a href="#d0e2940">15.2. Basic Usage</a></span></dt><dt><span class="sect1"><a href="#client-config">15.3. Client Driver Configuration Options</a></span></dt><dt><span class="sect1"><a href="#load-generation">15.4. Load Generation Scenarios</a></span></dt></dl></dd><dt><span class="chapter"><a href="#changelog">16. Change Log</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e3112">16.1. 1.0.10 (14 April 2011)</a></span></dt><dt><span class="sect1"><a href="#d0e3223">16.2. 1.0.9 (17 March 2011)</a></span></dt><dt><span class="sect1"><a href="#d0e3289">16.3. 1.0.8 (15 Feb 2011)</a></span></dt><dt><span class="sect1"><a href="#d0e3310">16.4. 1.0.7 (not released)</a></span></dt><dt><span class="sect1"><a href="#d0e3361">16.5. 1.0.6 (05 January 2011)</a></span></dt><dt><span class="sect1"><a href="#d0e3427">16.6. 1.0.5 (23 November 2010)</a></span></dt><dt><span class="sect1"><a href="#d0e3523">16.7. 1.0.4 (27 July 2010)</a></span></dt><dt><span class="sect1"><a href="#d0e3694">16.8. 1.0.3.GA (15 January 2010)</a></span></dt><dt><span class="sect1"><a href="#d0e3820">16.9. 1.0.2.GA (20 August 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e3976">16.10. 1.0.1.GA (29 July 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e4117">16.11. 1.0.0.GA (29 May 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e4183">16.12. 1.0.0.CR2 (29 April 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e4279">16.13. 1.0.0.CR1 (24 March 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e4420">16.14. 1.0.0.Beta4 (14 Feb 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e4606">16.15. 1.0.0.Beta3 (31 Jan 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e4747">16.16. 1.0.0.Beta2 (12 Dec 2008)</a></span></dt><dt><span class="sect1"><a href="#d0e4888">16.17. 1.0.0.Beta1 (05 Nov 2008)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#faq">17. Frequently Asked questions</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e4913">17.1. What is Advertise</a></span></dt><dt><span class="sect1"><a href="#d0e4950">17.2. What to do if I don't want to use Advertise (multicast):</a></span></dt><dt><span class="sect1"><a href="#d0e4962">17.3. I am using Tomcat 7 / 6 what should I do:</a></span></dt></dl></dd></dl></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Intro"/>Chapter 1. Overview</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e12">1.1. Platforms</a></span></dt><dt><span class="sect1"><a href="#d0e33">1.2. Advantages</a></span></dt><dt><span class="sect1"><a href="#d0e65">1.3. Requirements</a></span></dt><dt><span class="sect1"><a href="#d0e77">1.4. 
      Downloads</a></span></dt><dt><span class="sect1"><a href="#d0e125">1.5. Quick Start</a></span></dt><dt><span class="sect1"><a href="#d0e133">1.6. Configuration</a></span></dt><dt><span class="sect1"><a href="#d0e155">1.7. Migration</a></span></dt><dt><span class="sect1"><a href="#d0e173">1.8. SSL support</a></span></dt><dt><span class="sect1"><a href="#d0e187">1.9. Load Balancing Demo Application</a></span></dt><dt><span class="sect1"><a href="#d0e195">1.10. Strong cryptography warning</a></span></dt></dl></div><p>mod_cluster is an httpd-based load balancer. Like mod_jk and mod_proxy, mod_cluster uses a communication channel to forward requests from httpd to one of a set of application server nodes. Unlike mod_jk and mod_proxy, mod_cluster leverages an additional connection between the application server nodes and httpd. The application server nodes use this connection to transmit server-side load balance factors and lifecycle events back to httpd via a custom set of HTTP methods, affectionately called the Mod-Cluster Management Protocol (MCMP). This additional feedback channel allows mod_cluster to offer a level of intelligence and granularity not found in other load balancing solutions.</p><p>Within httpd, mod_cluster is implemented as a set of modules for httpd with mod_proxy enabled. Much of the logic comes from mod_proxy, e.g. mod_proxy_ajp provides all the AJP logic needed by mod_cluster.</p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e12"/>1.1. Platforms</h2></div></div></div><p>JBoss already prepares <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/mod_cluster/downloads.html">binary packages</a> with httpd and mod_cluster so you can quickly try mod_cluster on the following platforms:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Linux x86, x64, ia64 </p></li><li><p>Solaris x86, SPARC </p></li><li><p>Windows x86, x64, ia64 </p></li><li><p>HP-UX PA-RISC, ia64 </p></li></ol></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e33"/>1.2. Advantages</h2></div></div></div><p>mod_cluster boasts the following advantages over other httpd-based load balancers:</p><p>Dynamic configuration of httpd workers </p><p>Traditional httpd-based load balancers require explicit configuration of the workers available to a proxy. In mod_cluster, the bulk of the proxy's configuration resides on the application servers. The set of proxies to which an application server will communicate is determined either by a static list or using dynamic discovery via the <a href="#advertise">advertise</a> mechanism. The application server relays lifecycle events (e.g. server startup/shutdown) to the proxies allowing them to effectively auto-configure themselves. Notably, the graceful shutdown of a server will not result in a failover response by a proxy, as is the case with traditional httpd-based load balancers. </p><p>Server-side load balance factor calculation </p><p>In contrast with traditional httpd-based load balancers, mod_cluster uses load balance factors calculated and provided by the application servers, rather than computing these in the proxy. Consequently, mod_cluster offers a more robust and accurate set of load metrics than is available from the proxy. (see <a href="#javaload" title="Chapter 9. Load Metrics">Load Metrics</a> for more) </p><p>Fine grained web-app lifecycle control </p><p>Traditional httpd-based load balancers do not handle web application undeployments particularly well. From the proxy's perspective requests to an undeployed web application are indistinguishable from a request for an non-existent resource, and will result in 404 errors. In mod_cluster, each server forwards any web application context lifecycle events (e.g. web-app deploy/undeploy) to the proxy informing it to start/stop routing requests for a given context to that server. </p><p>AJP is optional </p><p>Unlike mod_jk, mod_cluster does not require AJP. httpd connections to application server nodes can use HTTP, HTTPS, or AJP. </p><p>The original concepts are described in a <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/community/docs/DOC-11431">wiki</a>.</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e65"/>1.3. Requirements</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>httpd-2.2.8+ </p></li><li><p>JBoss AS 5.0.0+ or JBossWeb 2.1.1+ </p></li></ol></div><p>Note: httpd-2.2.8+ is already in the bundles, so if you use the bundle you don't need to download Apache httpd.</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e77"/>1.4. 
      <a id="download"/>Downloads</h2></div></div></div><p>Download the latest mod_cluster release <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/mod_cluster/downloads/latest">here</a>.</p><p>The release is comprised of the following artifacts:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>httpd binaries for common platforms </p></li><li><p>JBoss AS/JBossWeb/Tomcat binary distribution </p></li></ol></div><p>Alternatively, you can build from source using the subversion repository:</p><p>
      <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://anonsvn.jboss.org/repos/mod_cluster/tags/">http://anonsvn.jboss.org/repos/mod_cluster/tags/</a>
      <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://anonsvn.jboss.org/repos/mod_cluster/tags/">
         <span class="emphasis"><em>release</em></span>
      </a>
      <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://anonsvn.jboss.org/repos/mod_cluster/tags/">/</a>
   </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Building <a href="#building" title="Chapter 4. Building mod_cluster from sources">httpd modules</a> 
         </p></li><li><p>Building <a href="#javabuilding" title="Chapter 7. Building mod_cluster's Java components from source">Java archives</a> 
         </p></li></ol></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e125"/>1.5. Quick Start</h2></div></div></div><p>If you want to skip the details and just set up a minimal working installation of mod_cluster, see the <a href="#Quick_Start_Guide" title="Chapter 2. Quick Start Guide">Quick Start Guide</a>.</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e133"/>1.6. Configuration</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Configuring <a href="#nativeconfig" title="Chapter 3. native configuration">httpd</a> 
         </p></li><li><p>Configuring <a href="#javaconf" title="Chapter 6. java configuration">JBoss AS/Web</a> 
         </p></li><li><p>Configuring <a href="#tomcat" title="6.2. JBoss Web &amp; Tomcat">Tomcat</a> 
         </p></li></ol></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e155"/>1.7. Migration</h2></div></div></div><p>Migrating from mod_jk or mod_proxy is fairly straight forward. In general, much of the configuration previously found in httpd.conf is now defined in the application server nodes.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Migrating from <a href="#mod_jk" title="Chapter 13. Migration from mod_jk">mod_jk</a> 
         </p></li><li><p>Migrating from <a href="#mod_proxy" title="Chapter 14. Migration from mod_proxy">mod_proxy</a> 
         </p></li></ol></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e173"/>1.8. SSL support</h2></div></div></div><p>Both the request connections between httpd and the application server nodes, and the feedback channel between the nodes and httpd can be secured. The former is achieved via the <a href="#mod_proxy_https" title="Chapter 11. Using https between httpd and JBossWEB">mod_proxy_https module</a> and a corresponding ssl-enabled HTTP connector in JBoss Web. The latter requires the <a href="#UsingSSL" title="Chapter 12. Using SSL in mod_cluster">mod_ssl module</a> and <a href="#javaconf" title="Chapter 6. java configuration">explicit configuration in JBoss AS/Web</a>.</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e187"/>1.9. Load Balancing Demo Application</h2></div></div></div><p>The mod_cluster binary distribution for JBoss AS/JBossWeb/Tomcat includes a <a href="#demo" title="Chapter 15. Load Balancing Demo Application">demo application</a> that helps demonstrate how different server-side scenarios affect the routing of client requests by the load balancer. The demo application is located in the mod_cluster distribution's demo directory.</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e195"/>1.10. Strong cryptography warning</h2></div></div></div><p>Mod_cluster contains mod_ssl, therefore the warning (copied from <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.openssl.org/">OpenSSL</a>)</p><p> </p><p>PLEASE REMEMBER THAT EXPORT/IMPORT AND/OR USE OF STRONG CRYPTOGRAPHY SOFTWARE, PROVIDING CRYPTOGRAPHY HOOKS OR EVEN JUST COMMUNICATING TECHNICAL DETAILS ABOUT CRYPTOGRAPHY SOFTWARE IS ILLEGAL IN SOME PARTS OF THE WORLD. SO, WHEN YOU IMPORT THIS PACKAGE TO YOUR COUNTRY, RE-DISTRIBUTE IT FROM THERE OR EVEN JUST EMAIL TECHNICAL SUGGESTIONS OR EVEN SOURCE PATCHES TO THE AUTHOR OR OTHER PEOPLE YOU ARE STRONGLY ADVISED TO PAY CLOSE ATTENTION TO ANY EXPORT/IMPORT AND/OR USE LAWS WHICH APPLY TO YOU. THE AUTHORS OF OPENSSL ARE NOT LIABLE FOR ANY VIOLATIONS YOU MAKE HERE. SO BE CAREFUL, IT IS YOUR RESPONSIBILITY.</p><p> </p><p/><p/></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Quick_Start_Guide"/>Chapter 2. Quick Start Guide</h2></div></div></div><p>The following are the steps to set up a minimal working installation
  of mod_cluster on a single httpd server and a single back end server, either
  JBoss AS, JBossWeb or Tomcat. The steps can be repeated to add as many httpd
  servers or back end servers to your cluster as is desired.</p><p>The steps shown here are not intended to demonstrate how to set up a
  production install of mod_cluster; for example <a href="#UsingSSL" title="Chapter 12. Using SSL in mod_cluster">
  using SSL to secure access</a> to the httpd-side mod_manager component is not covered.
  See the <a href="#nativeconfig" title="Chapter 3. native configuration">httpd-side</a> and
  <a href="#javaconf" title="Chapter 6. java configuration">java-side</a>
  configuration documentation for the full set of configuration
  options.</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e227"/>2.1. Download mod_cluster components</h3></div></div></div><p>Download the latest <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/mod_cluster/downloads/latest.html">httpd
    and java release bundles</a>. If there is no pre-built httpd bundle
    appropriate for your OS or system architecture, you can <a href="#building" title="Chapter 4. Building mod_cluster from sources">build the
    binary from source</a>.</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e238"/>2.2. Install the httpd binary</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e241"/>2.2.1. Install the whole httpd</h4></div></div></div><p>The httpd-side bundles are gzipped tars and include a full httpd
      install. As they contain already an Apache httpd install you don't need
      to download Apache httpd. Just extract them in root,
      e.g.</p><pre class="programlisting">
  cd /
  tar xvf mod-cluster-1.0.0-linux2-x86-ssl.tar.gz</pre><p>That will give you a full httpd install in your /opt/jboss
      directory.</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e250"/>2.2.2. Install only the modules</h4></div></div></div><p>If you already have a working httpd install that you would prefer
      to use, you'll need to download the bundle named mod_cluster httpd
      dynamic libraries corresponding to you plaform, extract the modules and
      copy them directory to your httpd install's module directory.</p><pre class="programlisting">
  cd /tmp
  tar xvf mod_cluster-1.0.0.CR2-linux2-x86-so.tar.gz </pre><p>And then you have to copy the files below to you module
      directory:</p><p> * mod_proxy.so</p><p> * mod_proxy_ajp.so</p><p> * mod_slotmem.so</p><p> * mod_manager.so</p><p> * mod_proxy_cluster.so</p><p> * mod_advertise.so</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e271"/>2.2.3. Install in home directory</h4></div></div></div><p>Since 1.1.0.CR2 a script opt/jboss/httpd/sbin/installhome.sh
      allows reconfiguration of the bundle installation so that it can run in
      user's home directory. To do that just extract the bundle in your home
      directory and run the script. Once that done, httpd will run on port
      8000 and will accept MCMP messages on localhost:6666 and offer
      /mod_cluster_manager on the same host and port.</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e276"/>2.2.4. Install in windows</h4></div></div></div><p>To install in windows unzip the bundle corresponding to your
      architecture. You may run httpd directly by using:</p><pre class="programlisting">
  httpd-2.2\bin\httpd.exe -k start </pre><p>or install Apache httpd as a service:</p><pre class="programlisting">
  httpd-2.2\bin\httpd.exe -k install </pre><p>and start the service:</p><pre class="programlisting">
  net start Apache2.2 </pre><p>Note that in the windows bundles have a flat directory structure,
      so you have <span class="emphasis"><em>httpd-2.2/modules/</em></span> instead of
      <span class="emphasis"><em>opt/jboss/httpd/lib/httpd/modules.</em></span></p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e298"/>2.3. Configure httpd</h3></div></div></div><p>Since 1.1.0.CR2 httpd.conf is preconfigured with the Quick Start
    values. You should adapt the default values to your configuration with
    older mod_cluster we will have to add the following to httpd.conf. If you
    extracted the download bundle to root as shown above and are using that
    extract as your httpd install, httpd.conf is located in
    /opt/jboss/httpd/httpd/conf.</p><pre class="programlisting"> LoadModule proxy_module /opt/jboss/httpd/lib/httpd/modules/mod_proxy.so
 LoadModule proxy_ajp_module /opt/jboss/httpd/lib/httpd/modules/mod_proxy_ajp.so
 LoadModule slotmem_module /opt/jboss/httpd/lib/httpd/modules/mod_slotmem.so
 LoadModule manager_module /opt/jboss/httpd/lib/httpd/modules/mod_manager.so
 LoadModule proxy_cluster_module /opt/jboss/httpd/lib/httpd/modules/mod_proxy_cluster.so
 LoadModule advertise_module /opt/jboss/httpd/lib/httpd/modules/mod_advertise.so
 
 Listen 10.33.144.3:6666
 &lt;VirtualHost 10.33.144.3:6666&gt;
 
   &lt;Directory /&gt;
      Order deny,allow
      Deny from all
      Allow from 10.33.144.
   &lt;/Directory&gt;
 
 KeepAliveTimeout 60
 MaxKeepAliveRequests 0
 
 ManagerBalancerName mycluster
 AdvertiseFrequency 5
 
 &lt;/VirtualHost&gt;</pre><p>If you are using your own install of httpd, httpd.conf is found in
    your install's conf directory. The content to add to httpd.conf is
    slightly different from the above (different path to the various .so
    files):</p><pre class="programlisting"> LoadModule proxy_module modules/mod_proxy.so
 LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
 LoadModule slotmem_module modules/mod_slotmem.so
 LoadModule manager_module modules/mod_manager.so
 LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
 LoadModule advertise_module modules/mod_advertise.so
 
 Listen 10.33.144.3:6666
 &lt;VirtualHost 10.33.144.3:6666&gt;
 
   &lt;Directory /&gt;
      Order deny,allow
      Deny from all
      Allow from 10.33.144.
   &lt;/Directory&gt;
 
 KeepAliveTimeout 60
 MaxKeepAliveRequests 0
 
 ManagerBalancerName mycluster
 AdvertiseFrequency 5
 
 &lt;/VirtualHost&gt;</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e309"/>2.4. Install the Java-side binaries</h3></div></div></div><p>First, extract the java-side binary to a temporary directory. The
    following assumes it was extracted to /tmp/mod-cluster</p><p>Your next step depends on whether your target server is JBoss AS or
    JBossWeb/Tomcat.</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e316"/>2.4.1. Installing in JBoss AS 6.0.0.M1 and up</h4></div></div></div><p>You don't need to do anything to install the java-side binaries in
      AS 6.x; it's part of the AS distribution's default, standard and all
      configurations.</p></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e321"/>2.4.2. Installing in JBoss AS 5.x</h4></div></div></div><p>Assuming $JBOSS_HOME indicates the root of your JBoss AS install
      and that you want to use mod_cluster in the AS's all config:</p><pre class="programlisting">
  cp -r /tmp/mod-cluster/mod-cluster.sar $JBOSS_HOME/server/all/deploy
</pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e328"/>2.4.3. Installing in JBoss Web or Tomcat</h4></div></div></div><p>Assuming $CATALINA_HOME indicates the root of your JBossWeb or
      Tomcat install:</p><pre class="programlisting">cp -r /tmp/mod-cluster/JBossWeb-Tomcat/lib/*
      $CATALINA_HOME/lib/ </pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e335"/>2.4.4. Installing in JBoss AS 4.2.x or 4.3.x</h4></div></div></div><p>Assuming $JBOSS_HOME indicates the root of your JBoss AS install
      and that you want to use mod_cluster in the AS's all config:</p><pre class="programlisting">
      cp -r /tmp/mod-cluster/JBossWeb-Tomcat/lib/mod-cluster.jar $JBOSS_HOME/server/all/deploy/jboss-web.deployer </pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e342"/>2.5. Configuring JBoss AS, JBoss Web or Tomcat</h3></div></div></div><p>mod_cluster is integrated into your web server by adding an
    implementation of the Tomcat LifecycleListener interface to the server's
    configuration, and by giving each node a unique name.</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e347"/>2.5.1. Integrate mod_cluster with JBoss AS's embedded JBossWeb</h4></div></div></div><span class="ERROR">&lt;listitem&gt;<p>Edit the $JBOSS_HOME/server/all/deploy/jbossweb.sar/server.xml
        file, adding the following next to the other Listener elements:</p>&lt;/listitem&gt;</span><pre class="programlisting">
      &lt;Listener
      className="org.jboss.web.tomcat.service.deployers.MicrocontainerIntegrationLifecycleListener"
                 delegateBeanName="ModClusterService"/&gt; </pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e355"/>2.5.2. Integrate mod_cluster with standalone JBossWeb or Tomcat</h4></div></div></div><p>Edit the $CATALINA_HOME/conf/server.xml file, adding the following
      next to the other Listener elements:</p><pre class="programlisting">
      &lt;Listener
      className="org.jboss.modcluster.ModClusterListener"
                 advertise="true"/&gt; </pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e362"/>2.5.3. Integrate mod_cluster with JBoss AS 4.2.x and 4.3.x</h4></div></div></div><p>Edit the
      $JBOSS_HOME/server/all/deploy/jboss-web.deployer/server.xml file, adding
      the following next to the other Listener elements:</p><pre class="programlisting">
      &lt;Listener
      className="org.jboss.modcluster.ModClusterListener"
                 advertise="true"/&gt; </pre><p/></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e370"/>2.5.4. Configure a jvmRoute</h4></div></div></div><p>Each back end server in your cluster needs to have a unique name,
      known as a "jvmRoute". This is configured by adding an attribute to the
      Engine element in server.xml.</p><pre class="programlisting">
      &lt;Engine name="jboss.web" defaultHost="localhost"
      jvmRoute="node01"&gt; </pre><p>If your cluster includes multiple back-end servers, you must
      assign a different jvmRoute to each server.</p><p>Beginning with the 1.1.0.BETA1 release, configuring a jvmRoute is
      no longer absolutely required; if one isn't provided mod_cluster will
      generate one from the address and port of the Connector used for
      receiving requests, plus the name of the Tomcat Engine. Still,
      configuring a jvmRoute is recommended, since the jvmRoute is appended to
      all session ids. The generated jvmRoute is lengthy and includes
      information you may not want to expose to the internet via session
      ids.</p></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e381"/>2.6. Start httpd</h3></div></div></div><p>To start httpd do the following:</p><pre class="programlisting">
    /opt/jboss/httpd/sbin/apachectl start </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e388"/>2.7. Start the back end server</h3></div></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e391"/>2.7.1. Starting JBoss AS</h4></div></div></div><pre class="programlisting">
      cd $JBOSS_HOME/bin ./run.sh -c all </pre></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e396"/>2.7.2. Starting JBossWeb or Tomcat</h4></div></div></div><pre class="programlisting">
      cd $CATALINA_HOME ./startup.sh </pre></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e401"/>2.8. Set up more back end servers</h3></div></div></div><p>Repeat the back end server install and configuration steps; just be
    sure to use a different jvmRoute for each server.</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e406"/>2.9. Experiment with the Load Balancing Demo Application</h3></div></div></div><p>The <a href="#demo" title="Chapter 15. Load Balancing Demo Application">load
    balancing demo application</a> is a good way to learn about
    mod_cluster's capabilities.</p><p/></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="nativeconfig"/>Chapter 3. native configuration</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e418">3.1. Apache httpd configuration</a></span></dt><dt><span class="sect1"><a href="#d0e435">3.2. mod_proxy configuration</a></span></dt><dt><span class="sect1"><a href="#d0e440">3.3. mod_slotmem configuration</a></span></dt><dt><span class="sect1"><a href="#d0e445">3.4. mod_proxy_cluster</a></span></dt><dt><span class="sect1"><a href="#d0e505">3.5. mod_manager</a></span></dt><dt><span class="sect1"><a href="#mod_advertise">3.6. mod_advertise</a></span></dt><dt><span class="sect1"><a href="#d0e575">3.7. Minimal Example</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e418"/>3.1. Apache httpd configuration</h2></div></div></div><p>You need to load the modules that are needed for mod_cluster for
    example:</p><pre class="programlisting">LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
LoadModule slotmem_module modules/mod_slotmem.so
LoadModule manager_module modules/mod_manager.so
LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
LoadModule advertise_module modules/mod_advertise.so</pre><p>mod_proxy and mod_proxy_ajp are standard httpd modules. mod_slotmem
    is a shared slotmem memory provider. mod_manager is the module that reads
    information from JBoss AS/JBossWeb/Tomcat and updates the shared memory
    information. mod_proxy_cluster is the module that contains the balancer
    for mod_proxy. mod_advertise is an additional module that allows httpd to
    advertise via multicast packets the IP and port where the mod_cluster is
    listening. This multi-module architecture allows the modules to easily be
    changed depending on what the customer wants to do. For example when using
    http instead of AJP, only</p><pre class="programlisting">LoadModule proxy_ajp_module modules/mod_proxy_ajp.so</pre><p>needs to be changed to:</p><pre class="programlisting">LoadModule proxy_http_module modules/mod_proxy_http.so</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e435"/>3.2. mod_proxy configuration</h2></div></div></div><p>mod_proxy directives like ProxyIOBufferSize could be used to
    configure mod_cluster. There is no need to use ProxyPass directives
    because mod_cluster automatically configures which URLs have to be
    forwarded to JBossWEB.</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e440"/>3.3. mod_slotmem configuration</h2></div></div></div><p>The actual version doesn't require any configuration
    directives.</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e445"/>3.4. mod_proxy_cluster</h2></div></div></div><p>CreateBalancers: Define how the balancer are created in the httpd
    VirtualHosts, this is to allow directives like:</p><pre class="programlisting">ProxyPass / balancer://mycluster1/</pre><p>0: Create in all VirtualHosts defined in httpd.</p><p>1: Don't create balancers (requires at least one
    ProxyPass/ProxyPassMatch to define the balancer names).</p><p>2: Create only the main server.</p><p>Default: 2</p><p><span class="emphasis"><em>Note:</em></span> When using 1 don't forget to configure
    the balancer in the ProxyPass directive, because the default is empty
    stickysession and nofailover=Off and the values received via the MCMP
    CONFIG message are ignored.</p><p> </p><p>UseAlias: Check that the Alias corresponds to the ServerName (See
    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://labs.jboss.com/file-access/default/members/jbossweb/freezone/docs/latest/config/host.html">Host
    Name Aliases</a>)</p><p>0: Don't (ignore Aliases)</p><p>1: Check it</p><p>Default: 0 Ignore the Alias information from the nodes.</p><p>LBstatusRecalTime:</p><p>Time interval in seconds for loadbalancing logic to recalculate the
    status of a node: (Default: 5 seconds)</p><p>The actual formula to recalculate the status of a node is:</p><pre class="programlisting">status = lbstatus + (elected - oldelected) * 1000)/lbfactor;</pre><p>lbfactor is received for the node via STATUS messages.lbstatus is
    recalculated every LBstatusRecalTime seconds using the formula:</p><pre class="programlisting">lbstatus = (elected - oldelected) * 1000)/lbfactor;</pre><p>elected is the number of time the worker was elected.oldelected is
    elected last time the lbstatus was recalculated.The node with the lowest
    status is selected. Nodes with lbfactor ≤ 0 are skipped by the both
    calculation logic.</p><p> </p><p>ProxyPassMatch/ProxyPass: ProxyPassMatch and ProxyPass are mod_proxy
    directives that when using ! (instead the back-end url) prevent to
    reverse-proxy in the path.
    This could be used allow httpd to serve static
    information like images.</p><pre class="programlisting">ProxyPassMatch ^(/.*\.gif)$ !  </pre><p>The above for example will allow httpd to server directly the .gif
    files.</p><p> </p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e505"/>3.5. mod_manager</h2></div></div></div><p>The Context of a mod_manger directive is VirtualHost except mentioned otherwise.
          <code class="code">server config</code> means that it must be outside a VirtualHost configuration.
          If not an error message will be displayed and httpd won't start.
   </p><p>MemManagerFile: That is the base name for the names mod_manager will
    use to store configuration, generate keys for shared memory or lock files.
    That must be an absolute path name; the directories will created if
    needed. It is highly recommended that those files are placed on a local
    drive and not an NFS share. (Context: server config) Default: $server_root/logs/</p><p>Maxcontext: That is the number max of contexts supported by
    mod_cluster. (Context: server config) Default: 100</p><p>Maxnode: That is the number max nodes supported by mod_cluster.
          (Context: server config)
    Default: 20</p><p>Maxhost: That is the number max host (Aliases) supported by
    mod_cluster. That is also the max number of balancers. (Context: server config) Default: 10</p><p>Maxsessionid: That is the number of active sessionid we store to
    give number of active sessions in the mod_cluster-manager handler. A
    session is unactive when mod_cluster doesn't receive any information from
    the session in 5 minutes. (Context: server config) Default: 0 (the logic is not activated).</p><p>ManagerBalancerName: That is the name of balancer to use when the
    JBoss AS/JBossWeb/Tomcat doesn't provide a balancer name. That is not
    supported in the current version. (Default value is used). Default:
    mycluster</p><p>PersistSlots: Tell mod_slotmem to persist the nodes, Alias and
    Context in files. (Context: server config) Default: Off</p><p>CheckNonce: Switch check of nonce when using mod_cluster-manager
    handler on | off (Default: on Nonce checked) Since 1.1.0.CR1</p><p>SetHandler mod_cluster-manager: That is the handler to display the
    node mod_cluster sees from the cluster. It displays the information about
    the nodes like INFO and additionaly counts the number of active
    sessions.</p><pre class="programlisting">&lt;Location /mod_cluster-manager&gt;
SetHandler mod_cluster-manager
Order deny,allow
Deny from all
Allow from 127.0.0.1
&lt;/Location&gt;</pre><p>When accessing the location you define in httpd.conf you get
    something like: </p><div class="mediaobject" align="center"><img src="images/mod_status.jpg" align="middle"/></div><p> </p><p>Note that:</p><p>Transferred: Corresponds to the POST data send to the back-end
    server.</p><p>Connected: Corresponds to the number of requests been processed when
    the mod_cluster status page was requested.</p><p>sessions: Corresponds to the number of sessions mod_cluster report
    as active (on which there was a request during the past 5 minutes). That
    field is not present when Maxsessionid is zero.</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mod_advertise"/>3.6. mod_advertise</h2></div></div></div><p>mod_advertise uses multicast packets to advertise the VirtualHost
    where it is configured that must be the same VirtualHost where mod_manager
    is defined. Of course at least one mod_advertise must be in the
    VirtualHost to allow mod_cluster to find the right IP and port to give to
    the ClusterListener.</p><p>ServerAdvertise On: Use the advertise mechanism to tell the JBoss
    AS/JBossWeb/Tomcat to whom it should send the cluster
    information.</p><p>ServerAdvertise On http://hostname:port: Tell the hostname and
    port to use. Only needed if the VirtualHost is not defined correctly, if
    the VirtualHost is a <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://httpd.apache.org/docs/2.2/vhosts/name-based.html">Name-based
    Virtual Host</a> or when VirtualHost is not used.</p><p>ServerAdvertise Off: Don't use the advertise mechanism.</p><p>Default: Off. (Any Advertise directive in a VirtualHost sets it to On in the VirtualHost)</p><p>AdvertiseGroup IP:port: That is the multicast address to use
    (something like 232.0.0.2:8888 for example). IP should correspond to
    AdvertiseGroupAddress and port to AdvertisePort in the JBoss
    AS/JBossWeb/Tomcat configuration. Note that if JBoss AS is used and the -u
    startup switch is included in the AS startup command, the default
    AdvertiseGroupAddress is the value passed via the -u. Default:
    224.0.1.105:23364. If port is missing the default port will be used:
    23364.</p><p>AdvertiseFrequency seconds[.miliseconds]: Time between the multicast
    messages advertising the IP and port. Default: 10 Ten seconds.</p><p>AdvertiseSecurityKey value: key string to identify the mod_cluster
    in JBossWEB. Default: No default value. Information not sent.</p><p>AdvertiseManagerUrl value: Not used in this version (It is sent in
    the X-Manager-Url: value header). That is the URL that JBoss
    AS/JBossWeb/Tomcat should use to send information to mod_cluster. Default:
    No default value. Information not sent.</p><p>AdvertiseBindAddress IP:port: That is the address and port httpd is
    bind to send the multicast messages. This allow to specify an address on
    multi IP address boxes. Default: 0.0.0.0:23364</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e575"/>3.7. Minimal Example</h2></div></div></div><pre class="programlisting">LoadModule proxy_module modules/mod_proxy.so
 LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
 LoadModule slotmem_module modules/mod_slotmem.so
 LoadModule manager_module modules/mod_manager.so
 LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
 LoadModule advertise_module modules/mod_advertise.so
 
 Listen 10.33.144.3:6666
 &lt;VirtualHost 10.33.144.3:6666&gt;
 
   &lt;Location /&gt;
      Order deny,allow
      Deny from all
      Allow from 10.33.144.
   &lt;/Location&gt;
 
 KeepAliveTimeout 60
 MaxKeepAliveRequests 0
 
 ManagerBalancerName mycluster
 ServerAdvertise on
 
 &lt;/VirtualHost&gt;</pre></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="building"/>Chapter 4. Building mod_cluster from sources</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e584">4.1. Build a patched httpd from it sources</a></span></dt><dt><span class="sect1"><a href="#d0e604">4.2. Build the 4 modules of mod_cluster</a></span></dt><dt><span class="sect1"><a href="#d0e630">4.3. Build the mod_proxy module</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e584"/>4.1. Build a patched httpd from it sources</h2></div></div></div><p>To build httpd-2.2.x from its sources see <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://httpd.apache.org/docs/2.2/install.html">ASF httpd
    doc</a></p><p>If needed, patch the httpd-2.2.x sources with (The patch prevents
    long waiting time when the node IP can't be resolved that should not
    happen so you can skip the patch part if you don't want to rebuild httpd).
    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://anonsvn.jboss.org/repos/mod_cluster/trunk/native/mod_proxy_cluster/mod_proxy_ajp.patch">mod_proxy_ajp.patch</a></p><pre class="programlisting">(cd modules/proxy
  patch -p0 &lt; $location/mod_proxy_ajp.patch
 )</pre><p>Configure httpd with something like:</p><pre class="programlisting">./configure  --prefix=apache_installation_directory \
             --with-mpm=worker \
             --enable-mods-shared=most \
             --enable-maintainer-mode \
             --with-expat=builtin \
             --enable-ssl \
             --enable-proxy \
             --enable-proxy-http \
             --enable-proxy-ajp \
             --disable-proxy-balancer</pre><p>Rebuild (make) and reinstall (make install) after that.</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e604"/>4.2. Build the 4 modules of mod_cluster</h2></div></div></div><p>You need an httpd installation with mod_proxy (--enable-proxy) and
    ajp protocol (--enable-proxy-ajp) enabled and with dso enabled
    (--enable-so)</p><p>Download the mod_cluster sources:</p><pre class="programlisting">svn co http://anonsvn.jboss.org/repos/mod_cluster/trunk/ mod_cluster</pre><p>Build the mod_cluster modules components, for each subdirectory
    advertise, mod_manager, mod_proxy_cluster and mod_slotmem do something
    like:</p><pre class="programlisting">sh buildconf
 ./configure --with-apxs=apxs_file_location
 make
 cp *.so apache_installation_directory/modules</pre><p>Where apache_installation_directory is the location of an installed
    version of httpd-2-2.x.</p><p>NOTE: You can ignore the libtool message on most platform:</p><pre class="programlisting">libtool: install: warning: remember to run `libtool --finish apache_installation_directory/modules'</pre><p>Once that is done use <a href="#nativeconfig" title="Chapter 3. native configuration">Apache httpd
    configuration</a> to configure mod_cluster.</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e630"/>4.3. Build the mod_proxy module</h2></div></div></div><p>It is only needed for httpd-2.2.x where x &lt; 11. Process like the
    other mod_cluster modules.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="nativeinstall"/>Chapter 5. Installation of the httpd part</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e648">5.1. Configuration</a></span></dt><dt><span class="sect1"><a href="#d0e659">5.2. Installing and using the bundles</a></span></dt></dl></div><p>Several bundles are available at <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/mod_cluster/downloads.html">http://www.jboss.org/mod_cluster/downloads.html</a>.</p><p>In case you can't find a prepared package of mod_cluser in the
  download area, it is possible to build mod_cluster for the sources. You need
  a distribution of httpd (at least 2.2.8) or (better) a source tarball of
  httpd and the sources of mod_cluster. <a href="#building" title="Chapter 4. Building mod_cluster from sources">Building</a>
  explains how to build mod_cluster for it sources.</p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e648"/>5.1. Configuration</h2></div></div></div><p>A minimal configuration is needed in httpd (See <a href="#nativeconfig" title="Chapter 3. native configuration">httpd.conf</a>).
    A listener must be a added in in JBossWEB conf/server.xml (See <a href="#javaconf" title="Chapter 6. java configuration">Configuring JBoss
    AS/Web</a>).</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e659"/>5.2. Installing and using the bundles</h2></div></div></div><p>The bundles are tar.gz on POSIX platforms just extract them in root
    something like:</p><pre class="programlisting">  cd /
  tar xvf mod-cluster-1.0.0-linux2-x86-ssl.tar.gz</pre><p>The httpd.conf is located in /opt/jboss/httpd/httpd/conf to quick
    test just add something like:</p><pre class="programlisting">Listen 10.33.144.3:6666
 &lt;VirtualHost 10.33.144.3:6666&gt;
 
   &lt;Directory /&gt;
      Order deny,allow
      Deny from all
      Allow from 10.33.144.
   &lt;/Directory&gt;
 
 KeepAliveTimeout 60
 MaxKeepAliveRequests 0
 
 ManagerBalancerName mycluster
 AdvertiseFrequency 5
 
 &lt;/VirtualHost&gt;</pre><p>To start httpd do the following:</p><pre class="programlisting">/opt/jboss/httpd/sbin/apachectl start</pre><p>NOTE: Make sure to use SSL before going in production.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="javaconf"/>Chapter 6. java configuration</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e681">6.1. JBoss AS</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e689">6.1.1. Lifecycle listener</a></span></dt><dt><span class="sect2"><a href="#d0e715">6.1.2. Connectors</a></span></dt><dt><span class="sect2"><a href="#d0e734">6.1.3. Node Identity</a></span></dt><dt><span class="sect2"><a href="#local">6.1.4. Non-Clustered Mode</a></span></dt><dt><span class="sect2"><a href="#HAModClusterService">6.1.5. Clustered Mode</a></span></dt></dl></dd><dt><span class="sect1"><a href="#tomcat">6.2. JBoss Web &amp; Tomcat</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e830">6.2.1. Lifecycle Listener</a></span></dt><dt><span class="sect2"><a href="#d0e841">6.2.2. Additional Tomcat dependencies</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e681"/>6.1. JBoss AS</h2></div></div></div><p>The entry point for configuring mod_cluster withing JBoss AS is the
    server.xml file within JBoss Web service.  This file is located at
    $JBOSS_HOME/server/<span class="emphasis"><em>profile</em></span>/deploy/jbossweb.sar/server.xml</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e689"/>6.1.1. Lifecycle listener</h3></div></div></div><p>mod_cluster leverages a &lt;Listener/&gt; to inform itself of web
      container lifecycle events, e.g. deploy/undeploy of a web application,
      startup/shutdown of the server, etc.</p><p>We use the generic MicrocontainerIntegrationLifecycleListener to
      delegate all lifecycle events to a bean deployed by the JBoss
      microcontainer.</p><p>mod_cluster 1.0.x is wired directly to the Catalina container
        API.  Catalina lifecycle events are delegated directly to
        mod_cluster's core service.</p><pre class="programlisting">&lt;Listener className="org.jboss.web.tomcat.service.deployers.MicrocontainerIntegrationLifecycleListener" 
          delegateBeanName="ModClusterService"/&gt;&lt;!-- Non-clustered mode --&gt; 
&lt;!--Listener className="org.jboss.web.tomcat.service.deployers.MicrocontainerIntegrationLifecycleListener" 
          delegateBeanName="HAModClusterService"/--&gt;&lt;!-- Clustered mode --&gt;</pre><p>To ensure that the delegate bean exists before the JBoss Web
        service starts, and that the bean does not get destroyed until the
        service shuts down, we must add an explicit microcontainer dependency
        to the JBoss Web service.  To do this, update the WebServer bean
        contained in
        $JBOSS_HOME/server/<span class="emphasis"><em>profile</em></span>/deploy/jbossweb.sar/META-INF/jboss-beans.xml
        with the appropriate dependency:</p><pre class="programlisting">&lt;bean name="WebServer" class="org.jboss.web.tomcat.service.deployers.TomcatService"&gt; 
  &lt;!-- ... --&gt; 
  &lt;depends&gt;ModClusterService&lt;/depends&gt;&lt;!-- Non-clustered mode --&gt; 
  &lt;!--depends&gt;HAModClusterService&lt;/depends--&gt;&lt;!-- Clustered mode --&gt; 
  &lt;!-- ... --&gt; 
&lt;/bean&gt;</pre><p>For details of how to configure
        <a href="#local" title="6.1.4. Non-Clustered Mode">ModClusterService</a>
        or
        <a href="#HAModClusterService" title="6.1.5. Clustered Mode">HAModClusterService</a>
        refer to the appropriate section.</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e715"/>6.1.2. Connectors</h3></div></div></div><p>Like mod_jk and mod_proxy_balancer, mod_cluster requires a
      connector in your server.xml on which to forward web requests.
       mod_cluster is not confined to AJP, but can use HTTP as well.  If
      multiple possible connectors are available, mod_cluster uses the
      following algorithm to choose between them: </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>If an native (APR) AJP connector is available, use it</p></li><li><p>If an AJP connector is available, use it</p></li><li><p>Otherwise, choose the connector with the highest max
          threads.</p></li></ol></div><p>e.g.</p><pre class="programlisting">&lt;Server&gt; 
  &lt;!-- ... --&gt; 
  &lt;Service name="jboss.web"&gt; 
    &lt;Connector protocol="HTTP/1.1" port="${jboss.web.http.port}" address="${jboss.bind.address}" redirectPort="${jboss.web.https.port}"/&gt; 
    &lt;Connector protocol="AJP/1.3" port="${jboss.web.ajp.port}" address="${jboss.bind.address}" redirectPort="${jboss.web.https.port}"/&gt; 
    &lt;Engine name="jboss.web" defaultHost="localhost"&gt; 
      &lt;!-- ... --&gt; 
    &lt;/Engine&gt; 
  &lt;/Service&gt; 
&lt;/Server&gt;</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e734"/>6.1.3. Node Identity</h3></div></div></div><p>Like mod_jk and mod_proxy_balancer, mod_cluster identifies each
      node via a unique jvm route.  The is specified using the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://tomcat.apache.org/tomcat-6.0-doc/config/engine.html#Common%20Attributes">jvmRoute</a>
      attribute of the Engine within server.xml.</p><p>Users must define jvm routes
      manually, perhaps using system property expansion, e.g.
      jvmRoute="${jboss.mod_cluster.jvmRoute}"</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="local"/>6.1.4. Non-Clustered Mode</h3></div></div></div><p>mod_cluster can operate in 2 modes: non-clustered or
      <a href="#HAModClusterService" title="6.1.5. Clustered Mode">clustered</a>.
       In non-clustered mode, each JBoss server node communicates with a httpd
      proxy directly, and do not communicate with each other.  Non-clustered
      mode is powered by the ModClusterService, whose definition varies
      depending on the version of mod_cluster in use.</p><p>In general, ModClusterService defines:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>A set of
          <a href="#javaproperties" title="Chapter 8. java properties"> configuration properties</a></p></li><li><p>A mechanism for
          <a href="#javaload" title="Chapter 9. Load Metrics">providing the
          load balance factor</a>  to a proxy</p></li></ol></div><p>In version 1.0.x, all mod_cluster configuration properties are
        members of the ModClusterService bean itself:</p><pre class="programlisting">&lt;bean name="ModClusterService" class="org.jboss.modcluster.ModClusterService" mode="On Demand"&gt; 
  &lt;constructor&gt; 
    &lt;parameter class="org.jboss.modcluster.load.LoadBalanceFactorProvider"&gt; 
      &lt;inject bean="DynamicLoadBalanceFactorProvider"/&gt; 
    &lt;/parameter&gt; 
  &lt;/constructor&gt; 
  &lt;!-- Configuration properties go here --&gt; 
  &lt;property name="advertise"&gt;true&lt;/property&gt; 
&lt;/bean&gt;</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="HAModClusterService"/>6.1.5. Clustered Mode</h3></div></div></div><p>mod_cluster can operate in 2 modes:
      <a href="#local" title="6.1.4. Non-Clustered Mode">non-clustered</a>
      or clustered.  In clustered mode, a single JBoss node (the HA singleton
      master) communicates with the httpd proxy on behalf of the other nodes
      in the cluster.  This mode offers the following advantages over
      non-clustered mode:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>The state of each proxy will be kept in sync on each node in
          the cluster.</p></li><li><p>Proxies will be proactively notified of view changes, most
          notably, crashed members, allowing a proxy to gracefully reconfigure
          itself to avoiding failover processing.</p></li><li><p>Adds domain management functionality, providing the ability to
          enable, disable, or gracefully stop all nodes sharing the same
          domain.  A domain is a logical grouping of nodes, typically
          representing a replication "buddy group".</p></li></ol></div><p>Clustered mode is instrumented using JBoss clustering technologies
      and is configured via the HAModClusterService bean, the definition of
      which varies slightly between mod_cluster versions.</p><p>In general, HAModClusterService defines:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>A set of
          <a href="#javaproperties" title="Chapter 8. java properties"> configuration properties</a></p></li><li><p>A mechanism for
          <a href="#javaload" title="Chapter 9. Load Metrics">providing the
          load balance factor</a> to a proxy</p></li><li><p>An HAPartition, the JBoss clustering group communication
          building block.  The default HAPartition is defined
          in:$JBOSS_HOME/server/<span class="emphasis"><em>profile</em></span>/deploy/cluster/hapartition-jboss-beans.xml</p></li></ol></div><pre class="programlisting">&lt;bean name="HAModClusterService" class="org.jboss.modcluster.ha.HAModClusterService" mode="On Demand"&gt; 
  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=ModCluster",exposedInterface=org.jboss.modcluster.ha.HAModClusterServiceMBean.class)&lt;/annotation&gt; 
  &lt;constructor&gt; 
    &lt;parameter class="org.jboss.ha.framework.interfaces.HAPartition"&gt; 
      &lt;inject bean="HAPartition"/&gt; 
    &lt;/parameter&gt; 
    &lt;parameter class="org.jboss.modcluster.config.ha.HAModClusterConfig"&gt; 
      &lt;inject bean="HAModClusterConfig"/&gt; 
    &lt;/parameter&gt; 
    &lt;parameter class="org.jboss.modcluster.load.LoadBalanceFactorProvider"&gt; 
      &lt;inject bean="DynamicLoadBalanceFactorProvider"/&gt; 
    &lt;/parameter&gt; 
    &lt;parameter class="org.jboss.ha.framework.interfaces.HASingletonElectionPolicy"&gt; 
      &lt;bean class="org.jboss.ha.singleton.HASingletonElectionPolicySimple"/&gt; 
    &lt;/parameter&gt; 
  &lt;/constructor&gt; 
&lt;/bean&gt; 
&lt;bean name="HAModClusterConfig" class="org.jboss.modcluster.config.ha.HAModClusterConfig" mode="On Demand"&gt; 
  &lt;property name="advertise"&gt;true&lt;/property&gt; 
&lt;/bean&gt;</pre></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="tomcat"/>6.2. JBoss Web &amp; Tomcat</h2></div></div></div><p>In the absence of the ability for complex configuration,
    mod_cluster's entire configuration for JBoss Web or Tomcat resides
    entirely within $CATALINA_HOME/conf/server.xml.</p><p>This adds the following constraints to mod_cluster's feature
    set:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Only non-clustered mode is supported</p></li><li><p>
         Only one
        load metric can be used in the load balance factor
        calculation</p></li></ol></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e830"/>6.2.1. Lifecycle Listener</h3></div></div></div><p>The entry point for JBoss Web and Tomcat configuration is the
      ModClusterListener.  All mod_cluster
      <a href="#javaproperties" title="Chapter 8. java properties"> configuration
      properties</a> are defined as attributes of the Listener
      element.</p><pre class="programlisting">&lt;Listener className="org.jboss.modcluster.ModClusterListener" 
          advertise="true"/&gt;</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e841"/>6.2.2. Additional Tomcat dependencies</h3></div></div></div><p>mod_cluster uses jboss-logging, which exists in JBoss Web, but not
      in Tomcat. Consequently, to use mod_cluster with Tomcat, it is necessary
      to add <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://repository.jboss.org/jboss/common-logging-spi/">jboss-logging-spi.jar</a>
      to $CATALINA_HOME/lib.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="javabuilding"/>Chapter 7. Building mod_cluster's Java components from source</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e871">7.1. Build products</a></span></dt></dl></div><p>Building from source the components used in JBoss AS/JBossWeb/Tomcat
  requires Maven 2.0.x.</p><p>Steps to build:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Download the mod_cluster sources</p><pre class="programlisting">svn co http://anonsvn.jboss.org/repos/mod_cluster/trunk/ mod_cluster</pre></li><li><p>Use maven "dist" profile to build:</p><pre class="programlisting">cd mod_cluster; mvn -P dist package</pre></li></ol></div><p>Note: Some maven tests are using UDP port 23365 make sure you are
  local firewall allows the port.</p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e871"/>7.1. Build products</h2></div></div></div><p>The build produces the following output in the target
    directory:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>mod-cluster.sar</p><p>Exploded format sar to copy to the deploy dir in your JBoss AS
        install</p></li><li><p>JBossWeb-Tomcat/lib directory</p><p>Jar files to copy to the lib directory in your JBossWeb or
        Tomcat install to support use of mod_cluster</p></li><li><p>demo directory</p><p>The <a href="#demo" title="Chapter 15. Load Balancing Demo Application">load balancing demo</a> application</p></li><li><p>mod-cluster-XXX.tar.gz</p><p>The full distribution tarball; includes the above
        elements</p></li></ol></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="javaproperties"/>Chapter 8. java properties</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e903">8.1. Configuration Properties</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e911">8.1.1. 
      Proxy Discovery Configuration</a></span></dt><dt><span class="sect2"><a href="#d0e1136">8.1.2. 
      Proxy Configuration</a></span></dt><dt><span class="sect2"><a href="#d0e1386">8.1.3. 
      SSL Configuration</a></span></dt><dt><span class="sect2"><a href="#d0e1675">8.1.4. 
      HA Configuration</a></span></dt><dt><span class="sect2"><a href="#d0e1721">8.1.5. 
      Load Configuration</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e903"/>8.1. Configuration Properties</h2></div></div></div><p>The tables below enumerate the configuration properties available to an application server node. The location for these properties depends on <a href="#javaconf" title="Chapter 6. java configuration">how mod_cluster is configured</a>.</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e911"/>8.1.1. 
      <a id="mcmp"/>Proxy Discovery Configuration</h3></div></div></div><p>The list of proxies from which an application expects to receive AJP connections is either defined statically, via the addresses defined in the <a href="#proxyList">proxyList</a> configuration property; or discovered dynamically via the advertise mechanism. Using a special mod_advertise module, proxies can advertise their existence by periodically broadcasting a multicast message containing its address/port. This functionality is enabled via the <a href="#advertise">advertise</a> configuration property. If configured to listen, a server can learn of the proxy's existence, then notify that proxy of its own existence, and update its configuration accordingly. This frees both the proxy <span class="emphasis"><em>and</em></span> the server from having to define static, environment-specific configuration values.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>
                  <p>Attribute</p>
               </th><th>
                  <p>Default</p>
               </th><th>
                  <p>Description</p>
               </th></tr></thead><tbody><tr><td><a id="proxyList"/>
               <p>proxyList</p>
            </td><td>
               <p>
                  <span class="emphasis"><em>None</em></span>
               </p>
            </td><td>
               <p>Defines a comma delimited list of httpd proxies with which this node will initially communicate. Value should be of the form: </p>
               <p>address1:port1,address2:port2</p>
               <p>Using the default configuration, this property can by manipulated via the jboss.modcluster.proxyList system property.</p>
            </td></tr><tr><td>
               <p>
                  <a id="excludedContexts"/>excludedContexts</p>
            </td><td>
               <p>ROOT,admin-console,invoker,jbossws,jmx-console,juddi,web-console</p>
            </td><td>
               <p>List of contexts to exclude from httpd registration, of the form: </p>
               <p>host1:context1,host2:context2,host3:context3</p>
               <p>If no host is indicated, it is assumed to be the default host of the server (e.g. localhost). "ROOT" indicates the root context. Using the default configuration, this property can by manipulated via the jboss.modcluster.excludedContexts system property.</p>
            </td></tr><tr><td>
               <p>autoEnableContexts</p>
            </td><td>
               <p>true</p>
            </td><td>
               <p>If false the contexts are registered disabled in httpd, they need to be enabled via the enable() mbean method or via mod_cluster_manager. Since version 1.1.0.CR1.</p>
            </td></tr><tr><td>
               <p>stopContextTimeout</p>
            </td><td>
               <p>10</p>
            </td><td>
               <p>The number of seconds to wait for clean shutdown of a context (completion of pending requests for a distributable context; or destruction/expiration of active sessions for a non-distributable context). Since version 1.1.0.CR1.</p>
            </td></tr><tr><td>
               <p>proxyURL</p>
            </td><td>
               <p>
                  <span class="emphasis"><em>None</em></span>
               </p>
            </td><td>
               <p>If defined, this value will be prepended to the URL of MCMP commands.</p>
            </td></tr><tr><td>
               <p>socketTimeout</p>
            </td><td>
               <p>20000</p>
            </td><td>
               <p>Number of milliseconds to wait for a response from an httpd proxy to MCMP commands before timing out, and flagging the proxy as in error.</p>
            </td></tr><tr><td><a id="advertise"/>
               <p>advertise</p>
            </td><td>
               <p>true, if <a href="#proxyList">proxyList</a> is undefined, false otherwise</p>
            </td><td>
               <p>If enabled, httpd proxies will be auto-discovered via multicast announcements. This can be used either in concert or in place of a static <a href="#proxyList">proxyList</a>.</p>
            </td></tr><tr><td>
               <p>advertiseGroupAddress</p>
            </td><td>
               <p>224.0.1.105</p>
            </td><td>
               <p>UDP address on which to listen for httpd proxy multicast advertisements</p>
            </td></tr><tr><td>
               <p>advertisePort</p>
            </td><td>
               <p>23364</p>
            </td><td>
               <p>UDP port on which to listen for httpd proxy multicast advertisements</p>
            </td></tr><tr><td>
               <p>advertiseSecurityKey</p>
            </td><td>
               <p>
                  <span class="emphasis"><em>None</em></span>
               </p>
            </td><td>
               <p>If specified, httpd proxy advertisements checksums will be verified using this value as a salt</p>
            </td></tr></tbody></table></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1136"/>8.1.2. 
      <a id="proxy"/>Proxy Configuration</h3></div></div></div><p>The following configuration values are sent to proxies during server startup, when a proxy is detected via the advertise mechanism, or during the resetting of a proxy's configuration during error recovery.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>
                  <p>Attribute</p>
               </th><th>
                  <p>Default</p>
               </th><th>
                  <p>Description</p>
               </th></tr></thead><tbody><tr><td>
               <p>
                  <a id="stickySession"/>stickySession</p>
            </td><td>
               <p>true</p>
            </td><td>
               <p>Indicates whether subsequent requests for a given session should be routed to the same node, if possible.</p>
            </td></tr><tr><td>
               <p>stickySessionRemove</p>
            </td><td>
               <p>false</p>
            </td><td>
               <p>Indicates whether the httpd proxy should remove session stickiness in the event that the balancer is unable to route a request to the node to which it is stuck. This property is ignored if <a href="#stickySession">stickySession</a> is false.</p>
            </td></tr><tr><td>
               <p>stickySessionForce</p>
            </td><td>
               <p>true</p>
            </td><td>
               <p>Indicates whether the httpd proxy should return an error in the event that the balancer is unable to route a request to the node to which it is stuck. This property is ignored if <a href="#stickySession">stickySession</a> is false.</p>
            </td></tr><tr><td>
               <p>workerTimeout</p>
            </td><td>
               <p>-1</p>
            </td><td>
               <p>Number of seconds to wait for a worker to become available to handle a request. When all the workers of a balancer are usable, mod_cluster will retry after a while (workerTimeout/100) to find an usable worker. That is timeout in the balancer mod_proxy documentation. A value of -1 indicates that the httpd will not wait for a worker to be available and will return an error if none is available.</p>
            </td></tr><tr><td>
               <p>maxAttempts</p>
            </td><td>
               <p>1</p>
            </td><td>
               <p>Number of times an httpd proxy will attempt to send a given request to a worker before giving up. The minimum value is 1, meaning try only once. (Note that mod_proxy default is also 1: no retry).</p>
            </td></tr><tr><td>
               <p>flushPackets</p>
            </td><td>
               <p>false</p>
            </td><td>
               <p>Enables/disables packet flushing</p>
            </td></tr><tr><td>
               <p>flushWait</p>
            </td><td>
               <p>-1</p>
            </td><td>
               <p>Time to wait before flushing packets. A value of -1 means wait forever.</p>
            </td></tr><tr><td>
               <p>ping</p>
            </td><td>
               <p>10 seconds</p>
            </td><td>
               <p>Time to wait for a pong answer to a ping</p>
            </td></tr><tr><td>
               <p>smax</p>
            </td><td>
               <p>Determined by httpd configuration</p>
            </td><td>
               <p>Soft maximum idle connection count (that is the smax in worker mod_proxy documentation). The maximum value depends on the httpd thread configuration (ThreadsPerChild or 1).</p>
            </td></tr><tr><td>
               <p>ttl</p>
            </td><td>
               <p>60 seconds</p>
            </td><td>
               <p>Time to live (in seconds) for idle connections above smax</p>
            </td></tr><tr><td>
               <p>nodeTimeout</p>
            </td><td>
               <p>-1 (none)</p>
            </td><td>
               <p>Timeout (in seconds) for proxy connections to a node. That is the time mod_cluster will wait for the back-end response before returning error. That corresponds to timeout in the worker mod_proxy documentation. Note that mod_cluster always uses a cping/cpong before forwarding a request and the connectiontimeout value used by mod_cluster is the ping value.</p>
            </td></tr><tr><td>
               <p>balancer</p>
            </td><td>
               <p>mycluster</p>
            </td><td>
               <p>The balancer name</p>
            </td></tr><tr><td>
               <p>
                  <a id="domain"/>domain</p>
            </td><td>
               <p>
                  <span class="emphasis"><em>None</em></span>
               </p>
            </td><td>
               <p>If specified, load will be balanced among jvmRoutes with the same domain. This is primarily used in conjunction with partitioned session replication (e.g. buddy replication).</p>
            </td></tr></tbody></table></div><p>Note: When nodeTimeout is not defined the ProxyTimeout directive Proxy is used. If ProxyTimeout is not defined the server timeout (Timeout) is used (default 300 seconds). nodeTimeout, ProxyTimeout or Timeout is set at the socket level.</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1386"/>8.1.3. 
      <a id="ssl"/>SSL Configuration</h3></div></div></div><p>The communication channel between application servers and httpd proxies uses HTTP by default. This channel can be secured using HTTPS by setting the <a id="ssl1"/>ssl to true.</p><p>N.B. This HTTP/HTTPS channel should not be confused with the processing of HTTP/HTTPS client requests.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>
                  <p>Attribute</p>
               </th><th>
                  <p>Default</p>
               </th><th>
                  <p>Description</p>
               </th></tr></thead><tbody><tr><td>
               <p>
                  <a id="ssl2"/>ssl</p>
            </td><td>
               <p>false</p>
            </td><td>
               <p>Should connection to proxy use a secure socket layer</p>
            </td></tr><tr><td>
               <p>sslCiphers</p>
            </td><td>
               <p>The default JSSE cipher suites</p>
            </td><td>
               <p>Overrides the cipher suites used to init an SSL socket ignoring any unsupported ciphers</p>
            </td></tr><tr><td>
               <p>sslProtocol</p>
            </td><td>
               <p>TLS</p>
            </td><td>
               <p>Overrides the default SSL socket protocol.</p>
            </td></tr><tr><td>
               <p>sslCertificateEncodingAlgorithm</p>
            </td><td>
               <p>The default JSSE key manager algorithm</p>
            </td><td>
               <p>The algorithm of the key manager factory</p>
            </td></tr><tr><td>
               <p>sslKeyStore</p>
            </td><td>
               <p>System.getProperty("user.home") + "/.keystore"</p>
            </td><td>
               <p>The location of the key store containing client certificates</p>
            </td></tr><tr><td>
               <p>sslKeyStorePass</p>
            </td><td>
               <p>changeit</p>
            </td><td>
               <p>The password granting access to the key store</p>
            </td></tr><tr><td>
               <p>sslKeyStoreType</p>
            </td><td>
               <p>JKS</p>
            </td><td>
               <p>The type of key store</p>
            </td></tr><tr><td>
               <p>sslKeyStoreProvider</p>
            </td><td>
               <p>The default JSSE security provider</p>
            </td><td>
               <p>The key store provider</p>
            </td></tr><tr><td>
               <p>sslTrustAlgorithm</p>
            </td><td>
               <p>The default JSSE trust manager algorithm</p>
            </td><td>
               <p>The algorithm of the trust manager factory</p>
            </td></tr><tr><td>
               <p>sslKeyAlias</p>
            </td><td>
               <p> </p>
            </td><td>
               <p>The alias of the key holding the client certificates in the key store</p>
            </td></tr><tr><td>
               <p>sslCrlFile</p>
            </td><td>
               <p> </p>
            </td><td>
               <p>Certificate revocation list</p>
            </td></tr><tr><td>
               <p>sslTrustMaxCertLength</p>
            </td><td>
               <p>5</p>
            </td><td>
               <p>The maximum length of a certificate held in the trust store</p>
            </td></tr><tr><td>
               <p>sslTrustStore</p>
            </td><td>
               <p>System.getProperty("javax.net.ssl.trustStorePassword")</p>
            </td><td>
               <p>The location of the file containing the trust store</p>
            </td></tr><tr><td>
               <p>sslTrustStorePassword</p>
            </td><td>
               <p>System.getProperty("javax.net.ssl.trustStore")</p>
            </td><td>
               <p>The password granting access to the trust store.</p>
            </td></tr><tr><td>
               <p>sslTrustStoreType</p>
            </td><td>
               <p>System.getProperty("javax.net.ssl.trustStoreType")</p>
            </td><td>
               <p>The trust store type</p>
            </td></tr><tr><td>
               <p>sslTrustStoreProvider</p>
            </td><td>
               <p>System.getProperty("javax.net.ssl.trustStoreProvider")</p>
            </td><td>
               <p>The trust store provider</p>
            </td></tr></tbody></table></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1675"/>8.1.4. 
      <a id="ha"/>HA Configuration</h3></div></div></div><p>Additional configuration properties when mod_cluster is configured in clustered mode.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>
                  <p>Attribute</p>
               </th><th>
                  <p>Default</p>
               </th><th>
                  <p>Description</p>
               </th></tr></thead><tbody><tr><td>
               <p>masterPerDomain</p>
            </td><td>
               <p>false</p>
            </td><td>
               <p>If the <a href="#domain">domain</a> directive is used, should HA partition use a singleton master per domain</p>
            </td></tr></tbody></table></div></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1721"/>8.1.5. 
      <a id="load"/>Load Configuration</h3></div></div></div><p>Additional configuration properties used when mod_cluster is configured in JBoss Web standalone or Tomcat.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>
                  <p>Attribute</p>
               </th><th>
                  <p>Default</p>
               </th><th>
                  <p>Description</p>
               </th></tr></thead><tbody><tr><td>
               <p>loadMetricClass</p>
            </td><td>
               <p>org.jboss.modcluster.load.metric.impl.BusyConnectorsLoadMetric</p>
            </td><td>
               <p>Class name of an object implementing org.jboss.load.metric.LoadMetric</p>
            </td></tr><tr><td>
               <p>loadMetricCapacity</p>
            </td><td>
               <p>1</p>
            </td><td>
               <p>The capacity of the load metric defined via the loadMetricClass property</p>
            </td></tr><tr><td>
               <p>loadHistory</p>
            </td><td>
               <p>9</p>
            </td><td>
               <p>The number of historic load values to consider in the load balance factor computation.</p>
            </td></tr><tr><td>
               <p>loadDecayFactor</p>
            </td><td>
               <p>2</p>
            </td><td>
               <p>The factor by which a historic load values should degrade in significance.</p>
            </td></tr></tbody></table></div><p/></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="javaload"/>Chapter 9. Load Metrics</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e1816">9.1. Server-Side Load Metrics</a></span></dt><dt><span class="sect1"><a href="#d0e1883">9.2. Web Container metrics</a></span></dt><dt><span class="sect1"><a href="#d0e2051">9.3. System/JVM metrics</a></span></dt><dt><span class="sect1"><a href="#d0e2121">9.4. Other metrics</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1816"/>9.1. Server-Side Load Metrics</h2></div></div></div><p>A major feature of mod_cluster is the ability to use server-side
    load metrics to determine how best to balance requests.</p><p>The DynamicLoadBalanceFactorProvider bean computes the load balance
    factor of a node from a defined set of load metrics.</p><pre class="programlisting"><p>&lt;bean name="DynamicLoadBalanceFactorProvider" class="org.jboss.modcluster.load.impl.DynamicLoadBalanceFactorProvider" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=LoadBalanceFactorProvider",exposedInterface=org.jboss.modcluster.load.impl.DynamicLoadBalanceFactorProviderMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter&gt;</p><p>      &lt;set elementClass="org.jboss.modcluster.load.metric.LoadMetric"&gt;</p><p>        &lt;inject bean="BusyConnectorsLoadMetric"/&gt;</p><p>        &lt;inject bean="HeapMemoryUsageLoadMetric"/&gt;</p><p>      &lt;/set&gt;</p><p>    &lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>  &lt;property name="history"&gt;9&lt;/property&gt;</p><p>  &lt;property name="decayFactor"&gt;2&lt;/property&gt;</p><p>&lt;/bean&gt;</p></pre><p>Load metrics can be configured with an associated weight and
    capacity:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>The weight (default is 1) indicates the significance of a metric
        with respect to the other metrics. For example, a metric of weight 2
        will have twice the impact on the overall load factor than a metric of
        weight 1.</p></li><li><p>The capacity of a metric serves 2 functions:</p></li></ol></div><p>Each load metric contributes a value to the overall load factor of a
    node. The load factors from each metric are aggregated according to their
    weights.</p><p>In general, the load factor contribution of given metric is: (load /
    capacity) * weight / total weight.</p><p>The DynamicLoadBalanceFactorProvider applies a time decay function
    to the loads returned by each metric. The aggregate load, with respect to
    previous load values, can be expressed by the following formula:</p><p>    L = (L0 + L1/D + L2/D2 + L3/D3 + ... + LH/DH) * (1 + D + D2 + D3
    + ... DH)</p><p>... or more concisely as:</p><p>    H         H</p><p>L = ∑ Li/Di *  ∑ Di</p><p>   i=0       i=0</p><p>... where D = decayFactor and H = history.</p><p>Setting history = 0 effectively disables the time decay function and
    only the current load for each metric will be considered in the load
    balance factor computation.</p><p>The mod_cluster proxy module expects the load factor to be an
    integer between 0 and 100, where 0 indicates max load and 100 indicates
    zero load. Therefore, the final load balance factor sent to the proxy =
    100 - (L * 100).</p><p>While you are free to write your own load metrics, the following
    LoadMetrics are available out of the box:</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1883"/>9.2. Web Container metrics</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>ActiveSessionsLoadMetric</p><p> * Requires an explicit capacity</p><p> * Uses SessionLoadMetricSource to query session managers</p><p> * Analogous to method=S in mod_jk </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="ActiveSessionsLoadMetric" class="org.jboss.modcluster.load.metric.impl.ActiveSessionsLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=ActiveSessionsLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter&gt;&lt;inject bean="SessionLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>  &lt;property name="capacity"&gt;1000&lt;/property&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean name="SessionLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.SessionLoadMetricSource" mode="On Demand"&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="javax.management.MBeanServer"&gt;&lt;inject bean="JMXKernel" property="mbeanServer"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p></pre></li><li><p>BusyConnectorsLoadMetric</p><p> * Returns the percentage of connector threads from the thread
        pool that are busy servicing requests</p><p> * Uses ThreadPoolLoadMetricSource to query connector thread
        pools</p><p> * Analogous to method=B in mod_jk </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="BusyConnectorsLoadMetric" class="org.jboss.modcluster.load.metric.impl.BusyConnectorsLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=BusyConnectorsLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter&gt;&lt;inject bean="ThreadPoolLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean name="ThreadPoolLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.ThreadPoolLoadMetricSource" mode="On Demand"&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="javax.management.MBeanServer"&gt;&lt;inject bean="JMXKernel" property="mbeanServer"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p></pre></li><li><p>ReceiveTrafficLoadMetric</p><p> * Returns the incoming request traffic in KB/sec</p><p> * Requires an explicit capacity</p><p> * Uses RequestProcessorLoadMetricSource to query request
        processors</p><p> * Analogous to method=T in mod_jk </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="ReceiveTrafficLoadMetric" class="org.jboss.modcluster.load.metric.impl.ReceiveTrafficLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=ReceiveTrafficLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource"&gt;&lt;inject bean="RequestProcessorLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>  &lt;property name="capacity"&gt;1024&lt;/property&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean name="RequestProcessorLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource" mode="On Demand"&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="javax.management.MBeanServer"&gt;&lt;inject bean="JMXKernel" property="mbeanServer"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p></pre></li><li><p>SendTrafficLoadMetric</p><p> * Returns the outgoing request traffic in KB/sec</p><p> * Requires an explicit capacity</p><p> * Uses RequestProcessorLoadMetricSource to query request
        processors</p><p> * Analogous to method=T in mod_jk </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="SendTrafficLoadMetric" class="org.jboss.modcluster.load.metric.impl.SendTrafficLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=SendTrafficLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource"&gt;&lt;inject bean="RequestProcessorLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>  &lt;property name="capacity"&gt;512&lt;/property&gt;</p><p>&lt;/bean&gt;</p></pre></li><li><p>RequestCountLoadMetric</p><p> * Returns the number of requests/sec</p><p> * Requires an explicit capacity</p><p> * Uses RequestProcessorLoadMetricSource to query request
        processors</p><p> * Analogous to method=R in mod_jk </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="RequestCountLoadMetric" class="org.jboss.modcluster.load.metric.impl.RequestCountLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=RequestCountLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource"&gt;&lt;inject bean="RequestProcessorLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>  &lt;property name="capacity"&gt;1000&lt;/property&gt;</p><p>&lt;/bean&gt;</p></pre></li></ol></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2051"/>9.3. System/JVM metrics</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>AverageSystemLoadMetric</p><p> * Returns CPU load</p><p> * Requires Java 1.6+.</p><p> * Uses OperatingSystemLoadMetricSource to generically read
        attributes </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="AverageSystemLoadMetric" class="org.jboss.modcluster.load.metric.impl.AverageSystemLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=AverageSystemLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter&gt;&lt;inject bean="OperatingSystemLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean name="OperatingSystemLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.OperatingSystemLoadMetricSource" mode="On Demand"&gt;</p><p>&lt;/bean&gt;</p></pre></li><li><p>SystemMemoryUsageLoadMetric</p><p> * Returns system memory usage</p><p> * Requires com.sun.management.OperatingSystemMXBean (available
        in Sun's JDK or OpenJDK)</p><p> * Uses OperatingSystemLoadMetricSource to generically read
        attributes </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="SystemMemoryUsageLoadMetric" class="org.jboss.modcluster.load.metric.impl.SystemMemoryUsageLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=SystemMemoryUsageLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter&gt;&lt;inject bean="OperatingSystemLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p></pre></li><li><p>HeapMemoryUsageLoadMetric</p><p>* Returns the heap memory usage as a percentage of max heap
        size</p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="HeapMemoryUsageLoadMetric" class="org.jboss.modcluster.load.metric.impl.HeapMemoryUsageLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=HeapMemoryUsageLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>&lt;/bean&gt;</p></pre></li></ol></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2121"/>9.4. Other metrics</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>ConnectionPoolUsageLoadMetric</p><p> * Returns the percentage of connections from a connection pool
        that are in use.</p><p> * Uses ConnectionPoolLoadMetricSource to query JCA connection
        pools </p><p>e.g.</p></li></ol></div><pre class="programlisting"><p>&lt;bean name="ConnectionPoolUsageMetric" class="org.jboss.modcluster.load.metric.impl.ConnectionPoolUsageLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=ConnectionPoolUsageLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter&gt;&lt;inject bean="ConnectionPoolLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean name="ConnectionPoolLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.ConnectionPoolLoadMetricSource" mode="On Demand"&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="javax.management.MBeanServer"&gt;&lt;inject bean="JMXKernel" property="mbeanServer"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p></pre></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="javainstall"/>Chapter 10. Installation of the java part</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e2160">10.1. Install the Java-side binaries</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2167">10.1.1. Installing in JBoss AS 6.0.0.M1 and up</a></span></dt><dt><span class="sect2"><a href="#d0e2172">10.1.2. Installing in JBoss AS 5.x</a></span></dt><dt><span class="sect2"><a href="#d0e2179">10.1.3. Installing in JBoss Web or Tomcat</a></span></dt><dt><span class="sect2"><a href="#d0e2186">10.1.4. Installing in JBoss AS 4.2.x or 4.3.x</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2160"/>10.1. Install the Java-side binaries</h2></div></div></div><p>First, extract the java-side binary to a temporary directory. The
    following assumes it was extracted to /tmp/mod-cluster</p><p>Your next step depends on whether your target server is JBoss AS or
    JBossWeb/Tomcat.</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2167"/>10.1.1. Installing in JBoss AS 6.0.0.M1 and up</h3></div></div></div><p>You don't need to do anything to install the java-side binaries in
      AS 6.x; it's part of the AS distribution's default, standard and all
      configurations.</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2172"/>10.1.2. Installing in JBoss AS 5.x</h3></div></div></div><p>Assuming $JBOSS_HOME indicates the root of your JBoss AS install
      and that you want to use mod_cluster in the AS's all config:</p><pre class="programlisting">
  cp -r /tmp/mod-cluster/mod-cluster.sar $JBOSS_HOME/server/all/deploy
</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2179"/>10.1.3. Installing in JBoss Web or Tomcat</h3></div></div></div><p>Assuming $CATALINA_HOME indicates the root of your JBossWeb or
      Tomcat install:</p><pre class="programlisting">cp -r /tmp/mod-cluster/JBossWeb-Tomcat/lib/*
      $CATALINA_HOME/lib/ </pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2186"/>10.1.4. Installing in JBoss AS 4.2.x or 4.3.x</h3></div></div></div><p>Assuming $JBOSS_HOME indicates the root of your JBoss AS install
      and that you want to use mod_cluster in the AS's all config:</p><pre class="programlisting">
      cp -r /tmp/mod-cluster/JBossWeb-Tomcat/lib/mod-cluster.jar $JBOSS_HOME/server/all/deploy/jboss-web.deployer </pre></div></div><p>TODO</p></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mod_proxy_https"/>Chapter 11. Using https between httpd and JBossWEB</h2></div></div></div><p>The feature is only needed if the connection between httpd and
  JBossWEB is not secure it needs some more resources because crypto is
  used.</p><pre class="programlisting">SSLProxyEngine On
SSLProxyVerify require
SSLProxyCACertificateFile conf/cacert.pem
SSLProxyMachineCertificateFile conf/proxy.pem</pre><p>conf/proxy.pem should contain both key and certificate (and the
  certificate must be trusted by Tomcat).conf/cacert.pem must contain the CA
  that signed the Tomcat certificate.The &lt;connector/&gt; should use
  https.</p></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="UsingSSL"/>Chapter 12. Using SSL in mod_cluster</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e2209">12.1. Using SSL between JBossWEB and httpd</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2214">12.1.1. Apache httpd configuration part</a></span></dt><dt><span class="sect2"><a href="#d0e2229">12.1.2. ClusterListener configuration part</a></span></dt><dt><span class="sect2"><a href="#d0e2243">12.1.3. mod-cluster-jboss-beans configuration part</a></span></dt><dt><span class="sect2"><a href="#d0e2253">12.1.4. How the diferent files were created</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e2328">12.2. Using SSL between httpd and JBossWEB</a></span></dt><dt><span class="sect1"><a href="#d0e2338">12.3. Forwarding SSL browser informations when using http/https between
    httpd and JBossWEB</a></span></dt></dl></div><p>There are 2 connections between the cluster and the front-end. Both
  could be encrypted. That chapter describes how to encrypt both
  connections.</p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2209"/>12.1. Using SSL between JBossWEB and httpd</h2></div></div></div><p>As the ClusterListener allows to configure httpd it is adviced to
    use SSL for that connection. The most easy is to use a virtual host that
    will only be used to receive information from JBossWEB. Both side need
    configuration.</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2214"/>12.1.1. Apache httpd configuration part</h3></div></div></div><p><a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://httpd.apache.org/docs/2.2/mod/mod_ssl.html">mod_ssl</a>
      of httpd is using to do that. See in one example how easy the
      configuration is:</p><pre class="programlisting"> Listen 6666
 &lt;VirtualHost 10.33.144.3:6666&gt;
     SSLEngine on
     SSLCipherSuite AES128-SHA:ALL:!ADH:!LOW:!MD5:!SSLV2:!NULL
     SSLCertificateFile conf/server.crt
     SSLCertificateKeyFile conf/server.key
     SSLCACertificateFile conf/server-ca.crt
     SSLVerifyClient require
     SSLVerifyDepth  10 
 &lt;/VirtualHost&gt;</pre><p>The conf/server.crt file is the PEM-encoded Certificate file for
      the VirtualHost it must be signed by a Certificate Authority (CA) whose
      certificate is stored in the sslTrustStore of the ClusterListener
      parameter.</p><p>The conf/server.key file is the file containing the private
      key.</p><p>The conf/server-ca.crt file is the file containing the certicate
      of the CA that have signed the client certificate JBossWEB is using.
      That is the CA that have signed the certificate corresponding to the
      sslKeyAlias stored in the sslKeyStore of the ClusterListener
      parameters.</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2229"/>12.1.2. ClusterListener configuration part</h3></div></div></div><p>There is a <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/community/docs/DOC-9300">wiki</a>
      describing the SSL parameters of the ClusterListener. See in one example
      how easy the configuration is:</p><pre class="programlisting"> &lt;Listener className="org.jboss.web.cluster.ClusterListener"
           ssl="true"
           sslKeyStorePass="changeit"
           sslKeyStore="/home/jfclere/CERTS/CA/test.p12"
           sslKeyStoreType="PKCS12"
           sslTrustStore="/home/jfclere/CERTS/CA/ca.p12"
           sslTrustStoreType="PKCS12" sslTrustStorePassword="changeit"
           /&gt;</pre><p>The sslKeyStore file contains the private key and the signed
      certificate of the client certificate JBossWEB uses to connect to httpd.
      The certificate must be signed by a Cerficate Authority (CA) who
      certificate is in the conf/server-ca.crt file of the httpd</p><p>The sslTrustStore file contains the CA certificate of the CA that
      signed the certificate contained in conf/server.crt file.</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2243"/>12.1.3. mod-cluster-jboss-beans configuration part</h3></div></div></div><p>The mod-cluster-jboss-beans.xml in
      $JBOSS_HOME/server/<span class="emphasis"><em>profile</em></span>/deploy/mod-cluster.sar/META-INF
      in the ClusterConfig you are using you should have something
      like:</p><pre class="programlisting">      &lt;property name="ssl"&gt;true&lt;/property&gt;
      &lt;property name="sslKeyStorePass"&gt;changeit&lt;/property&gt;
      &lt;property name="sslKeyStore"&gt;/home/jfclere/CERTS/test.p12&lt;/property&gt;
      &lt;property name="sslKeyStoreType"&gt;pkcs12&lt;/property&gt;
      &lt;property name="sslTrustStore"&gt;/home/jfclere/CERTS/ca.p12&lt;/property&gt;
      &lt;property name="sslTrustStoreType"&gt;pkcs12&lt;/property&gt;
      &lt;property name="sslTrustStorePassword"&gt;changeit&lt;/property&gt;</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2253"/>12.1.4. How the diferent files were created</h3></div></div></div><p>The files were created using OpenSSL utilities see <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.openssl.org/">OpenSSL</a> CA.pl
      (/etc/pki/tls/misc/CA for example) has been used to create the test
      Certificate authority, the certicate requests and private keys as well
      as signing the certicate requests.</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2261"/>12.1.4.1. Create the CA</h4></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Create a work directory and work for there:</p><pre class="programlisting">    mkdir -p CERTS/Server
    cd CERTS/Server</pre></li><li><p>Create a new CA:</p><pre class="programlisting">        /etc/pki/tls/misc/CA -newca </pre><p>That creates a directory for example ../../CA that contains
            a cacert.pem file which content have to be added to the
            conf/server-ca.crt described above.</p></li></ol></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2277"/>12.1.4.2. Create the server certificate</h4></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Create a new request:</p><pre class="programlisting">        /etc/pki/tls/misc/CA -newreq </pre><p>That creates 2 files named newreq.pem and newkey.pem.
            newkey.pem is the file conf/server.key described above.</p></li><li><p>Sign the request:</p><pre class="programlisting">        /etc/pki/tls/misc/CA -signreq </pre><p>That creates a file named newcert.pem. newcert.pem is the
            file conf/server.crt described above. At that point you have
            created the SSL stuff needed for the VirtualHost in httpd. You
            should use a browser to test it after importing in the browser the
            content of the cacert.pem file.</p></li></ol></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2295"/>12.1.4.3. Create the client certificate</h4></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Create a work directory and work for there:</p><pre class="programlisting">     mkdir -p CERTS/Client
     cd CERTS/Client</pre></li><li><p>Create request and key for the JBossWEB part.</p><pre class="programlisting">/etc/pki/tls/misc/CA -newreq</pre><p>
             That creates 2 files: Request is in newreq.pem, private key is in newkey.pem
            </p></li><li><p>Sign the request.</p><pre class="programlisting">/etc/pki/tls/misc/CA -signreq</pre><p>
             That creates a file: newcert.pem</p></li><li><p>Don't use a passphrase when creating the client certicate or
            remove it before exporting:</p><pre class="programlisting">     openssl rsa -in newkey.pem -out key.txt.pem
     mv key.txt.pem newkey.pem</pre></li><li><p>Export the client certificate and key into a p12
            file.</p><pre class="programlisting">     openssl pkcs12 -export -inkey newkey.pem -in newcert.pem -out test.p12</pre><p>That is the sslKeyStore file described above
        (/home/jfclere/CERTS/CA/test.p12)</p></li></ol></div></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2328"/>12.2. Using SSL between httpd and JBossWEB</h2></div></div></div><p>Using https allows to encrypt communications betwen httpd and
    JBossWEB. But due to the ressources it needs that no advised to use it in
    high load configuration.</p><p>(See <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/community/docs/DOC-9701">Encrypting connection
    between httpd and TC</a> for detailed instructions).</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2338"/>12.3. Forwarding SSL browser informations when using http/https between
    httpd and JBossWEB</h2></div></div></div><p>When using http or https beween httpd and JBossWEB you need to use
    the SSLValve and export the SSL variable as header in the request in
    httpd. If you are using AJP, mod_proxy_ajp will read the SSL variables and
    forward them to JBossWEB automaticaly.</p><p>(See <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/community/docs/DOC-11988">Forwarding SSL
    environment when using http/https proxy</a> for detailed
    instructions).</p><p>The SSL variable used by mod_proxy_ajp are the following:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>"HTTPS" SSL indicateur.</p></li><li><p>"SSL_CLIENT_CERT" Chain of client certificates.</p></li><li><p>"SSL_CIPHER" Cipher used.</p></li><li><p>"SSL_SESSION_ID" Id of the session.</p></li><li><p>"SSL_CIPHER_USEKEYSIZE" Size of the key used.</p></li></ol></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mod_jk"/>Chapter 13. Migration from mod_jk</h2></div></div></div><p>Mod_cluster only support Apache httpd, there are no plan to support
  IIS or Iplanet.</p><p>The migration from mod_jk to mod_cluster is not very complex. Only
  very few worker properties can't be mapped to mod_cluster parameters.</p><p>Here is the table of worker properties and how to transfer them in the
  ClusterListener parameters.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th><p>mod_jk worker property</p></th><th><p>ClusterListener parameter</p></th><th><p>Remarks</p></th></tr></thead><tbody><tr><td><p>host</p></td><td><p>-</p></td><td><p>It is read from the &lt;Connector/&gt; Address
          information</p></td></tr><tr><td><p>port</p></td><td><p>-</p></td><td><p>It is read from the &lt;Connector/&gt; Port
          information</p></td></tr><tr><td><p>type</p></td><td><p>-</p></td><td><p>It is read from the &lt;Connector/&gt; Protocol
          information</p></td></tr><tr><td><p>route</p></td><td><p>-</p></td><td><p>It is read from the &lt;Engine/&gt; JVMRoute
          information</p></td></tr><tr><td><p>domain</p></td><td><p>domain</p></td><td><p>That is not supported in this version</p></td></tr><tr><td><p>redirect</p></td><td><p>-</p></td><td><p>The nodes with loadfactor = 0 are standby nodes they
          will be used no other nodes are available</p></td></tr><tr><td><p>socket_timeout</p></td><td><p>nodeTimeout</p></td><td><p>Default 10 seconds</p></td></tr><tr><td><p>socket_keepalive</p></td><td><p>-</p></td><td><p>KEEP_ALIVE os is always on in
          mod_cluster</p></td></tr><tr><td><p>connection_pool_size</p></td><td><p>-</p></td><td><p>The max size is calculated to be AP_MPMQ_MAX_THREADS+1
          (max)</p></td></tr><tr><td><p>connection_pool_minsize</p></td><td><p>smax</p></td><td><p>The defaut is max</p></td></tr><tr><td><p>connection_pool_timeout</p></td><td><p>ttl</p></td><td><p>Time to live when over smax connections. The defaut is
          60 seconds</p></td></tr><tr><td><p>-</p></td><td><p>workerTimeout</p></td><td><p>Max time to wait for a free worker default 1
          second</p></td></tr><tr><td><p>retries</p></td><td><p>maxAttempts</p></td><td><p>Max retries before returning an error Default:
          3</p></td></tr><tr><td><p>recovery_options</p></td><td><p>-</p></td><td><p>mod_cluster behave like mod_jk with value
          7</p></td></tr><tr><td><p>fail_on_status</p></td><td><p>-</p></td><td><p>Not supported</p></td></tr><tr><td><p>max_packet_size</p></td><td><p>iobuffersize/receivebuffersize</p></td><td><p>Not supported in this version. Use
          ProxyIOBufferSize</p></td></tr><tr><td><p>max_reply_timeouts</p></td><td><p>-</p></td><td><p>Not supported</p></td></tr><tr><td><p>recovert_time</p></td><td><p>-</p></td><td><p>The ClusterListener will tell (via a STATUS message)
          mod_cluster that the node is up again</p></td></tr><tr><td><p>activation</p></td><td><p>-</p></td><td><p>mod_cluster receives this information via
          ENABLE/DISABLE/STOP messages</p></td></tr><tr><td><p>distance</p></td><td><p>-</p></td><td><p>mod_cluster handles this via the loadfactor
          logic</p></td></tr><tr><td><p>mount</p></td><td><p>-</p></td><td><p>The context "mounted" automaticly via the ENABLE-APP
          messages. ProxyPass could be used too</p></td></tr><tr><td><p>secret</p></td><td><p>-</p></td><td><p>Not supported</p></td></tr><tr><td><p>connect_timeout</p></td><td><p>-</p></td><td><p>Not supported. Use ProxyTimeout or server TimeOut
          (Default 300 seconds)</p></td></tr><tr><td><p>prepost_timeout</p></td><td><p>ping</p></td><td><p>Default 10 seconds</p></td></tr><tr><td><p>reply_timeout</p></td><td><p>-</p></td><td><p>Not supported. Use ProxyTimeout or server TimeOut?
          directive (Default 300 seconds)</p></td></tr></tbody></table></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mod_proxy"/>Chapter 14. Migration from mod_proxy</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e2648">14.1. Workers</a></span></dt><dt><span class="sect1"><a href="#d0e2845">14.2. Balancers</a></span></dt></dl></div><p>As mod_cluster is a sophisticated balancer migration from mod_proxy to
  mod_cluster is strait forward. mod_cluster replaces a reverse proxy with
  loadbalancing. A reversed proxy is configured like:</p><pre class="programlisting">ProxyRequests Off
&lt;Proxy *&gt;
Order deny,allow
Allow from all
&lt;/Proxy&gt;
ProxyPass /foo http://foo.example.com/bar
ProxyPassReverse /foo http://foo.example.com/bar</pre><p>All the general proxy parameters could be used in mod_cluster they
  work like in mod_proxy, only the balancers and the workers definitions are
  slightly different.</p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2648"/>14.1. Workers</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th><p>Mod_proxy Parameter</p></th><th><p>ClusterListener parameter</p></th><th><p>Remarks</p></th></tr></thead><tbody><tr><td><p>min</p></td><td><p>-</p></td><td><p>Not supported in this version</p></td></tr><tr><td><p>max</p></td><td><p>-</p></td><td><p>mod_cluster uses mod_proxy default
            value</p></td></tr><tr><td><p>smax</p></td><td><p>smax</p></td><td><p>Same as mod_proxy</p></td></tr><tr><td><p>ttl</p></td><td><p>ttl</p></td><td><p>Same as mod_proxy</p></td></tr><tr><td><p>acquire</p></td><td><p>workerTimeout</p></td><td><p>Same as mod_proxy acquire but in
            seconds</p></td></tr><tr><td><p>disablereuse</p></td><td><p>-</p></td><td><p>mod_cluster will disable the node in case of error
            and the ClusterListener will for the reuse via the STATUS
            message</p></td></tr><tr><td><p>flushPackets</p></td><td><p>flushPackets</p></td><td><p>Same as mod_proxy</p></td></tr><tr><td><p>flushwait</p></td><td><p>flushwait</p></td><td><p>Same as mod_proxy</p></td></tr><tr><td><p>keepalive</p></td><td><p>-</p></td><td><p>Always on: OS KEEP_ALIVE is always used. Use
            connectionTimeout in the &lt;Connector&gt; if
            needed</p></td></tr><tr><td><p>lbset</p></td><td><p>-</p></td><td><p>Not supported</p></td></tr><tr><td><p>ping</p></td><td><p>ping</p></td><td><p>Same as mod_proxy Default value 10
            seconds</p></td></tr><tr><td><p>lbfactor</p></td><td><p>-</p></td><td><p>The load factor is received by mod_cluster from a
            calculated value in the ClusterListener</p></td></tr><tr><td><p>redirect</p></td><td><p>-</p></td><td><p>Not supported lbfactor sent to 0 makes a standby
            node</p></td></tr><tr><td><p>retry</p></td><td><p>-</p></td><td><p>ClusterListener will test when the node is back
            online</p></td></tr><tr><td><p>route</p></td><td><p>JVMRoute</p></td><td><p>In fact JBossWEB via the JVMRoute in the Engine will
            add it</p></td></tr><tr><td><p>status</p></td><td><p>-</p></td><td><p>mod_cluster has a finer status handling: by context
            via the ENABLE/STOP/DISABLE/REMOVE application messages.
            hot-standby is done by lbfactor = 0 and Error by lbfactor = 1 both
            values are sent in STATUS message by the
            ClusterListener</p></td></tr><tr><td><p>timeout</p></td><td><p>nodeTimeout</p></td><td><p>Default wait for ever
            (http://httpd.apache.org/docs/2.2/mod/mod_proxy.html is wrong
            there)</p></td></tr><tr><td><p>ttl</p></td><td><p>ttl</p></td><td><p>Default 60 seconds</p></td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2845"/>14.2. Balancers</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th><p>Mod_proxy Parameter</p></th><th><p>ClusterListener parameter</p></th><th><p>Remarks</p></th></tr></thead><tbody><tr><td><p>lbmethod</p></td><td><p>-</p></td><td><p>There is only one load balancing method in
            mod_cluster "cluster_byrequests"</p></td></tr><tr><td><p>maxattempts</p></td><td><p>maxAttempts</p></td><td><p>Default 3</p></td></tr><tr><td><p>nofailover</p></td><td><p>stickySessionForce</p></td><td><p>Same as in mod_proxy</p></td></tr><tr><td><p>stickysession</p></td><td><p>StickySessionCookie/StickySessionPath</p></td><td><p>The 2 parameters in the ClusterListener are combined
            in one that behaves like in mod_proxy</p></td></tr><tr><td><p>timeout</p></td><td><p>workerTimeout</p></td><td><p>Default 1 seconds</p></td></tr></tbody></table></div><p/></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="demo"/>Chapter 15. Load Balancing Demo Application</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e2916">15.1. Overview</a></span></dt><dt><span class="sect1"><a href="#d0e2940">15.2. Basic Usage</a></span></dt><dt><span class="sect1"><a href="#client-config">15.3. Client Driver Configuration Options</a></span></dt><dt><span class="sect1"><a href="#load-generation">15.4. Load Generation Scenarios</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2916"/>15.1. Overview</h2></div></div></div><p>The mod_cluster distribution includes a demo application that helps
    demonstrate how different server-side scenarios affect the routing of
    client requests by the load balancer. The demo application is located in
    the mod_cluster distribution's demo directory.</p><p>The demo application consists of two components:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>The first component is a war file that needs to be deployed in
        JBossWeb/Tomcat/JBoss AS. The war includes a number of
        servlets:</p></li><li><p>The second component is a GUI application that allows a user to
        launch a pool of threads that repeatedly make requests to the load
        balancer. The requests are ultimately routed to the demo war's primary
        servlet. The application tracks which servers are handling the
        requests and displays this information in a chart.</p><p>The application can also send separate requests to the demo
        war's load generation servlets, allowing the user to see how different
        load conditions affect the balancing of requests.</p></li></ol></div><p>Note that the demo application does not actually depend on
    mod_cluster in any way. Its only dependency is on JBossWeb/Tomcat.
    <sup>[<a id="d0e2934" href="#ftn.d0e2934">1</a>]</sup>So, the demo could be used to demonstrate the effect of
    different server-side scenarios on the routing decisions made by any load
    balancer, including mod_jk, mod_proxy or the various hardware load
    balancers.</p><p>Note also that this demo application is not intended to be used as a
    load testing tool; i.e. something that can demonstrate the maximum load a
    cluster configuration can handle. Using it as such has a good chance of
    showing you the maximum load the client can generate rather than the
    maximum load your cluster can handle.</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2940"/>15.2. Basic Usage</h2></div></div></div><p>To run the demo application:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p><a id="first"/>Unpack the mod_cluster distribution on your
        filesystem. Here we assume it has been unzipped to
        /home/bes/mod_cluster or C:\mod_cluster.</p></li><li><p>Install mod_cluster into your httpd server as described at
        <a href="#nativeinstall" title="Chapter 5. Installation of the httpd part">Installation
        of the httpd part</a></p></li><li><p>Install mod_cluster into your JBossAS/JBossWeb/Tomcat servers as
        described at <a href="#javainstall" title="Chapter 10. Installation of the java part">Installation
        on the Java side</a></p></li><li><p>Start httpd and your JBossAS/JBossWeb/Tomcat servers</p></li><li><p>Deploy the load-demo.war found in the distribution's demo/server
        folder to your JBossAS/JBossWeb/Tomcat servers.</p></li><li><p>Start the demo application:</p><div class="orderedlist"><ol><li><p>On *nix:</p><pre class="programlisting">[bes@besdev ~]$ cd /home/bes/mod_cluster/demo/client
[bes@besdev mod_cluster]$ ./run-demo.sh</pre></li><li><p>On Windows:</p><pre class="programlisting">C:\&gt;cd mod_cluster\demo\client
C:\mod_cluster\demo\client&gt;run-demo</pre></li></ol></div><p/><div class="mediaobject" align="center"><img src="images/demo-client-control.jpg" align="middle"/></div></li><li><p>Configure the hostname and address of the httpd server, the
        number of client threads, etc and click the "Start" button. See <a href="#client-config" title="15.3. Client Driver Configuration Options">Client
        Driver Configuration Options</a> for details on the configuration
        options.</p></li><li><p>Switch to the "Request Balancing" tab to see how many requests
        are going to each of your JBossAS/JBossWeb/Tomcat servers:</p></li><li><p>Switch to the "Session Balancing" tab to see how many active
        sessions<a href="#"><sup>[</sup></a><a id="d0e3000" href="#ftn.d0e3000">2</a><a href="#"><sup>]</sup></a>are being hosted by each of your
        JBossAS/JBossWeb/Tomcat servers:</p></li><li><p>Stop some of your JBossAS/JBossWeb/Tomcat servers and/or
        undeploy the load-demo.war from some of the servers and see the effect
        this has on load balancing.</p></li><li><p>Restart some of your JBossAS/JBossWeb/Tomcat servers and/or
        re-deploy the load-demo.war to some of the servers and see the effect
        this has on load balancing.</p></li><li><p>Experiment with adding artificial load to one or more servers to
        see what effect that has on load balancing. See <a href="#load-generation" title="15.4. Load Generation Scenarios">Load
        Generation Scenarios</a> for details.</p></li></ol></div><p>Most of the various panels in application interface also present
    information on the current status on any client threads. "Total Clients"
    is the number of client threads created since the last time the "Start"
    button was pushed. "Live Clients" is the number of threads currently
    running. "Failed Clients" is the number of clients that terminated
    abnormally; i.e. made a request that resulted in something other than an
    HTTP 200 response.</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="client-config"/>15.3. Client Driver Configuration Options</h2></div></div></div><p>The configuration of the client is driver is done via the
    application's "Clent Control" tab:</p><div class="mediaobject" align="center"><img src="images/demo-client-control.jpg" align="middle"/></div><p>The panel includes the following options:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Proxy Hostname: Hostname of the load balancer or the IP address
        on which it is listening for requests<sup>[<a id="d0e3033" href="#ftn.d0e3033">3</a>]</sup></p></li><li><p>Proxy Port: Port on which the load balancer is listening for
        requests<sup>[<a id="d0e3039" href="#ftn.d0e3039">4</a>]</sup></p></li><li><p>Context Path: Portion of the request URL that specifies the
        request is for the load-demo.war</p></li><li><p>Session Life: Number of seconds a client thread should use a
        session before invalidating or abandoning it. Generally it is good to
        keep this to a small value; otherwise the use of session stickiness
        will prevent changes in server load from affecting the load balancer's
        routing decisions. With sticky sessions enabled (strongly
        recommended), it is the creation of a new session that allows the load
        balancer to try to balance load.</p></li><li><p>Invalidate: Controls what the client thread should do when it
        stops using a session because Session Life has passed. If checked, the
        driver will send a request that results in the session being
        invalidated. If unchecked, the session will just be abandoned, and
        will continue to exist on the server until Session Timeout seconds
        have passed. (In the future this will likely be changed to a
        percentage input, so X% can be invalidated, the rest
        abandoned.)</p></li><li><p>Session Timeout: Number of seconds a session can remain unused
        before the server is free to expire it. Unchecking Invalidate and
        setting a high value relative to Session Life allows a significant
        number of unused sessions to accumulate on the server.</p></li><li><p>Num Threads: Number of client threads to launch. Each thread
        repeatedly makes requests until the "Stop" button is pushed or a
        request receives a response other than HTTP 200.</p></li><li><p>Sleep Time: Number of ms the client threads should sleep between
        requests.</p></li><li><p>Startup Time: Number of seconds over which the application
        should stagger the start of the client threads. Staggering the start
        is advised as it avoids the unnatural situation where for the life of
        the demonstation all sessions start at about the same time and then
        are invalidated or abandoned at the same time. Staggering the start
        allows the load balancer to continually see new sessions and decide
        how to route them.</p></li></ol></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="load-generation"/>15.4. Load Generation Scenarios</h2></div></div></div><p>You can use the application's GUI to instruct individual servers to
    artificially generate various types of load, and then track how that load
    affects request and session balancing. Load generation is controlled via
    the application's "Server Load Control" tab:</p><div class="mediaobject" align="center"><img src="images/demo-server-load.jpg" align="middle"/></div><p>The panel includes the following options:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Target Hostname and Target Port: The hostname or IP address of
        the server on which you want load generated. There are two strategies
        for setting these:</p><div class="orderedlist"><ol><li><p>You can use the hostname and port of the load balancer, in
            which case the load balancer will pick a backend server and route
            the request to it. Note the client application does not maintain a
            session cookie for these requests, so if you invoke another server
            load generation request, you shouldn't expect the same server to
            handle it.</p></li><li><p>If the JBoss AS/JBossWeb/Tomcat servers are running the
            HttpConnector as well as the AJP connector, you can specify the
            address and port on which a particular server's HttpConnector is
            listening. The standard port is 8080.</p></li></ol></div></li><li><p>Load Creation Action: Specifies the type of load the target
        server should generate. See below for details on the available load
        types.</p></li><li><p>Params: Zero or more parameters to pass to the specified load
        creation servlet. For example, in the screenshot above, Number of
        Connections and Duration. How many parameters are displayed, their
        name and their meaning depend on the selected Load Creation Action.
        The label for each parameter includes a tooltip that explains its
        use.</p><p>The available Load Creation Actions are as follows:</p><p>1. Active Sessions: Generates server load by causing session
        creation on the target server.</p><p>2. Datasource Use: Generates server load by taking connections
        from the java:DefaultDS datasource for a period1</p><p>3. Connection Pool Use: Generates server load by tieing up
        threads in the webserver connections pool for a period</p><p>4. Heap Memory Pool Use: Generates server load by filling 50% of
        free heap memory for a period</p><p>5. CPU Use: Generates server CPU load by initiating a tight loop
        in a thread</p><p>6. Server Receive Traffic: Generates server traffic receipt load
        by POSTing a large byte array to the server once per second for a
        period</p><p>7. Server Send Traffic: Generates server traffic send load by
        making a request once per second to which the server responds with a
        large byte array</p><p>8. Request Count: Generates server load by making numerous
        requests, increasing the request count on the target server.</p></li></ol></div></div><div xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="footnotes"><br/><hr/><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p><sup>[<a id="ftn.d0e2934" href="#d0e2934">1</a>] </sup>The demo's "Datasource Use" load generation scenario requires
        the use of JBoss Application Server.</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p><sup>[<a id="ftn.d0e3000" href="#d0e3000">2</a>] </sup>For purposes of this chart, a session is considered "active"
            if a client thread will ever again send a request associated with
            the session. When client threads stop using a session, they can
            either send a request to invalidate it or just abandon it by no
            longer including its session cookie in requests. After a session
            is abandoned, it will not be reflected in the "Session Balancing"
            chart, but it will continue to exist on the JBossWeb/Tomcat/JBoss
            AS server until it is removed due to timeout.</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p><sup>[<a id="ftn.d0e3033" href="#d0e3033">3</a>] </sup>The default value for this field is controlled by the
            mod_cluster.proxy.host system property, or localhost if not set.
            Editing the run-demo.sh or run-demo.bat file to change the
            -Dmod_cluster.proxy.host=localhost passed to java will allow you
            to avoid re-typing this value every time you launch the demo
            application.</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p><sup>[<a id="ftn.d0e3039" href="#d0e3039">4</a>] </sup>The default value for this field is controlled by the
            mod_cluster.proxy.port system property, or 8000 if not set.
            Editing the run-demo.sh or run-demo.bat file to change the
            -Dmod_cluster.proxy.port=8000 passed to java will allow you to
            avoid re-typing this value every time you launch the demo
            application.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="changelog"/>Chapter 16. Change Log</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e3112">16.1. 1.0.10 (14 April 2011)</a></span></dt><dt><span class="sect1"><a href="#d0e3223">16.2. 1.0.9 (17 March 2011)</a></span></dt><dt><span class="sect1"><a href="#d0e3289">16.3. 1.0.8 (15 Feb 2011)</a></span></dt><dt><span class="sect1"><a href="#d0e3310">16.4. 1.0.7 (not released)</a></span></dt><dt><span class="sect1"><a href="#d0e3361">16.5. 1.0.6 (05 January 2011)</a></span></dt><dt><span class="sect1"><a href="#d0e3427">16.6. 1.0.5 (23 November 2010)</a></span></dt><dt><span class="sect1"><a href="#d0e3523">16.7. 1.0.4 (27 July 2010)</a></span></dt><dt><span class="sect1"><a href="#d0e3694">16.8. 1.0.3.GA (15 January 2010)</a></span></dt><dt><span class="sect1"><a href="#d0e3820">16.9. 1.0.2.GA (20 August 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e3976">16.10. 1.0.1.GA (29 July 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e4117">16.11. 1.0.0.GA (29 May 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e4183">16.12. 1.0.0.CR2 (29 April 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e4279">16.13. 1.0.0.CR1 (24 March 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e4420">16.14. 1.0.0.Beta4 (14 Feb 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e4606">16.15. 1.0.0.Beta3 (31 Jan 2009)</a></span></dt><dt><span class="sect1"><a href="#d0e4747">16.16. 1.0.0.Beta2 (12 Dec 2008)</a></span></dt><dt><span class="sect1"><a href="#d0e4888">16.17. 1.0.0.Beta1 (05 Nov 2008)</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3112"/>16.1. 1.0.10 (14 April 2011)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Apache with mod_cluster refuses to start at first, after 7 retries it starts up (MODCLUSTER-120) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>NPE when overriding default load metric in ModClusterListener (MODCLUSTER-183) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Only 100 webapps are detected : Maxcontext doesn't seem to be read (MODCLUSTER-221) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>when using tomcat manager webapp to stop/start an application the start is ignored by mod_cluster (MODCLUSTER-224) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Tomcat6 throws java.lang.NoSuchMethodError instead a localised error messages. (MODCLUSTER-228) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Add a note explaining where Maxcontext must be put in httpd.conf and error when it is in wrong place. (MODCLUSTER-225) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Make mod_cluster manager tolerant to F5 page refresh when disabled context. (MODCLUSTER-218) (jfclere)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3223"/>16.2. 1.0.9 (17 March 2011)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Query strings are not forwarded to nodes. (MODCLUSTER-118) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>memory usage growning. (MODCLUSTER-214) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>mod_rewrite PT doesn't work. (MODCLUSTER-213) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>UseAlias broken. (MODCLUSTER-212) (jfclere)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3289"/>16.3. 1.0.8 (15 Feb 2011)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>mod_cluster failover does not work for a /webappcontext when the / root context exists REOPENED. (MODCLUSTER-188) (jfclere)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3310"/>16.4. 1.0.7 (not released)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>STATUS should retry the worker even if there was an error before. (MODCLUSTER-133) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>httpd cores after graceful restart after the mod_cluster configuration is added (MODCLUSTER-206) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>mod_cluster 1.0.0 docs step 12.1.4.3. is wrong (MODCLUSTER-193) (jfclere)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3361"/>16.5. 1.0.6 (05 January 2011)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Regressions caused by MODCLUSTER-190 (MODCLUSTER-190) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Default maxAttempts set to -1 instead of 1 (MODCLUSTER-200) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>OK STATUS MCMP messages are send before the connector is started (MODCLUSTER-202) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Quotes in jsessionId causing sticky sessions to fail (MODCLUSTER-203) (jfclere)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3427"/>16.6. 1.0.5 (23 November 2010)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Alias max length too low (MODCLUSTER-173) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Advertise not configured error message in log is actually a warning (MODCLUSTER-176) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>mod_cluster failover does not work for a /webappcontext when the / root context exists (MODCLUSTER-188) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>mod_cluster issues an ENABLE-APP too early in the webapp lifecycle (MODCLUSTER-190) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>mod_cluster-manager does not update when a node is taken down (MODCLUSTER-195) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Incorrect routing of requests when one context root is the prefix of another (MODCLUSTER-196) (jfclere)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3523"/>16.7. 1.0.4 (27 July 2010)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/doc.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Separate 1.0.x doc from 1.1.x (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Advertise does not work on name-based virtual hosts (MODCLUSTER-122) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Microcontainer does not choose the right constructor when creating RequestCountLoadMetric (MODCLUSTER-126) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>proxy_cluster_isup: Can't find worker for 2 (just after CONFIG). (MODCLUSTER-149) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>SystemMemoryUsageLoadMetric returns wrong load metric. (MODCLUSTER-157) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>ManagerBalancerName doesn't work. (MODCLUSTER-163) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Fix class name of MBeanAttributeRatioLoadMetric in MC config (MODCLUSTER-174) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Wrong configuration could cause a core (MODCLUSTER-175) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>ping and nodeTimeout interact. (MODCLUSTER-180) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Add a solaris10 64 bits sparc in the bundles. (MODCLUSTER-137) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Avoid unnecessary open sockets for non-master nodes (MODCLUSTER-158) (pferraro)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3694"/>16.8. 1.0.3.GA (15 January 2010)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>HAModClusterService can throw NullPointerExceptions after a partition merge. (MODCLUSTER-85) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>random 404 errors on increasing load. (MODCLUSTER-102) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>random 404 errors on increasing load. (MODCLUSTER-102) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Advertise security key verification does not work. (MODCLUSTER-104) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>load-demo.war specifies non-existent servlet in web.xml. (MODCLUSTER-113) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>AdvertiseBindAddress does not default to the 23364 port. (MODCLUSTER-119) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Mod_cluster does support more that 3 Alias in Host. (MODCLUSTER-121) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/doc.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Advertise does not work on name-based virtual hosts. (MODCLUSTER-122) (jfclere)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3820"/>16.9. 1.0.2.GA (20 August 2009)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Update httpd to 2.2.13. (MODCLUSTER-93) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>DISABLED applications act as STOPPED. (MODCLUSTER-96) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>getProxyInfo failed when there are too many nodes. (MODCLUSTER-94) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>mod_cluster_manager displays zeros instead values on Linux 32 bits. (MODCLUSTER-98) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>mod_cluster_manager doesn't seem to ENABLE/DISABLE the right context. (MODCLUSTER-99) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Load balancing logic doesn't allow manual demo of load-balancing: it seems to go always to the first nodes. (MODCLUSTER-100) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Alias from webapps/jboss-web.xml are not handled correctly in mod_cluster. (MODCLUSTER-89) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>mod_cluster-manager display corrupted when jboss is starting. (MODCLUSTER-95) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>ClassCastException upon redeploy after mod-cluster-jboss-beans.xml modification. (MODCLUSTER-88) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>admin-console should be in the excludedContexts. (MODCLUSTER-87) (pferraro)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3976"/>16.10. 1.0.1.GA (29 July 2009)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Fail-over from cleanly shutdown nodes ignores the domain information (MODCLUSTER-82) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Add logic to support Alias (in server.xml) and NameVirtualHost (in httpd.conf) (MODCLUSTER-77) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>mod_cluster-manager: disabling a worker / domain (MODCLUSTER-50) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>mod_cluster-manager: disabling a worker / domain (MODCLUSTER-50) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Allow static content to be served from proxy's local filesystem. (MODCLUSTER-37) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>httpd crashes when you try to reach an application disabled via /mod_cluster-manager. (MODCLUSTER-80) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Disabled application gets request without sessionid. (MODCLUSTER-81) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Add support for JBossAS 4.2.x (documentation) (MODCLUSTER-78) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Add INFO and DUMP in the mod_cluster-manager. Partialy MODCLUSTER-79 (jfclere)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4117"/>16.11. 1.0.0.GA (29 May 2009)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Allow to use mod_balancer syntax like ProxyPass / balancer://mycluster in httpd VirtualHosts (MODCLUSTER-75) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Add AdvertiseBindAddress to specify the bind address of the Advertise logic on httpd (MODCLUSTER-76) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Fixed serialization regression with some rpc response content when in clustered mode. (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Various fixes to load simulation section of demo application. (pferraro)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4183"/>16.12. 1.0.0.CR2 (29 April 2009)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Add ability to disable/enable all/individual apps from mod_cluster-manager status page (MODCLUSTER-69) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Add ability to disable/enable individual webapp via JMX (MODCLUSTER-68) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>openssl doesn't build on some platforms, update to 0.9.8k (MODCLUSTER-70) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>httpd crashes on windows when you kill JBoss AS (MODCLUSTER-67)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Advertise worker thread can throw NullPointerException (MODCLUSTER-73) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Simplify rpc response objects (pferraro)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4279"/>16.13. 1.0.0.CR1 (24 March 2009)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Add Bundle with only the modules libraries (MODCLUSTER-28) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Windows bundles broken (MODCLUSTER-58) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Mod_cluster-manager status page reports wrong information (MODCLUSTER-64) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Undeploy an app or shut down server, clients with an existing session do not fail over. (MODCLUSTER-63) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>httpd.worker is a shell script (MODCLUSTER-56) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>update compoment bundle (httpd-2.2.11, openssl-0.9.8j and jk-1.2.27) (MODCLUSTER-55) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>HAModClusterService unnecessarily updates DRM each status cycle even if nothing changed (MODCLUSTER-60) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Fixed heap usage load metric when max heap is undefined. (MODCLUSTER-62) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Fixed advertise listener's pause/resume logic.</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4420"/>16.14. 1.0.0.Beta4 (14 Feb 2009)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Remove incompatible mod_proxy_balancer from bundles (MODCLUSTER-46) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Rename mod_sharedmem.so to mod_slotmem.so in win32/64 bundles (MODCLUSTER-45) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Prevent Advertise to send bad X-Manager-Address when miss configured (MODCLUSTER-49) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Prevent Advertise to send bad X-Manager-Address when miss configured (MODCLUSTER-49) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Fix Advertise on win32/64 (MODCLUSTER-41) (mturk)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Error state recording in ClusteredMCMPHandler can cause unnecessary reset requests (MODCLUSTER-53) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>mod_manager core on hp-ux (MODCLUSTER-43) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Add missing mod_proxy_cluster.so in hp-ux (MODCLUSTER-42) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Remove request session information when the response contains another session (MODCLUSTER-44) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Fix AJP connector detection (TC6 jk connector weren't detected) (MODCLUSTER-52) (pferraro/jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Forward unparsed uri to the node (instead a parsed one without query string) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Master node enters tight loop calling getClusterCoordinatorState on remote node (MODCLUSTER-47) (pferraro)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4606"/>16.15. 1.0.0.Beta3 (31 Jan 2009)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Add a handler (mod_cluster-manager) to display node status in httpd (MODCLUSTER-27) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>exclude specific webapps from mod_cluster httpd registration (MODCLUSTER-22) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>change the default value for Maxnode to 20 (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Add a system property for specifying the proxyList (MODCLUSTER-36) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>fix the vhost corruption (MODCLUSTER-31) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>fix the win32/win64 build for the missing *.so files (MODCLUSTER-40) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Allow empty proxyList (MODCLUSTER-38) (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>advertisePort in {HA}ModClusterService default is wrong (MODCLUSTER-30) (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>ActiveSessionsLoadMetric throws AttributeNotFoundException with distributable application (MODCLUSTER-29) (pferraro)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4747"/>16.16. 1.0.0.Beta2 (12 Dec 2008)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>update httpd to 2.2.10. (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>update openssl to 0.9.8i. (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Arrange mpm worker reslist logic. (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Improve integration of the test with the httpd. (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Fixed shutdown event handling. (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Separated configuration for clustered and non-clustered mode. (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Change the retry logic when sending to httpd: resend the message when read failed. (jfclere)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Refactored JBoss Web integration points (listeners/services). (pferraro)</p>
            </td></tr><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Added support for dynamic load balancing in JBoss Web standalone/Tomcat. (pferraro)</p>
            </td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4888"/>16.17. 1.0.0.Beta1 (05 Nov 2008)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
               <p>
                  </p><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div><p>
               </p>
            </td><td>
               <p>Initial beta release for use with JBossAS-5.0.x, JBossWEB-2.1.x and Tomcat-6.0.x.</p>
            </td></tr></tbody></table></div><p/></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="faq"/>Chapter 17. Frequently Asked questions</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e4913">17.1. What is Advertise</a></span></dt><dt><span class="sect1"><a href="#d0e4950">17.2. What to do if I don't want to use Advertise (multicast):</a></span></dt><dt><span class="sect1"><a href="#d0e4962">17.3. I am using Tomcat 7 / 6 what should I do:</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4913"/>17.1. What is Advertise</h2></div></div></div><p>Advertise allows autodiscovery of httpd proxies by the cluster nodes. It is done by sending multicast messages from httpd to the cluster. The httpd specialized module: mod_advertise sends UDP message on a multicast group, both mod_advertise and the cluster listener joined the multicast group and the cluster receives the messages.</p><p>Example for mod_advertise message:</p><p>HTTP/1.0 200 OK</p><p> Date: Wed, 08 Apr 2009 12:26:32 GMT</p><p> Sequence: 16</p><p> Digest: f2d5f806a53effa6c67973d2ddcdd233</p><p> Server: 1b60092e-76f3-49fd-9f99-a51c69c89e2d</p><p> X-Manager-Address: 127.0.0.1:6666</p><p> X-Manager-Url: /bla</p><p> X-Manager-Protocol: http</p><p> X-Manager-Host: 10.33.144.3</p><p/><p>The X-Manager-Address header value is used by the cluster logic to send information about the cluster to the proxy. It is the IP and port of the VirtualHost where mod_advertise is configured or URL parameter of the ServerAdvertise directive.</p><p>See <a href="#advertise">Proxy Discovery</a> in Configuration Properties and mod_advertise in Apache httpd configuration.</p><p/></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4950"/>17.2. What to do if I don't want to use Advertise (multicast):</h2></div></div></div><p>In the VirtualHost receiving the MCPM of httpd.conf don't use any
    Advertise directive or use:</p><pre class="programlisting">ServerAdvertise Off</pre><p>In mod_cluster-jboss-beans.xml add the addresses and ports of the
    VirtualHost to the proxyList property and set advertise to false, for
    example:</p><pre class="programlisting">&lt;property name="proxyList"&gt;10.33.144.3:6666,10.33.144.1:6666&lt;/property&gt;

&lt;property name="advertise"&gt;false&lt;/property&gt;</pre></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4962"/>17.3. I am using Tomcat 7 / 6 what should I do:</h2></div></div></div><p>See at the end of <a href="#javaconf" title="Chapter 6. java configuration">java configuration</a>
    You can't use the mod_cluster clustered mode with Tomcat so you get a
    loadbalancing logic similar to mod_jk but with a dynamic
    configuration.</p></div></div></div></body></html>