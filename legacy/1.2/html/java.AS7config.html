<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 7. AS7 modcluster subsystem Configuration</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="mod_cluster Documentation"/><link rel="up" href="index.html" title="mod_cluster Documentation"/><link rel="prev" href="java.config.html" title="Chapter 6. Server-side Configuration"/><link rel="next" href="java.building.html" title="Chapter 8. Building Server-Side Components"/></head><body><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="java.config.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="java.building.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="java.AS7config"/>Chapter 7. AS7 modcluster subsystem Configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="java.AS7config.html#ModClusterSubSystem">7.1. ModCluster Subsystem in JBoss AS7</a></span></dt><dt><span class="section"><a href="java.AS7config.html#ModClusterSubSystemMiniConfiguration">7.2. ModCluster Subsystem minimal configuration</a></span></dt><dt><span class="section"><a href="java.AS7config.html#ModClusterSubSystemConfiguration">7.3. ModCluster Subsystem configuration</a></span></dt><dd><dl><dt><span class="section"><a href="java.AS7config.html#AS7ModClusterConfig">7.3.1. mod-cluster-config Attributes</a></span></dt><dt><span class="section"><a href="java.AS7config.html#SimpleLoadProvider">7.3.2. simple-load-provider Attributes</a></span></dt><dt><span class="section"><a href="java.AS7config.html#DynamicLoadProvider">7.3.3. dynamic-load-provider Attributes</a></span></dt><dt><span class="section"><a href="java.AS7config.html#LoadMetric">7.3.4. load-metric Configuration</a></span></dt><dt><span class="section"><a href="java.AS7config.html#CustomLoadMetric">7.3.5. custom-load-metric Configuration</a></span></dt><dt><span class="section"><a href="java.AS7config.html#UsingJBossConsole">7.3.6. load-metric Configuration with the jboss admin console</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ModClusterSubSystem"/>7.1. ModCluster Subsystem in JBoss AS7</h2></div></div></div><p>The mod_cluster integration is done via the modcluster subsystem. In AS7 only 1.1.x is supported.
          Addition HA is not supported in AS version 7.0.x but in it will be in version 7.1.x and after.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ModClusterSubSystemMiniConfiguration"/>7.2. ModCluster Subsystem minimal configuration</h2></div></div></div><p>The minimal configuration is having the modcluster <code class="code">schemaLocation</code> in the <code class="code">schemaLocation</code> list:
    </p><pre class="programlisting">urn:jboss:domain:modcluster:1.0 jboss-mod-cluster.xsd</pre><p>
    and the <code class="code">extension module</code> in the <code class="code">extensions</code> list:
    </p><pre class="programlisting">&lt;extension module="org.jboss.as.modcluster"/&gt;</pre><p>
    and <code class="code">subsystem</code> declaration like:
    </p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:modcluster:1.0"/&gt;</pre><p>
    With that configuration modcluster will listen for advertise on <code class="code">224.0.1.105:23364</code> use the <code class="code">simple-load-provider</code> with
    a load factor of 1.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ModClusterSubSystemConfiguration"/>7.3. ModCluster Subsystem configuration</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="AS7ModClusterConfig"/>7.3.1. mod-cluster-config Attributes</h3></div></div></div><p>The attributs correspond to the <a href="java.properties.html" title="Chapter 9. Server-side Configuration Properties">properties</a>
       </p><p>Proxy Discovery Configuration</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>Property</th><th>Default</th></tr></thead><tbody><tr><td>proxy-list</td><td>proxyList</td><td><span class="emphasis"><em>None</em></span></td></tr><tr><td>proxy-url</td><td>proxyURL</td><td><span class="emphasis"><em>None</em></span></td></tr><tr><td>advertise</td><td>advertise</td><td><span class="emphasis"><em>true</em></span></td></tr><tr><td>advertise-security-key</td><td>advertiseSecurityKey</td><td><span class="emphasis"><em>None</em></span></td></tr><tr><td>excluded-contexts</td><td>excludedContexts</td><td><span class="emphasis"><em>None</em></span></td></tr><tr><td>auto-enable-contexts</td><td>autoEnableContexts</td><td><span class="emphasis"><em>true</em></span></td></tr><tr><td>stop-context-timeout</td><td>stopContextTimeout</td><td><span class="emphasis"><em>10 seconds (in seconds)</em></span></td></tr><tr><td>socket-timeout</td><td>nodeTimeout</td><td><span class="emphasis"><em>20 seconds (in milli seconds)</em></span></td></tr></tbody></table></div><p>Proxy Configuration</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>Property</th><th>Default</th></tr></thead><tbody><tr><td>sticky-session</td><td>stickySession</td><td><span class="emphasis"><em>true</em></span></td></tr><tr><td>sticky-session-remove</td><td>stickySessionRemove</td><td><span class="emphasis"><em>false</em></span></td></tr><tr><td>sticky-session-force</td><td>stickySessionForce</td><td><span class="emphasis"><em>true</em></span></td></tr><tr><td>node-timeout</td><td>workerTimeout</td><td><span class="emphasis"><em>-1</em></span></td></tr><tr><td>max-attempts</td><td>maxAttempts</td><td><span class="emphasis"><em>1</em></span></td></tr><tr><td>flush-packets</td><td>flushPackets</td><td><span class="emphasis"><em>false</em></span></td></tr><tr><td>flush-wait</td><td>flushWait</td><td><span class="emphasis"><em>-1</em></span></td></tr><tr><td>ping</td><td>ping</td><td><span class="emphasis"><em>10</em></span></td></tr><tr><td>smax</td><td>smax</td><td><span class="emphasis"><em>-1</em></span> it uses default value</td></tr><tr><td>ttl</td><td>ttl</td><td><span class="emphasis"><em>-1</em></span> it uses default value</td></tr><tr><td>domain</td><td>loadBalancingGroup</td><td><span class="emphasis"><em>None</em></span></td></tr><tr><td>load-balancing-group</td><td>loadBalancingGroup</td><td><span class="emphasis"><em>None</em></span></td></tr></tbody></table></div><p>SSL Configuration</p><p>SSL configuration part needs to be added here too</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="SimpleLoadProvider"/>7.3.2. simple-load-provider Attributes</h3></div></div></div><p>The simple load provider always send the same load factor. That is the default one. Example:</p><pre class="programlisting">
&lt;subsystem xmlns="urn:jboss:domain:modcluster:1.0"&gt;
  &lt;mod-cluster-config&gt;
    &lt;simple-load-provider load="1"/&gt;
  &lt;/mod-cluster-config&gt;
&lt;/subsystem&gt;
     </pre><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>Property</th><th>Default</th></tr></thead><tbody><tr><td>factor</td><td>LoadBalancerFactor</td><td><span class="emphasis"><em>1</em></span></td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="DynamicLoadProvider"/>7.3.3. dynamic-load-provider Attributes</h3></div></div></div><p>The dynamic load provide allows to have <code class="code">load-metric</code> as well as <code class="code">custom-load-metric</code> defined. For example:</p><pre class="programlisting">
&lt;subsystem xmlns="urn:jboss:domain:modcluster:1.0"&gt;
  &lt;mod-cluster-config advertise-socket="mod_cluster"&gt;
    &lt;dynamic-load-provider history="10" decay="2"&gt;
       &lt;load-metric type="cpu" weight="2" capacity="1"/&gt;
       &lt;load-metric type="sessions" weight="1" capacity="512"/&gt;
       &lt;custom-load-metric class="mypackage.myclass" weight="1" capacity="512"&gt;
          &lt;property name="myproperty" value="myvalue" /&gt;
          &lt;property name="otherproperty" value="othervalue" /&gt;
       &lt;/custom-load-metric&gt;
    &lt;/dynamic-load-provider&gt;
  &lt;/mod-cluster-config&gt;
&lt;/subsystem&gt;
     </pre><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>Property</th><th>Default</th></tr></thead><tbody><tr><td>history</td><td>history</td><td>512</td></tr><tr><td>decay</td><td>decayFactor</td><td>512</td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="LoadMetric"/>7.3.4. load-metric Configuration</h3></div></div></div><p>The load-metric are the "classes" collecting information to allow computation of the load factor sent to httpd</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>Property</th><th>Default</th></tr></thead><tbody><tr><td>type</td><td>A Server-Side Load Metrics</td><td><span class="emphasis"><em>Mandatory</em></span></td></tr><tr><td>weight</td><td>weight</td><td><span class="emphasis"><em>9</em></span></td></tr><tr><td>capacity</td><td>capacity</td><td><span class="emphasis"><em>512</em></span></td></tr></tbody></table></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="CustomLoadMetricType"/>7.3.4.1. Supported load metric types</h4></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th>type</th><th>Corresponding Server-Side Load Metric</th></tr></thead><tbody><tr><td>cpu</td><td><a href="java.load.html#AverageSystemLoadMetric" title="10.2.1. AverageSystemLoadMetric">AverageSystem</a>LoadMetric</td></tr><tr><td>mem</td><td><a href="java.load.html#SystemMemoryUsageLoadMetric" title="10.2.2. SystemMemoryUsageLoadMetric">SystemMemoryUsage</a>LoadMetric</td></tr><tr><td>heap</td><td><a href="java.load.html#HeapMemoryUsageLoadMetric" title="10.2.3. HeapMemoryUsageLoadMetric">HeapMemoryUsage</a>LoadMetric</td></tr><tr><td>sessions</td><td><a href="java.load.html#ActiveSessionsLoadMetric" title="10.1.1. ActiveSessionsLoadMetric">ActiveSessions</a>LoadMetric</td></tr><tr><td>requests</td><td><a href="java.load.html#RequestCountLoadMetric" title="10.1.5. RequestCountLoadMetric">ActiveSessions</a>LoadMetric</td></tr><tr><td>send-traffic</td><td><a href="java.load.html#SendTrafficLoadMetric" title="10.1.4. SendTrafficLoadMetric">SendTraffic</a>LoadMetric</td></tr><tr><td>receive-traffic</td><td><a href="java.load.html#ReceiveTrafficLoadMetric" title="10.1.3. ReceiveTrafficLoadMetric">ReceiveTraffic</a>LoadMetric</td></tr><tr><td>busyness</td><td><a href="java.load.html#BusyConnectorsLoadMetric" title="10.1.2. BusyConnectorsLoadMetric">BusyConnectors</a>LoadMetric</td></tr><tr><td>connection-pool</td><td><a href="java.load.html#ConnectionPoolUsageLoadMetric" title="10.3.1. ConnectionPoolUsageLoadMetric">ConnectionPoolUsage</a>LoadMetric</td></tr></tbody></table></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="CustomLoadMetric"/>7.3.5. custom-load-metric Configuration</h3></div></div></div><p>The custom-load-metric are for user defined "classes" collecting information. They are like the load-metric except <code class="code">type</code>
           is replaced by <code class="code">class</code>:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>Property</th><th>Default</th></tr></thead><tbody><tr><td>class</td><td>Name of your class</td><td><span class="emphasis"><em>Mandatory</em></span></td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="UsingJBossConsole"/>7.3.6. load-metric Configuration with the jboss admin console</h3></div></div></div><p>The load-metric have 4 commands to add / remove metrics</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="AddMetric"/>7.3.6.1. add-metric</h4></div></div></div><p>Allows to add a <code class="code">load-metric</code> to the <code class="code">dynamic-load-provider</code></p><p>For example:</p><pre class="programlisting">
       ./:add-metric(type=cpu, weight=2, capacity=1)
       </pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="RemoveMetric"/>7.3.6.2. remove-metric</h4></div></div></div><p>Allows to remove a <code class="code">load-metric</code> from the <code class="code">dynamic-load-provider</code></p><p>For example:</p><pre class="programlisting">
       ./:remove-metric(type=cpu)
       </pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="AddCustomMetric"/>7.3.6.3. add-custom-metric</h4></div></div></div><p>Allows to add a <code class="code">load-custom-metric</code> to the <code class="code">dynamic-load-provider</code></p><p>For example:</p><pre class="programlisting">
       ./:add-custom-metric(class=myclass, weight=2, capacity=1, property=[("pool" =&gt; "mypool"), ("var" =&gt; "myvariable")])
       </pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="RemoveCustomMetric"/>7.3.6.4. remove-custom-metric</h4></div></div></div><p>Allows to remove a <code class="code">load-custom-metric</code> from the <code class="code">dynamic-load-provider</code></p><p>For example:</p><pre class="programlisting">
       ./:remove-custom-metric(class=myclass)
       </pre></div></div></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="java.config.html"><strong>Prev</strong>Chapter 6. Server-side Configuration</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="java.building.html"><strong>Next</strong>Chapter 8. Building Server-Side Components</a></li></ul></body></html>