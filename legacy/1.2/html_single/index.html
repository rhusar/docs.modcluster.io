<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">mod_cluster Documentation</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.72.0"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e1"/>mod_cluster Documentation</h1></div></div><hr/></div><div class="toc"><dl><dt><span class="chapter"><a href="#Intro">1. Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e11">1.1. Platforms</a></span></dt><dt><span class="section"><a href="#d0e32">1.2. Advantages</a></span></dt><dt><span class="section"><a href="#d0e72">1.3. Requirements</a></span></dt><dt><span class="section"><a href="#d0e85">1.4. Limitations</a></span></dt><dt><span class="section"><a href="#download">1.5. Downloads</a></span></dt><dt><span class="section"><a href="#d0e162">1.6. Configuration</a></span></dt><dt><span class="section"><a href="#d0e186">1.7. Migration</a></span></dt><dt><span class="section"><a href="#d0e202">1.8. SSL support</a></span></dt><dt><span class="section"><a href="#d0e216">1.9. Load Balancing Demo Application</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Quick_Start_Guide">2. Quick Start Guide</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e250">2.1. Download mod_cluster components</a></span></dt><dt><span class="section"><a href="#d0e261">2.2. Install the httpd binary</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e264">2.2.1. Install the whole httpd</a></span></dt><dt><span class="section"><a href="#d0e276">2.2.2. Install only the modules</a></span></dt><dt><span class="section"><a href="#d0e298">2.2.3. Install in home directory</a></span></dt><dt><span class="section"><a href="#d0e309">2.2.4. Install in Windows</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e343">2.3. Configure httpd</a></span></dt><dt><span class="section"><a href="#d0e357">2.4. Install the server-side binaries</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e364">2.4.1. Installing in JBoss AS 6.x</a></span></dt><dt><span class="section"><a href="#d0e369">2.4.2. Installing in JBoss AS 5.x</a></span></dt><dt><span class="section"><a href="#d0e376">2.4.3. Installing in Tomcat</a></span></dt><dt><span class="section"><a href="#d0e384">2.4.4. Installing in JBoss AS 4.2.x or 4.3.x</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e391">2.5. Configuring the server-side</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e394">2.5.1. Configuring mod_cluster with JBoss AS 5.x+</a></span></dt><dt><span class="section"><a href="#d0e399">2.5.2. Configuring mod_cluster with standalone JBoss Web or Tomcat</a></span></dt><dt><span class="section"><a href="#d0e409">2.5.3. Integrate mod_cluster with JBoss AS 4.2.x and 4.3.x</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e419">2.6. Start httpd</a></span></dt><dt><span class="section"><a href="#d0e426">2.7. Start the back-end server</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e429">2.7.1. Starting JBoss AS</a></span></dt><dt><span class="section"><a href="#d0e434">2.7.2. Starting JBossWeb or Tomcat</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e439">2.8. Set up more back-end servers</a></span></dt><dt><span class="section"><a href="#d0e444">2.9. Experiment with the Load Balancing Demo Application</a></span></dt></dl></dd><dt><span class="chapter"><a href="#native.config">3. httpd configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e455">3.1. Apache httpd configuration</a></span></dt><dt><span class="section"><a href="#d0e472">3.2. mod_proxy configuration</a></span></dt><dt><span class="section"><a href="#d0e477">3.3. mod_slotmem configuration</a></span></dt><dt><span class="section"><a href="#d0e482">3.4. mod_proxy_cluster</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e485">3.4.1. CreateBalancers</a></span></dt><dt><span class="section"><a href="#d0e505">3.4.2. UseAlias</a></span></dt><dt><span class="section"><a href="#d0e519">3.4.3. LBstatusRecalTime</a></span></dt><dt><span class="section"><a href="#d0e538">3.4.4. WaitForRemove</a></span></dt><dt><span class="section"><a href="#d0e545">3.4.5. ProxyPassMatch/ProxyPass</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e555">3.5. mod_manager</a></span></dt><dd><dl><dt><span class="section"><a href="#EnableMCPMReceive">3.5.1. EnableMCPMReceive</a></span></dt><dt><span class="section"><a href="#d0e568">3.5.2. MemManagerFile</a></span></dt><dt><span class="section"><a href="#d0e575">3.5.3. Maxcontext</a></span></dt><dt><span class="section"><a href="#d0e582">3.5.4. Maxnode</a></span></dt><dt><span class="section"><a href="#d0e589">3.5.5. Maxhost</a></span></dt><dt><span class="section"><a href="#d0e596">3.5.6. Maxsessionid</a></span></dt><dt><span class="section"><a href="#d0e603">3.5.7. MaxMCMPMaxMessSize</a></span></dt><dt><span class="section"><a href="#d0e610">3.5.8. ManagerBalancerName</a></span></dt><dt><span class="section"><a href="#d0e617">3.5.9. PersistSlots</a></span></dt><dt><span class="section"><a href="#d0e624">3.5.10. CheckNonce</a></span></dt><dt><span class="section"><a href="#d0e631">3.5.11. AllowDisplay</a></span></dt><dt><span class="section"><a href="#d0e638">3.5.12. AllowCmd</a></span></dt><dt><span class="section"><a href="#d0e645">3.5.13. ReduceDisplay</a></span></dt><dt><span class="section"><a href="#SetHandlermod_cluster-manager">3.5.14. SetHandler mod_cluster-manager</a></span></dt></dl></dd><dt><span class="section"><a href="#mod_advertise">3.6. mod_advertise</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e680">3.6.1. ServerAdvertise</a></span></dt><dt><span class="section"><a href="#d0e694">3.6.2. AdvertiseGroup</a></span></dt><dt><span class="section"><a href="#d0e701">3.6.3. AdvertiseFrequency</a></span></dt><dt><span class="section"><a href="#d0e708">3.6.4. AdvertiseSecurityKey</a></span></dt><dt><span class="section"><a href="#d0e715">3.6.5. AdvertiseManagerUrl</a></span></dt><dt><span class="section"><a href="#d0e722">3.6.6. AdvertiseBindAddress</a></span></dt></dl></dd><dt><span class="section"><a href="#MinimalExample">3.7. Minimal Example</a></span></dt></dl></dd><dt><span class="chapter"><a href="#native.building">4. Building httpd modules</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e738">4.1. Build a patched httpd from it sources</a></span></dt><dt><span class="section"><a href="#d0e758">4.2. Build the 4 modules of mod_cluster</a></span></dt><dt><span class="section"><a href="#d0e784">4.3. Build the mod_proxy module</a></span></dt></dl></dd><dt><span class="chapter"><a href="#native.install">5. Installing httpd modules</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e802">5.1. Configuration</a></span></dt><dt><span class="section"><a href="#d0e813">5.2. Installing and using the bundles</a></span></dt></dl></dd><dt><span class="chapter"><a href="#java.config">6. Server-side Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#ModClusterListener">6.1. JBoss AS</a></span></dt><dd><dl><dt><span class="section"><a href="#ModClusterService">6.1.1. Non-clustered mode</a></span></dt><dt><span class="section"><a href="#ModClusterConfig">6.1.2. Configuration Properties</a></span></dt><dt><span class="section"><a href="#d0e923">6.1.3. Connectors</a></span></dt><dt><span class="section"><a href="#jvm-route">6.1.4. Node Identity</a></span></dt></dl></dd><dt><span class="section"><a href="#tomcat">6.2. JBoss Web &amp; Tomcat</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1005">6.2.1. Lifecycle Listener</a></span></dt><dt><span class="section"><a href="#d0e1022">6.2.2. Additional Tomcat dependencies</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1030">6.3. Migrating from 1.1.x</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1035">6.3.1. mod_cluster-jboss-beans.xml</a></span></dt><dt><span class="section"><a href="#d0e1043">6.3.2. server.xml</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1048">6.4. Migrating from 1.0.x</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1053">6.4.1. Dependency with JBoss Web</a></span></dt><dt><span class="section"><a href="#d0e1065">6.4.2. server.xml</a></span></dt><dt><span class="section"><a href="#d0e1099">6.4.3. mod_cluster-jboss-beans.xml</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#java.AS7config">7. AS7 modcluster subsystem Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#ModClusterSubSystem">7.1. ModCluster Subsystem in JBoss AS7</a></span></dt><dt><span class="section"><a href="#ModClusterSubSystemMiniConfiguration">7.2. ModCluster Subsystem minimal configuration</a></span></dt><dt><span class="section"><a href="#ModClusterSubSystemConfiguration">7.3. ModCluster Subsystem configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#AS7ModClusterConfig">7.3.1. mod-cluster-config Attributes</a></span></dt><dt><span class="section"><a href="#SimpleLoadProvider">7.3.2. simple-load-provider Attributes</a></span></dt><dt><span class="section"><a href="#DynamicLoadProvider">7.3.3. dynamic-load-provider Attributes</a></span></dt><dt><span class="section"><a href="#LoadMetric">7.3.4. load-metric Configuration</a></span></dt><dt><span class="section"><a href="#CustomLoadMetric">7.3.5. custom-load-metric Configuration</a></span></dt><dt><span class="section"><a href="#UsingJBossConsole">7.3.6. load-metric Configuration with the jboss admin console</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#java.building">8. Building Server-Side Components</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1655">8.1. Requirements</a></span></dt><dt><span class="section"><a href="#d0e1667">8.2. Building</a></span></dt><dt><span class="section"><a href="#d0e1692">8.3. Build Artifacts</a></span></dt></dl></dd><dt><span class="chapter"><a href="#java.properties">9. Server-side Configuration Properties</a></span></dt><dd><dl><dt><span class="section"><a href="#mcmp">9.1. Proxy Discovery Configuration</a></span></dt><dt><span class="section"><a href="#proxy">9.2. Proxy Configuration</a></span></dt><dt><span class="section"><a href="#ssl">9.3. SSL Configuration</a></span></dt><dt><span class="section"><a href="#load">9.4. Load Configuration for JBoss Web and Tomcat</a></span></dt></dl></dd><dt><span class="chapter"><a href="#java.load">10. Server-Side Load Metrics</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2646">10.1. Web Container metrics</a></span></dt><dd><dl><dt><span class="section"><a href="#ActiveSessionsLoadMetric">10.1.1. <code class="code">ActiveSessionsLoadMetric</code></a></span></dt><dt><span class="section"><a href="#BusyConnectorsLoadMetric">10.1.2. <code class="code">BusyConnectorsLoadMetric</code></a></span></dt><dt><span class="section"><a href="#ReceiveTrafficLoadMetric">10.1.3. <code class="code">ReceiveTrafficLoadMetric</code></a></span></dt><dt><span class="section"><a href="#SendTrafficLoadMetric">10.1.4. <code class="code">SendTrafficLoadMetric</code></a></span></dt><dt><span class="section"><a href="#RequestCountLoadMetric">10.1.5. <code class="code">RequestCountLoadMetric</code></a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2761">10.2. System/JVM metrics</a></span></dt><dd><dl><dt><span class="section"><a href="#AverageSystemLoadMetric">10.2.1. <code class="code">AverageSystemLoadMetric</code></a></span></dt><dt><span class="section"><a href="#SystemMemoryUsageLoadMetric">10.2.2. <code class="code">SystemMemoryUsageLoadMetric</code></a></span></dt><dt><span class="section"><a href="#HeapMemoryUsageLoadMetric">10.2.3. <code class="code">HeapMemoryUsageLoadMetric</code></a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2815">10.3. Other metrics</a></span></dt><dd><dl><dt><span class="section"><a href="#ConnectionPoolUsageLoadMetric">10.3.1. <code class="code">ConnectionPoolUsageLoadMetric</code></a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#java.install">11. Installing Server-Side Components</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2840">11.1. Installing in JBoss AS 6.0.0.M1 and up</a></span></dt><dt><span class="section"><a href="#d0e2845">11.2. Installing in JBoss AS 5.x</a></span></dt><dt><span class="section"><a href="#d0e2852">11.3. Installing in Tomcat</a></span></dt></dl></dd><dt><span class="chapter"><a href="#UsingSSL">12. Using SSL in mod_cluster</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e2870">12.1. Using SSL between JBossWEB and httpd</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2875">12.1.1. Apache httpd configuration part</a></span></dt><dt><span class="sect2"><a href="#d0e2890">12.1.2. ClusterListener configuration part</a></span></dt><dt><span class="sect2"><a href="#d0e2904">12.1.3. mod-cluster-jboss-beans configuration part</a></span></dt><dt><span class="sect2"><a href="#d0e2914">12.1.4. How the diferent files were created</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mod_proxy_https">12.2. Using SSL between httpd and JBossWEB</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e3020">12.2.1. How the diferent files were created</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e3069">12.3. Forwarding SSL browser informations when using http/https between
    httpd and JBossWEB</a></span></dt></dl></dd><dt><span class="chapter"><a href="#mod_jk">13. Migration from mod_jk</a></span></dt><dt><span class="chapter"><a href="#mod_proxy">14. Migration from mod_proxy</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d0e3379">14.1. Workers</a></span></dt><dt><span class="sect1"><a href="#d0e3576">14.2. Balancers</a></span></dt></dl></dd><dt><span class="chapter"><a href="#demo">15. Load Balancing Demo Application</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3647">15.1. Overview</a></span></dt><dt><span class="section"><a href="#d0e3671">15.2. Basic Usage</a></span></dt><dt><span class="section"><a href="#client-config">15.3. Client Driver Configuration Options</a></span></dt><dt><span class="section"><a href="#load-generation">15.4. Load Generation Scenarios</a></span></dt></dl></dd><dt><span class="chapter"><a href="#changelog">16. Change Log</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3896">16.1. 1.2.6.Final (07 September 2013)</a></span></dt><dt><span class="section"><a href="#d0e3912">16.2. 1.2.5.Final (30 August 2013)</a></span></dt><dt><span class="section"><a href="#d0e4008">16.3. 1.2.4.Final (24 April 2013)</a></span></dt><dt><span class="section"><a href="#d0e4054">16.4. 1.2.3.Final (18 October 2012)</a></span></dt><dt><span class="section"><a href="#d0e4090">16.5. 1.2.2.Final (06 September 2012)</a></span></dt><dt><span class="section"><a href="#d0e4176">16.6. 1.2.1.Final (03 May 2012)</a></span></dt><dt><span class="section"><a href="#d0e4272">16.7. 1.2.0.Final (06 February 2012)</a></span></dt><dt><span class="section"><a href="#d0e4328">16.8. 1.2.0.Beta4 (26 January 2012)</a></span></dt><dt><span class="section"><a href="#d0e4444">16.9. 1.2.0.Beta3 (03 January 2012)</a></span></dt><dt><span class="section"><a href="#d0e4449">16.10. 1.2.0.Beta2 (11 December 2011)</a></span></dt><dt><span class="section"><a href="#d0e4465">16.11. 1.2.0.Beta1 (06 December 2011)</a></span></dt><dt><span class="section"><a href="#d0e4521">16.12. 1.1.3.Final (12 August 2011)</a></span></dt><dt><span class="section"><a href="#d0e4567">16.13. 1.1.2.Final (21 April 2011)</a></span></dt><dt><span class="section"><a href="#d0e4673">16.14. 1.1.1.Final (31 January 2011)</a></span></dt><dt><span class="section"><a href="#d0e4799">16.15. 1.1.0.Final (13 August 2010)</a></span></dt><dt><span class="section"><a href="#d0e4925">16.16. 1.1.0.CR3 (15 June 2010)</a></span></dt><dt><span class="section"><a href="#d0e5021">16.17. 1.1.0.CR2 (11 May 2010)</a></span></dt><dt><span class="section"><a href="#d0e5117">16.18. 1.1.0.CR1 (22 March 2010)</a></span></dt><dt><span class="section"><a href="#d0e5323">16.19. 1.1.0.Beta1 (30 October 2009)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#faq">17. Frequently Asked questions</a></span></dt><dd><dl><dt><span class="section"><a href="#advertisemessage">17.1. What is Advertise</a></span></dt><dt><span class="section"><a href="#d0e5551">17.2. What to do if I don't want to use Advertise (multicast):</a></span></dt><dt><span class="section"><a href="#d0e5566">17.3. I am using Tomcat 7 / 6 what should I do:</a></span></dt><dt><span class="section"><a href="#d0e5574">17.4. It is not working what should I do:</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5579">17.4.1. No error</a></span></dt><dt><span class="section"><a href="#d0e5630">17.4.2. Error in server.log or catalina.out</a></span></dt><dt><span class="section"><a href="#d0e5656">17.4.3. Error in error_log</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5671">17.5. I have "HTTP/1.1 501 Method Not Implemented"</a></span></dt><dt><span class="section"><a href="#d0e5681">17.6. Redirect is not working:</a></span></dt><dt><span class="section"><a href="#d0e5689">17.7. I have more than one Connector mod_cluster does use the right one</a></span></dt><dt><span class="section"><a href="#d0e5700">17.8. Chrome can't diplay /mod_cluster_manager page</a></span></dt><dt><span class="section"><a href="#d0e5711">17.9. Using mod_cluster and SELinux.</a></span></dt></dl></dd></dl></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Intro"/>Chapter 1. Overview</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e11">1.1. Platforms</a></span></dt><dt><span class="section"><a href="#d0e32">1.2. Advantages</a></span></dt><dt><span class="section"><a href="#d0e72">1.3. Requirements</a></span></dt><dt><span class="section"><a href="#d0e85">1.4. Limitations</a></span></dt><dt><span class="section"><a href="#download">1.5. Downloads</a></span></dt><dt><span class="section"><a href="#d0e162">1.6. Configuration</a></span></dt><dt><span class="section"><a href="#d0e186">1.7. Migration</a></span></dt><dt><span class="section"><a href="#d0e202">1.8. SSL support</a></span></dt><dt><span class="section"><a href="#d0e216">1.9. Load Balancing Demo Application</a></span></dt></dl></div><p>
    mod_cluster is an httpd-based load balancer.
    Like mod_jk and mod_proxy, mod_cluster uses a communication channel to forward requests from httpd to one of a set of application server nodes.
    Unlike mod_jk and mod_proxy, mod_cluster leverages an additional connection between the application server nodes and httpd.
    The application server nodes use this connection to transmit server-side load balance factors and lifecycle events back to httpd via a custom set of HTTP methods, affectionately called the Mod-Cluster Management Protocol (MCMP).
    This additional feedback channel allows mod_cluster to offer a level of intelligence and granularity not found in other load balancing solutions.
  </p><p>
    Within httpd, mod_cluster is implemented as a set of modules for httpd with mod_proxy enabled.
    Much of the logic comes from mod_proxy, e.g. mod_proxy_ajp provides all the AJP logic needed by mod_cluster.
  </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e11"/>1.1. Platforms</h2></div></div></div><p>
      JBoss already prepares <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/mod_cluster/downloads.html">binary packages</a> with httpd and mod_cluster so you can quickly try mod_cluster on the following platforms:
    </p><div class="itemizedlist"><ul><li><p>Linux x86, x64, ia64</p></li><li><p>Solaris x86, SPARC</p></li><li><p>Windows x86, x64, ia64</p></li><li><p>HP-UX PA-RISC, ia64</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e32"/>1.2. Advantages</h2></div></div></div><p>mod_cluster boasts the following advantages over other httpd-based load balancers:</p><div class="variablelist"><dl><dt><span class="term">Dynamic configuration of httpd workers</span></dt><dd><p>
            Traditional httpd-based load balancers require explicit configuration of the workers available to a proxy.
            In mod_cluster, the bulk of the proxy's configuration resides on the application servers.
            The set of proxies to which an application server will communicate is determined either by a static list or using dynamic discovery via the <a href="#advertise">advertise</a> mechanism.
            The application server relays lifecycle events (e.g. server startup/shutdown) to the proxies allowing them to effectively auto-configure themselves.
            Notably, the graceful shutdown of a server will not result in a failover response by a proxy, as is the case with traditional httpd-based load balancers.
          </p></dd><dt><span class="term">Server-side load balance factor calculation</span></dt><dd><p>
            In contrast with traditional httpd-based load balancers, mod_cluster uses load balance factors calculated and provided by the application servers, rather than computing these in the proxy.
            Consequently, mod_cluster offers a more robust and accurate set of load metrics than is available from the proxy.
            See the chapter entitled <a href="#java.load" title="Chapter 10. Server-Side Load Metrics">Server-Side Load Metrics</a> for details.
          </p></dd><dt><span class="term">Fine grained web-app lifecycle control</span></dt><dd><p>
            Traditional httpd-based load balancers do not handle web application undeployments particularly well.
            From the proxy's perspective requests to an undeployed web application are indistinguishable from a request for an non-existent resource, and will result in 404 errors.
            In mod_cluster, each server forwards any web application context lifecycle events (e.g. web-app deploy/undeploy) to the proxy informing it to start/stop routing requests for a given context to that server.
          </p></dd><dt><span class="term">AJP is optional</span></dt><dd><p>
            Unlike mod_jk, mod_cluster does not require AJP.
            httpd connections to application server nodes can use HTTP, HTTPS, or AJP.
          </p></dd></dl></div><p>
      The original concepts are described in a <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/community/docs/DOC-11431">wiki</a>.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e72"/>1.3. Requirements</h2></div></div></div><div class="itemizedlist"><ul><li><p>httpd-2.2.8+</p></li><li><p>JBoss AS 5.0.0+ or JBossWeb 2.1.1+</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>httpd-2.2.8+ is already in the bundles, so if you use the bundle you don't need to download Apache httpd.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e85"/>1.4. Limitations</h2></div></div></div><p>
      mod_cluster uses shared memory to keep the nodes description, the shared memory is created at the start of httpd and the structure of each item is fixed.
      The following can't be changed by configuration directives.
    </p><div class="itemizedlist"><ul><li><p>Max Alias length 40 characters (Host: hostname header, Alias in &lt;Host/&gt;).</p></li><li><p>Max context length 40 (for example myapp.war deploys in /myapp /myapp is the context).</p></li><li><p>Max balancer name length 40 (balancer property in mbean).</p></li><li><p>Max JVMRoute string length 80 (JVMRoute in &lt;Engine/&gt;).</p></li><li><p>Max load balancing group name length 20 (domain property in mbean).</p></li><li><p>Max hostname length for a node 64 (address in the &lt;Connector/&gt;).</p></li><li><p>Max port length for a node 7 (8009 is 4 characters, port in the &lt;Connector/&gt;).</p></li><li><p>Max scheme length for a node 6 (possible values are http, https, ajp, liked with the protocol of &lt;Connector/&gt;).</p></li><li><p>Max cookie name 30 (the header cookie name for sessionid default value: JSESSIONID from org.apache.catalina.Globals.SESSION_COOKIE_NAME).</p></li><li><p>Max path name 30 (the parameter name for the sessionid default value: jsessionid from org.apache.catalina.Globals.SESSION_PARAMETER_NAME).</p></li><li><p>Max length for a sessionid 120 (something like BE81FAA969BF64C8EC2B6600457EAAAA.node01).</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="download"/>1.5. Downloads</h2></div></div></div><p>Download the latest mod_cluster release <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/mod_cluster/downloads/latest">here</a>.</p><p>The release is comprised of the following artifacts:</p><div class="itemizedlist"><ul><li><p>httpd binaries for common platforms</p></li><li><p>JBoss AS/JBossWeb/Tomcat binary distribution</p></li></ul></div><p>Alternatively, you can build from source using the Git repository:</p><p><a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://github.com/modcluster/mod_cluster/tags">https://github.com/modcluster/mod_cluster/tags<span class="emphasis"><em>release</em></span>/</a></p><div class="itemizedlist"><ul><li><p>Building <a href="#native.building" title="Chapter 4. Building httpd modules">httpd modules</a> </p></li><li><p>Building <a href="#java.building" title="Chapter 8. Building Server-Side Components">server-side components</a> </p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e162"/>1.6. Configuration</h2></div></div></div><p>If you want to skip the details and just set up a minimal working installation of mod_cluster, see the <a href="#Quick_Start_Guide" title="Chapter 2. Quick Start Guide">Quick Start Guide</a>.</p><div class="itemizedlist"><ul><li><p>Configuring <a href="#native.config" title="Chapter 3. httpd configuration">httpd</a></p></li><li><p>Configuring <a href="#java.config" title="Chapter 6. Server-side Configuration">JBoss AS</a></p></li><li><p>Configuring <a href="#tomcat" title="6.2. JBoss Web &amp; Tomcat">JBoss Web or Tomcat</a></p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e186"/>1.7. Migration</h2></div></div></div><p>
      Migrating from mod_jk or mod_proxy is fairly straight forward.
      In general, much of the configuration previously found in httpd.conf is now defined in the application server nodes.
    </p><div class="itemizedlist"><ul><li><p>Migrating from <a href="#mod_jk" title="Chapter 13. Migration from mod_jk">mod_jk</a></p></li><li><p>Migrating from <a href="#mod_proxy" title="Chapter 14. Migration from mod_proxy">mod_proxy</a></p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e202"/>1.8. SSL support</h2></div></div></div><p>
      Both the request connections between httpd and the application server nodes, and the feedback channel between the nodes and httpd can be secured.
      The former is achieved via the <a href="#mod_proxy_https" title="12.2. Using SSL between httpd and JBossWEB">mod_proxy_https module</a> and a corresponding ssl-enabled HTTP connector in JBoss Web.
      The latter requires the <a href="#UsingSSL" title="Chapter 12. Using SSL in mod_cluster">mod_ssl module</a> and <a href="#java.config" title="Chapter 6. Server-side Configuration">explicit configuration in JBoss AS/Web</a>.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e216"/>1.9. Load Balancing Demo Application</h2></div></div></div><p>
      The mod_cluster binary distribution for JBoss AS/JBossWeb/Tomcat includes a <a href="#demo" title="Chapter 15. Load Balancing Demo Application">demo application</a> that helps demonstrate how different server-side scenarios affect the routing of client requests by the load balancer.
      The demo application is located in the mod_cluster distribution's demo directory.
    </p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Strong cryptography warning</h2><p>
      mod_cluster contains mod_ssl, therefore the following warning (copied from <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.openssl.org/">OpenSSL</a>) applies:
    </p><p>
      PLEASE REMEMBER THAT EXPORT/IMPORT AND/OR USE OF STRONG CRYPTOGRAPHY SOFTWARE, PROVIDING CRYPTOGRAPHY HOOKS OR EVEN JUST COMMUNICATING TECHNICAL DETAILS ABOUT CRYPTOGRAPHY SOFTWARE IS ILLEGAL IN SOME PARTS OF THE WORLD.
      SO, WHEN YOU IMPORT THIS PACKAGE TO YOUR COUNTRY, RE-DISTRIBUTE IT FROM THERE OR EVEN JUST EMAIL TECHNICAL SUGGESTIONS OR EVEN SOURCE PATCHES TO THE AUTHOR OR OTHER PEOPLE YOU ARE STRONGLY ADVISED TO PAY CLOSE ATTENTION TO ANY EXPORT/IMPORT AND/OR USE LAWS WHICH APPLY TO YOU.
      THE AUTHORS OF OPENSSL ARE NOT LIABLE FOR ANY VIOLATIONS YOU MAKE HERE. SO BE CAREFUL, IT IS YOUR RESPONSIBILITY.
    </p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Quick_Start_Guide"/>Chapter 2. Quick Start Guide</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e250">2.1. Download mod_cluster components</a></span></dt><dt><span class="section"><a href="#d0e261">2.2. Install the httpd binary</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e264">2.2.1. Install the whole httpd</a></span></dt><dt><span class="section"><a href="#d0e276">2.2.2. Install only the modules</a></span></dt><dt><span class="section"><a href="#d0e298">2.2.3. Install in home directory</a></span></dt><dt><span class="section"><a href="#d0e309">2.2.4. Install in Windows</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e343">2.3. Configure httpd</a></span></dt><dt><span class="section"><a href="#d0e357">2.4. Install the server-side binaries</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e364">2.4.1. Installing in JBoss AS 6.x</a></span></dt><dt><span class="section"><a href="#d0e369">2.4.2. Installing in JBoss AS 5.x</a></span></dt><dt><span class="section"><a href="#d0e376">2.4.3. Installing in Tomcat</a></span></dt><dt><span class="section"><a href="#d0e384">2.4.4. Installing in JBoss AS 4.2.x or 4.3.x</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e391">2.5. Configuring the server-side</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e394">2.5.1. Configuring mod_cluster with JBoss AS 5.x+</a></span></dt><dt><span class="section"><a href="#d0e399">2.5.2. Configuring mod_cluster with standalone JBoss Web or Tomcat</a></span></dt><dt><span class="section"><a href="#d0e409">2.5.3. Integrate mod_cluster with JBoss AS 4.2.x and 4.3.x</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e419">2.6. Start httpd</a></span></dt><dt><span class="section"><a href="#d0e426">2.7. Start the back-end server</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e429">2.7.1. Starting JBoss AS</a></span></dt><dt><span class="section"><a href="#d0e434">2.7.2. Starting JBossWeb or Tomcat</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e439">2.8. Set up more back-end servers</a></span></dt><dt><span class="section"><a href="#d0e444">2.9. Experiment with the Load Balancing Demo Application</a></span></dt></dl></div><p>
    The following are the steps to set up a minimal working installation of mod_cluster on a single httpd server and a single back end server, either JBoss AS, JBossWeb or Tomcat.
    The steps can be repeated to add as many httpd servers or back end servers to your cluster as is desired.
  </p><p>
    The steps shown here are not intended to demonstrate how to set up a production install of mod_cluster;
    for example <a href="#UsingSSL" title="Chapter 12. Using SSL in mod_cluster">using SSL to secure access</a> to the httpd-side mod_manager component is not covered.
    See the <a href="#native.config" title="Chapter 3. httpd configuration">httpd-side</a> and <a href="#java.config" title="Chapter 6. Server-side Configuration">java-side</a> configuration documentation for the full set of configuration options.
  </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e250"/>2.1. Download mod_cluster components</h2></div></div></div><p>
      Download the latest <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/mod_cluster/downloads/latest.html">httpd and java release bundles</a>.
      If there is no pre-built httpd bundle appropriate for your OS or system architecture, you can <a href="#native.building" title="Chapter 4. Building httpd modules">build the binary from source</a>.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e261"/>2.2. Install the httpd binary</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e264"/>2.2.1. Install the whole httpd</h3></div></div></div><p>
        The httpd-side bundles are gzipped tars and include a full httpd install.
        As they contain already an Apache httpd install you don't need to download Apache httpd.
        Just extract them in root, e.g.
      </p><pre class="programlisting">cd /
tar xvf mod-cluster-1.0.0-linux2-x86-ssl.tar.gz</pre><p>
        That will give you a full httpd install in your <code class="code">/opt/jboss</code> directory.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e276"/>2.2.2. Install only the modules</h3></div></div></div><p>
        If you already have a working httpd install that you would prefer
        to use, you'll need to download the bundle named mod_cluster httpd
        dynamic libraries corresponding to you plaform, extract the modules and
        copy them directory to your httpd install's module directory.
      </p><pre class="programlisting">cd /tmp
tar xvf mod_cluster-1.2.0.Final-linux2-x86-so.tar.gz</pre><p>
        And then you have to copy the files below to you module directory:
      </p><div class="itemizedlist"><ul><li><p>mod_slotmem.so</p></li><li><p>mod_manager.so</p></li><li><p>mod_proxy_cluster.so</p></li><li><p>mod_advertise.so</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e298"/>2.2.3. Install in home directory</h3></div></div></div><p>
        Since 1.1.0.CR2 a script <code class="code">opt/jboss/httpd/sbin/installhome.sh</code>
        allows reconfiguration of the bundle installation so that it can run in
        user's home directory.
        To do that just extract the bundle in your home directory and run the script.
        Once that done, httpd will run on port 8000 and will accept MCMP messages on
        localhost:6666 and offer <code class="code">/mod_cluster_manager</code> on the same host and port.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e309"/>2.2.4. Install in Windows</h3></div></div></div><p>
        Unzip the bundle corresponding to your architecture.
      </p><p>
        Change to the bin directory of the subfolder httpd-2.2 where you unzip the bundle
        and run the installconf.bat shell script.
      </p><pre class="programlisting">cd httpd-2.2\bin
       installconf.bat</pre><p>
      </p><p>
        You may run httpd directly by using:
      </p><pre class="programlisting">httpd.exe</pre><p>
        or install Apache httpd as a service:
      </p><pre class="programlisting">httpd.exe -k install</pre><p>
        and start the service via net start or using httpd.exe:
      </p><pre class="programlisting">net start Apache2.2</pre><p>
      </p><pre class="programlisting">httpd.exe -k start</pre><p>
      </p><p>
        Note that in the windows bundles have a flat directory structure, so you have <span class="emphasis"><em>httpd-2.2/modules/</em></span> instead of
        <code class="code">opt/jboss/httpd/lib/httpd/modules</code>.
      </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e343"/>2.3. Configure httpd</h2></div></div></div><p>
      Since 1.1.0.CR2 httpd.conf is preconfigured with the Quick Start values.
      You should adapt the default values to your configuration with older mod_cluster we will have to add the following to httpd.conf.
      If you extracted the download bundle to root as shown above and are using that extract as your httpd install,
      httpd.conf is located in <code class="code">/opt/jboss/httpd/httpd/conf</code>.
    </p><pre class="programlisting">LoadModule proxy_module /opt/jboss/httpd/lib/httpd/modules/mod_proxy.so
LoadModule proxy_ajp_module /opt/jboss/httpd/lib/httpd/modules/mod_proxy_ajp.so
LoadModule slotmem_module /opt/jboss/httpd/lib/httpd/modules/mod_slotmem.so
LoadModule manager_module /opt/jboss/httpd/lib/httpd/modules/mod_manager.so
LoadModule proxy_cluster_module /opt/jboss/httpd/lib/httpd/modules/mod_proxy_cluster.so
LoadModule advertise_module /opt/jboss/httpd/lib/httpd/modules/mod_advertise.so
 
Listen 10.33.144.3:6666
&lt;VirtualHost 10.33.144.3:6666&gt;
 
  &lt;Directory /&gt;
    Order deny,allow
    Deny from all
    Allow from 10.33.144.
  &lt;/Directory&gt;
 
  KeepAliveTimeout 60
  MaxKeepAliveRequests 0
 
  ManagerBalancerName mycluster
  AdvertiseFrequency 5
 
&lt;/VirtualHost&gt;</pre><p>
      If you are using your own install of httpd, httpd.conf is found in your install's conf directory.
      The content to add to httpd.conf is slightly different from the above (different path to the various .so files):
    </p><pre class="programlisting">LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
LoadModule slotmem_module modules/mod_slotmem.so
LoadModule manager_module modules/mod_manager.so
LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
LoadModule advertise_module modules/mod_advertise.so
 
Listen 10.33.144.3:6666
&lt;VirtualHost 10.33.144.3:6666&gt;
 
  &lt;Directory /&gt;
    Order deny,allow
    Deny from all
    Allow from 10.33.144.
  &lt;/Directory&gt;
 
  KeepAliveTimeout 60
  MaxKeepAliveRequests 0
 
  ManagerBalancerName mycluster
  AdvertiseFrequency 5
 
&lt;/VirtualHost&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e357"/>2.4. Install the server-side binaries</h2></div></div></div><p>
      First, extract the java-side binary to a temporary directory.
      The following assumes it was extracted to /tmp/mod-cluster
    </p><p>
      Your next step depends on whether your target server is JBoss AS or JBoss Web/Tomcat.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e364"/>2.4.1. Installing in JBoss AS 6.x</h3></div></div></div><p>
        You don't need to do anything to install the java-side binaries in AS 6.x;
        it's part of the AS distribution's default, standard and all configurations.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e369"/>2.4.2. Installing in JBoss AS 5.x</h3></div></div></div><p>
        Assuming $JBOSS_HOME indicates the root of your JBoss AS install and that you want to use mod_cluster in the AS's all config:
      </p><pre class="programlisting">cp -r /tmp/mod-cluster/mod-cluster.sar $JBOSS_HOME/server/all/deploy</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e376"/>2.4.3. Installing in Tomcat</h3></div></div></div><p>
        Assuming $CATALINA_HOME indicates the root of your Tomcat install:
      </p><pre class="programlisting">cp -r /tmp/mod-cluster/JBossWeb-Tomcat/lib/* $CATALINA_HOME/lib/ </pre>
      Note that you should remove in the $CATALINA_HOME/lib/ directory the mod_cluster-container-tomcat6* file in Tomcat7 and
      the mod_cluster-container-tomcat7* in Tomcat 6.
    </div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e384"/>2.4.4. Installing in JBoss AS 4.2.x or 4.3.x</h3></div></div></div><p>Assuming $JBOSS_HOME indicates the root of your JBoss AS install and that you want to use mod_cluster in the AS's all config:
      </p><pre class="programlisting">cp -r /tmp/mod-cluster/JBossWeb-Tomcat/lib/* $JBOSS_HOME/server/all/deploy/jboss-web.deployer/ </pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e391"/>2.5. Configuring the server-side</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e394"/>2.5.1. Configuring mod_cluster with JBoss AS 5.x+</h3></div></div></div><p>
        No post-installation configuration necessary!
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e399"/>2.5.2. Configuring mod_cluster with standalone JBoss Web or Tomcat</h3></div></div></div><p>
        Edit the <code class="code">$CATALINA_HOME/conf/server.xml</code> file, adding the following next to the other &lt;Listener/&gt; elements:
      </p><pre class="programlisting">&lt;Listener className="org.jboss.modcluster.container.catalina.standalone.ModClusterListener" advertise="true"/&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e409"/>2.5.3. Integrate mod_cluster with JBoss AS 4.2.x and 4.3.x</h3></div></div></div><p>
        Edit the <code class="code">$JBOSS_HOME/server/all/deploy/jboss-web.deployer/server.xml</code> file, adding the following next to the other &lt;Listener/&gt; elements:
      </p><pre class="programlisting">&lt;Listener className="org.jboss.modcluster.container.catalina.standalone.ModClusterListener" advertise="true"/&gt;</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e419"/>2.6. Start httpd</h2></div></div></div><p>To start httpd do the following:</p><pre class="programlisting">/opt/jboss/httpd/sbin/apachectl start</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e426"/>2.7. Start the back-end server</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e429"/>2.7.1. Starting JBoss AS</h3></div></div></div><pre class="programlisting">cd $JBOSS_HOME/bin
./run.sh -c all</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e434"/>2.7.2. Starting JBossWeb or Tomcat</h3></div></div></div><pre class="programlisting">cd $CATALINA_HOME
./startup.sh</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e439"/>2.8. Set up more back-end servers</h2></div></div></div><p>
      Repeat the back-end server install and configuration steps for each server in your cluster.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e444"/>2.9. Experiment with the Load Balancing Demo Application</h2></div></div></div><p>
      The <a href="#demo" title="Chapter 15. Load Balancing Demo Application">load balancing demo application</a> is a good way to learn about mod_cluster's capabilities.
    </p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="native.config"/>Chapter 3. httpd configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e455">3.1. Apache httpd configuration</a></span></dt><dt><span class="section"><a href="#d0e472">3.2. mod_proxy configuration</a></span></dt><dt><span class="section"><a href="#d0e477">3.3. mod_slotmem configuration</a></span></dt><dt><span class="section"><a href="#d0e482">3.4. mod_proxy_cluster</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e485">3.4.1. CreateBalancers</a></span></dt><dt><span class="section"><a href="#d0e505">3.4.2. UseAlias</a></span></dt><dt><span class="section"><a href="#d0e519">3.4.3. LBstatusRecalTime</a></span></dt><dt><span class="section"><a href="#d0e538">3.4.4. WaitForRemove</a></span></dt><dt><span class="section"><a href="#d0e545">3.4.5. ProxyPassMatch/ProxyPass</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e555">3.5. mod_manager</a></span></dt><dd><dl><dt><span class="section"><a href="#EnableMCPMReceive">3.5.1. EnableMCPMReceive</a></span></dt><dt><span class="section"><a href="#d0e568">3.5.2. MemManagerFile</a></span></dt><dt><span class="section"><a href="#d0e575">3.5.3. Maxcontext</a></span></dt><dt><span class="section"><a href="#d0e582">3.5.4. Maxnode</a></span></dt><dt><span class="section"><a href="#d0e589">3.5.5. Maxhost</a></span></dt><dt><span class="section"><a href="#d0e596">3.5.6. Maxsessionid</a></span></dt><dt><span class="section"><a href="#d0e603">3.5.7. MaxMCMPMaxMessSize</a></span></dt><dt><span class="section"><a href="#d0e610">3.5.8. ManagerBalancerName</a></span></dt><dt><span class="section"><a href="#d0e617">3.5.9. PersistSlots</a></span></dt><dt><span class="section"><a href="#d0e624">3.5.10. CheckNonce</a></span></dt><dt><span class="section"><a href="#d0e631">3.5.11. AllowDisplay</a></span></dt><dt><span class="section"><a href="#d0e638">3.5.12. AllowCmd</a></span></dt><dt><span class="section"><a href="#d0e645">3.5.13. ReduceDisplay</a></span></dt><dt><span class="section"><a href="#SetHandlermod_cluster-manager">3.5.14. SetHandler mod_cluster-manager</a></span></dt></dl></dd><dt><span class="section"><a href="#mod_advertise">3.6. mod_advertise</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e680">3.6.1. ServerAdvertise</a></span></dt><dt><span class="section"><a href="#d0e694">3.6.2. AdvertiseGroup</a></span></dt><dt><span class="section"><a href="#d0e701">3.6.3. AdvertiseFrequency</a></span></dt><dt><span class="section"><a href="#d0e708">3.6.4. AdvertiseSecurityKey</a></span></dt><dt><span class="section"><a href="#d0e715">3.6.5. AdvertiseManagerUrl</a></span></dt><dt><span class="section"><a href="#d0e722">3.6.6. AdvertiseBindAddress</a></span></dt></dl></dd><dt><span class="section"><a href="#MinimalExample">3.7. Minimal Example</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e455"/>3.1. Apache httpd configuration</h2></div></div></div><p>You need to load the modules that are needed for mod_cluster for
    example:</p><pre class="programlisting">LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
LoadModule slotmem_module modules/mod_slotmem.so
LoadModule manager_module modules/mod_manager.so
LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
LoadModule advertise_module modules/mod_advertise.so</pre><p>mod_proxy and mod_proxy_ajp are standard httpd modules. mod_slotmem
    is a shared slotmem memory provider. mod_manager is the module that reads
    information from JBoss AS/JBossWeb/Tomcat and updates the shared memory
    information. mod_proxy_cluster is the module that contains the balancer
    for mod_proxy. mod_advertise is an additional module that allows httpd to
    advertise via multicast packets the IP and port where the mod_cluster is
    listening. This multi-module architecture allows the modules to easily be
    changed depending on what the customer wants to do. For example when using
    http instead of AJP, only</p><pre class="programlisting">LoadModule proxy_ajp_module modules/mod_proxy_ajp.so</pre><p>needs to be changed to:</p><pre class="programlisting">LoadModule proxy_http_module modules/mod_proxy_http.so</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e472"/>3.2. mod_proxy configuration</h2></div></div></div><p>mod_proxy directives like ProxyIOBufferSize could be used to
    configure mod_cluster. There is no need to use ProxyPass directives
    because mod_cluster automatically configures which URLs have to be
    forwarded to JBossWEB.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e477"/>3.3. mod_slotmem configuration</h2></div></div></div><p>The actual version doesn't require any configuration
    directives.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e482"/>3.4. mod_proxy_cluster</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e485"/>3.4.1. CreateBalancers</h3></div></div></div><p>CreateBalancers: Define how the balancer are created in the httpd
    VirtualHosts, this is to allow directives like:</p><pre class="programlisting">ProxyPass / balancer://mycluster1/</pre><p>0: Create in all VirtualHosts defined in httpd.</p><p>1: Don't create balancers (requires at least one
    ProxyPass/ProxyPassMatch to define the balancer names).</p><p>2: Create only the main server.</p><p>Default: 2</p><p><span class="emphasis"><em>Note:</em></span> When using 1 don't forget to configure
    the balancer in the ProxyPass directive, because the default is empty
    stickysession and nofailover=Off and the values received via the MCMP
    CONFIG message are ignored.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e505"/>3.4.2. UseAlias</h3></div></div></div><p>UseAlias: Check that the Alias corresponds to the ServerName (See
    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://labs.jboss.com/file-access/default/members/jbossweb/freezone/docs/latest/config/host.html">Host
    Name Aliases</a>)</p><p>0: Don't (ignore Aliases)</p><p>1: Check it</p><p>Default: 0 Ignore the Alias information from the nodes.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e519"/>3.4.3. LBstatusRecalTime</h3></div></div></div><p>LBstatusRecalTime: Time interval in seconds for loadbalancing logic to recalculate the
    status of a node</p><p>Default: 5 seconds</p><p>The actual formula to recalculate the status of a node is:</p><pre class="programlisting">status = lbstatus + (elected - oldelected) * 1000)/lbfactor;</pre><p>lbfactor is received for the node via STATUS messages.lbstatus is
    recalculated every LBstatusRecalTime seconds using the formula:</p><pre class="programlisting">lbstatus = (elected - oldelected) * 1000)/lbfactor;</pre><p>elected is the number of time the worker was elected.oldelected is
    elected last time the lbstatus was recalculated.The node with the lowest
    status is selected. Nodes with lbfactor ≤ 0 are skipped by the both
    calculation logic.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e538"/>3.4.4. WaitForRemove</h3></div></div></div><p>WaitForRemove: Time in seconds before a removed node is forgotten by httpd</p><p>Default: 10 seconds</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e545"/>3.4.5. ProxyPassMatch/ProxyPass</h3></div></div></div><p>ProxyPassMatch/ProxyPass: ProxyPassMatch and ProxyPass are mod_proxy
    directives that when using ! (instead the back-end url) prevent to
    reverse-proxy in the path.
    This could be used allow httpd to serve static
    information like images.</p><pre class="programlisting">ProxyPassMatch ^(/.*\.gif)$ !  </pre><p>The above for example will allow httpd to server directly the .gif
    files.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e555"/>3.5. mod_manager</h2></div></div></div><p>The Context of a mod_manger directive is VirtualHost except mentioned otherwise.
          <code class="code">server config</code> means that it must be outside a VirtualHost configuration.
          If not an error message will be displayed and httpd won't start.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="EnableMCPMReceive"/>3.5.1. EnableMCPMReceive</h3></div></div></div><p>EnableMCPMReceive - Allow the VirtualHost to receive MCPM.
    Allow the VirtualHost to receive the MCPM from the nodes. You need
    one EnableMCPMReceive in your httpd configuration to allow mod_cluster
    to work, put it in the VirtualHost where you configure advertise.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e568"/>3.5.2. MemManagerFile</h3></div></div></div><p>MemManagerFile: That is the base name for the names mod_manager will
    use to store configuration, generate keys for shared memory or lock files.
    That must be an absolute path name; the directories will created if
    needed. It is highly recommended that those files are placed on a local
    drive and not an NFS share. (Context: server config)</p><p>Default: $server_root/logs/</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e575"/>3.5.3. Maxcontext</h3></div></div></div><p>Maxcontext: That is the number max of contexts supported by
    mod_cluster. (Context: server config)</p><p>Default: 100</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e582"/>3.5.4. Maxnode</h3></div></div></div><p>Maxnode: That is the number max nodes supported by mod_cluster.
          (Context: server config)</p><p>Default: 20</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e589"/>3.5.5. Maxhost</h3></div></div></div><p>Maxhost: That is the number max host (Aliases) supported by
    mod_cluster. That is also the max number of balancers.
    (Context: server config)</p><p>Default: 20</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e596"/>3.5.6. Maxsessionid</h3></div></div></div><p>Maxsessionid: That is the number of active sessionid we store to
    give number of active sessions in the mod_cluster-manager handler. A
    session is unactive when mod_cluster doesn't receive any information from
    the session in 5 minutes. (Context: server config)</p><p>Default: 0 (the logic is not activated).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e603"/>3.5.7. MaxMCMPMaxMessSize</h3></div></div></div><p>MaxMCMPMaxMessSize:  Maximum size of MCMP messages.
     from other Max directives.</p><p>Default: calculated from other Max directives. Min: 1024</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e610"/>3.5.8. ManagerBalancerName</h3></div></div></div><p>ManagerBalancerName: That is the name of balancer to use when the
    JBoss AS/JBossWeb/Tomcat doesn't provide a balancer name.</p><p>Default: mycluster</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e617"/>3.5.9. PersistSlots</h3></div></div></div><p>PersistSlots: Tell mod_slotmem to persist the nodes, Alias and
    Context in files. (Context: server config)</p><p>Default: Off</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e624"/>3.5.10. CheckNonce</h3></div></div></div><p>CheckNonce: Switch check of nonce when using mod_cluster-manager
    handler on | off Since 1.1.0.CR1</p><p>Default: on Nonce checked</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e631"/>3.5.11. AllowDisplay</h3></div></div></div><p>AllowDisplay: Switch additional display on mod_cluster-manager main page
    on | off Since 1.1.0.GA</p><p>Default: off Only version displayed</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e638"/>3.5.12. AllowCmd</h3></div></div></div><p>AllowCmd: Allow commands using mod_cluster-manager URL
     on | off Since 1.1.0.GA</p><p>Default: on Commmands allowed</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e645"/>3.5.13. ReduceDisplay</h3></div></div></div><p>ReduceDisplay - Reduce the information the main mod_cluster-manager page to allow more nodes in the page.
     on | off</p><p>Default: off Full information displayed</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="SetHandlermod_cluster-manager"/>3.5.14. SetHandler mod_cluster-manager</h3></div></div></div><p>SetHandler mod_cluster-manager: That is the handler to display the
    node mod_cluster sees from the cluster. It displays the information about
    the nodes like INFO and additionaly counts the number of active
    sessions.</p><pre class="programlisting">&lt;Location /mod_cluster-manager&gt;
SetHandler mod_cluster-manager
Order deny,allow
Deny from all
Allow from 127.0.0.1
&lt;/Location&gt;</pre><p>When accessing the location you define in httpd.conf you get
    something like: </p><div class="mediaobject" align="center"><img src="images/mod_status.jpg" align="middle"/></div><p> </p><p>Note that:</p><p>Transferred: Corresponds to the POST data send to the back-end
    server.</p><p>Connected: Corresponds to the number of requests been processed when
    the mod_cluster status page was requested.</p><p>sessions: Corresponds to the number of sessions mod_cluster report
    as active (on which there was a request during the past 5 minutes). That
    field is not present when Maxsessionid is zero.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mod_advertise"/>3.6. mod_advertise</h2></div></div></div><p>mod_advertise uses multicast packets to advertise the VirtualHost
    where it is configured that must be the same VirtualHost where mod_manager
    is defined. Of course at least one mod_advertise must be in the
    VirtualHost to allow mod_cluster to find the right IP and port to give to
    the ClusterListener.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e680"/>3.6.1. ServerAdvertise</h3></div></div></div><p>ServerAdvertise On: Use the advertise mechanism to tell the JBoss
    AS/JBossWeb/Tomcat to whom it should send the cluster
    information.</p><p>ServerAdvertise On http://hostname:port: Tell the hostname and
    port to use. Only needed if the VirtualHost is not defined correctly, if
    the VirtualHost is a <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://httpd.apache.org/docs/2.2/vhosts/name-based.html">Name-based
    Virtual Host</a> or when VirtualHost is not used.</p><p>ServerAdvertise Off: Don't use the advertise mechanism.</p><p>Default: Off. (Any Advertise directive in a VirtualHost sets it to On in the VirtualHost)</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e694"/>3.6.2. AdvertiseGroup</h3></div></div></div><p>AdvertiseGroup IP:port: That is the multicast address to use
    (something like 232.0.0.2:8888 for example). IP should correspond to
    AdvertiseGroupAddress and port to AdvertisePort in the JBoss
    AS/JBossWeb/Tomcat configuration. Note that if JBoss AS is used and the -u
    startup switch is included in the AS startup command, the default
    AdvertiseGroupAddress is the value passed via the -u.
    If port is missing the default port will be used: 23364.</p><p>Default: 224.0.1.105:23364.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e701"/>3.6.3. AdvertiseFrequency</h3></div></div></div><p>AdvertiseFrequency seconds[.miliseconds]: Time between the multicast
    messages advertising the IP and port.</p><p>Default: 10 Ten seconds.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e708"/>3.6.4. AdvertiseSecurityKey</h3></div></div></div><p>AdvertiseSecurityKey value: key string to identify the mod_cluster
    in JBossWEB.</p><p>Default: No default value. Information not sent.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e715"/>3.6.5. AdvertiseManagerUrl</h3></div></div></div><p>AdvertiseManagerUrl value: Not used in this version (It is sent in
    the X-Manager-Url: value header). That is the URL that JBoss
    AS/JBossWeb/Tomcat should use to send information to mod_cluster</p><p>Default: No default value. Information not sent.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e722"/>3.6.6. AdvertiseBindAddress</h3></div></div></div><p>AdvertiseBindAddress IP:port: That is the address and port httpd is
    bind to send the multicast messages. This allow to specify an address on
    multi IP address boxes.</p><p>Default: 0.0.0.0:23364</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="MinimalExample"/>3.7. Minimal Example</h2></div></div></div><pre class="programlisting">LoadModule proxy_module modules/mod_proxy.so
 LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
 LoadModule slotmem_module modules/mod_slotmem.so
 LoadModule manager_module modules/mod_manager.so
 LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
 LoadModule advertise_module modules/mod_advertise.so
 
 Listen 10.33.144.3:6666
 &lt;VirtualHost 10.33.144.3:6666&gt;
 
   &lt;Location /&gt;
      Order deny,allow
      Deny from all
      Allow from 10.33.144.
   &lt;/Location&gt;
 
 KeepAliveTimeout 60
 MaxKeepAliveRequests 0
 
 ManagerBalancerName mycluster
 ServerAdvertise On
 EnableMCPMReceive
 
 &lt;/VirtualHost&gt;</pre></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="native.building"/>Chapter 4. Building httpd modules</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e738">4.1. Build a patched httpd from it sources</a></span></dt><dt><span class="section"><a href="#d0e758">4.2. Build the 4 modules of mod_cluster</a></span></dt><dt><span class="section"><a href="#d0e784">4.3. Build the mod_proxy module</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e738"/>4.1. Build a patched httpd from it sources</h2></div></div></div><p>To build httpd-2.2.x from its sources see <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://httpd.apache.org/docs/2.2/install.html">ASF httpd
    doc</a></p><p>If needed, patch the httpd-2.2.x sources with (The patch prevents
    long waiting time when the node IP can't be resolved that should not
    happen so you can skip the patch part if you don't want to rebuild httpd).
    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://github.com/modcluster/mod_cluster/blob/master/native/mod_proxy_cluster/mod_proxy_ajp.patch">mod_proxy_ajp.patch</a></p><pre class="programlisting">(cd modules/proxy
  patch -p0 &lt; $location/mod_proxy_ajp.patch
 )</pre><p>Configure httpd with something like:</p><pre class="programlisting">./configure  --prefix=apache_installation_directory \
             --with-mpm=worker \
             --enable-mods-shared=most \
             --enable-maintainer-mode \
             --with-expat=builtin \
             --enable-ssl \
             --enable-proxy \
             --enable-proxy-http \
             --enable-proxy-ajp \
             --disable-proxy-balancer</pre><p>Rebuild (make) and reinstall (make install) after that.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e758"/>4.2. Build the 4 modules of mod_cluster</h2></div></div></div><p>You need an httpd installation with mod_proxy (--enable-proxy) and
    ajp protocol (--enable-proxy-ajp) enabled and with dso enabled
    (--enable-so)</p><p>Download the mod_cluster sources:</p><pre class="programlisting">git clone git://github.com/modcluster/mod_cluster.git</pre><p>Build the mod_cluster modules components, for each subdirectory
    advertise, mod_manager, mod_proxy_cluster and mod_slotmem do something
    like:</p><pre class="programlisting">sh buildconf
 ./configure --with-apxs=apxs_file_location
 make
 cp *.so apache_installation_directory/modules</pre><p>Where apache_installation_directory is the location of an installed
    version of httpd-2-2.x.</p><p>NOTE: You can ignore the libtool message on most platform:</p><pre class="programlisting">libtool: install: warning: remember to run `libtool --finish apache_installation_directory/modules'</pre><p>Once that is done use <a href="#native.config" title="Chapter 3. httpd configuration">Apache httpd
    configuration</a> to configure mod_cluster.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e784"/>4.3. Build the mod_proxy module</h2></div></div></div><p>It is only needed for httpd-2.2.x where x &lt; 11. Process like the
    other mod_cluster modules.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="native.install"/>Chapter 5. Installing httpd modules</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e802">5.1. Configuration</a></span></dt><dt><span class="section"><a href="#d0e813">5.2. Installing and using the bundles</a></span></dt></dl></div><p>Several bundles are available at <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/mod_cluster/downloads.html">http://www.jboss.org/mod_cluster/downloads.html</a>.</p><p>In case you can't find a prepared package of mod_cluser in the
  download area, it is possible to build mod_cluster for the sources. You need
  a distribution of httpd (at least 2.2.8) or (better) a source tarball of
  httpd and the sources of mod_cluster. <a href="#native.building" title="Chapter 4. Building httpd modules">Building</a>
  explains how to build mod_cluster for it sources.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e802"/>5.1. Configuration</h2></div></div></div><p>A minimal configuration is needed in httpd (See <a href="#native.config" title="Chapter 3. httpd configuration">httpd.conf</a>).
    A listener must be a added in in JBossWEB conf/server.xml (See <a href="#java.config" title="Chapter 6. Server-side Configuration">Configuring JBoss
    AS/Web</a>).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e813"/>5.2. Installing and using the bundles</h2></div></div></div><p>The bundles are tar.gz on POSIX platforms just extract them in root
    something like:</p><pre class="programlisting">  cd /
  tar xvf mod-cluster-1.0.0-linux2-x86-ssl.tar.gz</pre><p>The httpd.conf is located in /opt/jboss/httpd/httpd/conf to quick
    test just add something like:</p><pre class="programlisting">Listen 10.33.144.3:6666
 &lt;VirtualHost 10.33.144.3:6666&gt;
 
   &lt;Directory /&gt;
      Order deny,allow
      Deny from all
      Allow from 10.33.144.
   &lt;/Directory&gt;
 
 KeepAliveTimeout 60
 MaxKeepAliveRequests 0
 
 ManagerBalancerName mycluster
 AdvertiseFrequency 5
 
 &lt;/VirtualHost&gt;</pre><p>To start httpd do the following:</p><pre class="programlisting">/opt/jboss/httpd/sbin/apachectl start</pre><p>NOTE: Make sure to use SSL before going in production.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="java.config"/>Chapter 6. Server-side Configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#ModClusterListener">6.1. JBoss AS</a></span></dt><dd><dl><dt><span class="section"><a href="#ModClusterService">6.1.1. Non-clustered mode</a></span></dt><dt><span class="section"><a href="#ModClusterConfig">6.1.2. Configuration Properties</a></span></dt><dt><span class="section"><a href="#d0e923">6.1.3. Connectors</a></span></dt><dt><span class="section"><a href="#jvm-route">6.1.4. Node Identity</a></span></dt></dl></dd><dt><span class="section"><a href="#tomcat">6.2. JBoss Web &amp; Tomcat</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1005">6.2.1. Lifecycle Listener</a></span></dt><dt><span class="section"><a href="#d0e1022">6.2.2. Additional Tomcat dependencies</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1030">6.3. Migrating from 1.1.x</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1035">6.3.1. mod_cluster-jboss-beans.xml</a></span></dt><dt><span class="section"><a href="#d0e1043">6.3.2. server.xml</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1048">6.4. Migrating from 1.0.x</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1053">6.4.1. Dependency with JBoss Web</a></span></dt><dt><span class="section"><a href="#d0e1065">6.4.2. server.xml</a></span></dt><dt><span class="section"><a href="#d0e1099">6.4.3. mod_cluster-jboss-beans.xml</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ModClusterListener"/>6.1. JBoss AS</h2></div></div></div><p>mod_cluster is supported in AS7 via the modcluster subsystem See  <a href="#java.AS7config" title="Chapter 7. AS7 modcluster subsystem Configuration">AS7</a>.</p><p>In other AS version mod_cluster's configuration resides within the following file:</p><p><code class="code">$JBOSS_HOME/server/$PROFILE/deploy/mod_cluster.sar/META-INF/mod_cluster-jboss-beans.xml</code> file.</p><p>
      The entry point for mod_cluster's server-side configuration is the <code class="code">ModClusterListener</code> bean, which delegates web container (i.e. JBoss Web) specific events to a container agnostic event handler.
    </p><p>In general, the <code class="code">ModClusterListener</code> bean defines:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
          A <code class="code">ContainerEventHandler</code> in which to handle events from the web container.
          There are two available implementations, the choice of which dictates the mode in which mod_cluster will operate: <a href="#">clustered</a> or <a href="#ModClusterService" title="6.1.1. Non-clustered mode">non-clustered</a>.
        </p></li><li><p>
          A reference to the JBoss mbean server.
        </p></li></ol></div><p>e.g.</p><pre class="programlisting">&lt;bean name="ModClusterListener" class="org.jboss.modcluster.container.jbossweb.JBossWebEventHandlerAdapter"&gt; 
  &lt;constructor&gt; 
    &lt;parameter class="org.jboss.modcluster.container.ContainerEventHandler"&gt; 
      &lt;inject bean="ModClusterService"/&gt;&lt;!-- Non-clustered mode --&gt; 
      &lt;!--inject bean="HAModClusterService"/--&gt;&lt;!-- Clustered mode --&gt; 
    &lt;/parameter&gt; 
    &lt;parameter class="javax.management.MBeanServer"&gt; 
      &lt;inject bean="JMXKernel" property="mbeanServer"/&gt; 
    &lt;/parameter&gt; 
  &lt;/constructor&gt; 
&lt;/bean&gt;</pre><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ModClusterService"/>6.1.1. Non-clustered mode</h3></div></div></div><p>
        In non-clustered mode, each JBoss AS node communicates with the load balancer directly, and do not communicate with each other.
        Non-clustered mode is configured via the <code class="code">ModClusterService</code> bean.
      </p><p>In general, the <code class="code">ModClusterService</code> bean defines:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
            An object containing mod_cluster's <a href="#ModClusterConfig" title="6.1.2. Configuration Properties">configuration properties</a>.
          </p></li><li><p>
            An object responsible for calculating the load balance factor for this node.
            This is described in detail in the chapter entitled <a href="#java.load" title="Chapter 10. Server-Side Load Metrics">Server-Side Load Metrics</a>.
          </p></li></ol></div><p>e.g.</p><pre class="programlisting">&lt;bean name="ModClusterService" class="org.jboss.modcluster.ModClusterService" mode="On Demand"&gt; 
  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=ModCluster",exposedInterface=org.jboss.modcluster.ModClusterServiceMBean.class)&lt;/annotation&gt; 
  &lt;constructor&gt; 
    &lt;parameter class="org.jboss.modcluster.config.ModClusterConfig"&gt; 
      &lt;inject bean="ModClusterConfig"/&gt; 
    &lt;/parameter&gt; 
    &lt;parameter class="org.jboss.modcluster.load.LoadBalanceFactorProvider"&gt; 
      &lt;inject bean="DynamicLoadBalanceFactorProvider"/&gt; 
    &lt;/parameter&gt; 
  &lt;/constructor&gt; 
&lt;/bean&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ModClusterConfig"/>6.1.2. Configuration Properties</h3></div></div></div><p>
        The <code class="code">ModClusterConfig</code> bean enumerates the configuration properties used by mod_cluster.
        For the complete list of configuration properties and their default values, see the chapter entitled <a href="#java.properties" title="Chapter 9. Server-side Configuration Properties">Server-side Configuration Properties</a>.
      </p><p>e.g.</p><pre class="programlisting">
&lt;bean name="ModClusterConfig" class="org.jboss.modcluster.config.ha.HAModClusterConfig" mode="On Demand"&gt;
  &lt;!-- Specify configuration properties here --&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e923"/>6.1.3. Connectors</h3></div></div></div><p>
        Like mod_jk and mod_proxy_balancer, mod_cluster requires a connector in your server.xml to which to forward web requests.
        Unlike mod_jk and mod_proxy_balancer, mod_cluster is not confined to AJP, but can use HTTP as well.
        While AJP is generally faster, an HTTP connector can optionally be secured via SSL.
        If multiple possible connectors are defined in your server.xml, mod_cluster uses the following algorithm to choose between them:
      </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>If an native (APR) AJP connector is available, use it.</p></li><li><p>If an AJP connector is available, use it.</p></li><li><p>Otherwise, choose the HTTP connector with the highest max threads.</p></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="jvm-route"/>6.1.4. Node Identity</h3></div></div></div><p>
        Like mod_jk and mod_proxy_balancer, mod_cluster identifies each node via a unique <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.jboss.org/jbossweb/2.1.x/config/engine.html">jvm route</a>.
        By default, mod_cluster uses the following algorithm to assign the jvm route for a given node:
      </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
            Use the value from <code class="code">server.xml</code>, <code class="code">&lt;Engine jvmRoute="..."/&gt;</code>, if defined.
          </p></li><li><p>
            Generate a jvm route using the configured <a href="#">???</a>.
            The default implementation does the following:
            </p><div class="orderedlist"><ol><li><p>Use the value of the <code class="code">jboss.mod_cluster.jvmRoute</code> system property, if defined.</p></li><li><p>Generate a UUID.</p></li></ol></div><p>
          </p></li></ol></div><p>
        While UUIDs are ideal for production systems, in a development or testing environment, it is useful to know which node served a given request just by looking at the jvm route.
        In this case, you can utilize the <code class="code">org.jboss.modcluster.SimpleJvmRouteFactory</code>.
        The factory generates jvm routes of the form:
      </p><p><span class="emphasis"><em>bind-address</em></span>:<span class="emphasis"><em>port</em></span>:<span class="emphasis"><em>engine-name</em></span></p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="tomcat"/>6.2. JBoss Web &amp; Tomcat</h2></div></div></div><p>
      mod_cluster's entire configuration for JBoss Web or Tomcat resides entirely within <code class="code">$CATALINA_HOME/conf/server.xml</code>.
    </p><p>
      This limits the adds the following constraints to mod_cluster's feature set:
    </p><div class="itemizedlist"><ul><li><p>Only non-clustered mode is supported</p></li><li><p><a href="#java.load" title="Chapter 10. Server-Side Load Metrics">Only one load metric</a> can be used to calculate a load factor.</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1005"/>6.2.1. Lifecycle Listener</h3></div></div></div><p>
        The entry point for JBoss Web and Tomcat configuration is the ModClusterListener.
        All mod_cluster <a href="#java.properties" title="Chapter 9. Server-side Configuration Properties">configuration properties</a> are defined as attributes of the <code class="code">&lt;Listener/&gt;</code> element.
        For the complete list of configuration properties and their default values, see the chapter entitled <a href="#java.properties" title="Chapter 9. Server-side Configuration Properties">Server-side Configuration Properties</a>.
      </p><p>e.g.</p><pre class="programlisting">&lt;Listener className="org.jboss.modcluster.container.catalina.standalone.ModClusterListener" advertise="true"/&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1022"/>6.2.2. Additional Tomcat dependencies</h3></div></div></div><p>mod_cluster uses jboss-logging, which exists in JBoss Web, but not
      in Tomcat. Consequently, to use mod_cluster with Tomcat, it is necessary
      to add <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://repository.jboss.org/nexus/content/groups/public-jboss/org/jboss/logging/jboss-logging-spi/">jboss-logging-spi.jar</a>
      to $CATALINA_HOME/lib.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1030"/>6.3. Migrating from 1.1.x</h2></div></div></div><p>
      In mod_cluster 1.2.x the web containers now are separed cleanly, that requires you to change
      standalone and mbean configuration a little.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1035"/>6.3.1. mod_cluster-jboss-beans.xml</h3></div></div></div><p>
        The JBoss microcontainer configuration for mod_cluster 1.1.x is <span class="emphasis"><em>not</em></span> compatible with the configuration for 1.2.x.
        you need to change the ModClusterListener mbean class to:
        "org.jboss.modcluster.container.jbossweb.JBossWebEventHandlerAdapter".
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1043"/>6.3.2. server.xml</h3></div></div></div><p>
       You need to change the  &lt;Listener/&gt; element className to:
       "org.jboss.modcluster.container.catalina.standalone.ModClusterListener".
      </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1048"/>6.4. Migrating from 1.0.x</h2></div></div></div><p>
      In mod_cluster 1.0.x, you were required to make several manual configuration changes to the jbossweb service before mod_cluster would be usable.
      mod_cluster 1.1.x eliminates much of this hassle - and is designed to be fully functional out of the box.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1053"/>6.4.1. Dependency with JBoss Web</h3></div></div></div><p>
        In 1.0.x, mod_cluster needed to be deployed <span class="emphasis"><em>before</em></span> JBoss Web.
        This ensured that mod_cluster was available to handle web application deployment lifecycle events during triggered during server startup.
        To achieve this, you had to add an explicit dependency on mod_cluster to jbossweb's jboss-beans.xml config file.
      </p><p>
        mod_cluster 1.1.x reverses this dependency, such that mod_cluster now depends on JBoss Web.
        Consequently, you no longer need to make any changes to JBoss Web's jboss-beans.xml file.
      </p><p>
        As an additional consequence of this dependency reversal, mod_cluster can now be hot-deployed or undeployed to a running server without consequence to the JBoss Web service.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1065"/>6.4.2. server.xml</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1068"/>6.4.2.1. Lifecycle listener</h4></div></div></div><p>
          mod_cluster 1.0.x required you to add a lifecycle &lt;Listener/&gt; element to server.xml.
        </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1073"/>6.4.2.1.1. JBoss AS</h5></div></div></div><p>
            The <a href="#ModClusterListener" title="6.1. JBoss AS">ModClusterListener</a> bean now registers itself with the JBoss Web server upon deploying the mod_cluster service; and deregisters itself upon undeploy.
            Consequently, you no longer need to manually add a &lt;Listener/&gt; to server.xml.
          </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1081"/>6.4.2.1.2. JBoss Web &amp; Tomcat</h5></div></div></div><p>
            You still need to use a lifecycle &lt;Listener/&gt; element in server.xml, but it's location has changed.
            In 1.1.x, the ModClusterListener class was refactored into the catalina container SPI implementation package, and the old location was deprecated.
          </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1086"/>6.4.2.2. JVM Route</h4></div></div></div><p>
          In mod_cluster 1.0.x, you needed to add a unique jvmRoute to the &lt;Engine/&gt; element within server.xml.
          In 1.1.x, this is now optional.
          The auto-assignment of a jvm route is described in the <a href="#jvm-route" title="6.1.4. Node Identity">previous section</a>.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1094"/>6.4.2.3. Connector bind address</h4></div></div></div><p>
          In mod_cluster 1.0.x, you had the option of manually setting the connector bind address, to restrict the network interface on which mod_cluster would listen for proxied requests from the load balancer.
          In mod_cluster 1.1.x, this no longer necessary.
          mod_cluster will set the bind address automatically, based on the interface on which mod_cluster's internal connection was established.
        </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1099"/>6.4.3. mod_cluster-jboss-beans.xml</h3></div></div></div><p>
        The JBoss microcontainer configuration for mod_cluster 1.0.x is <span class="emphasis"><em>not</em></span> compatible with the configuration for 1.1.x.
        If you had customized your mod_cluster 1.0.x configuration, please start with the default configuration contained in the 1.1.x mod_cluster.sar and reapply any changes.
      </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1107"/>6.4.3.1. Configuration changes</h4></div></div></div><p>
          The following configuration properties were renamed between 1.0.x and 1.1.x:
        </p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Deprecated property name</th><th>Replacement property name</th></tr></thead><tbody><tr><td>domain</td><td>loadBalancingGroup</td></tr><tr><td>masterPerDomain</td><td>masterPerLoadBalancingGroup</td></tr><tr><td>sslKeyStorePass</td><td>sslKeyStorePassword</td></tr></tbody></table></div></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="java.AS7config"/>Chapter 7. AS7 modcluster subsystem Configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#ModClusterSubSystem">7.1. ModCluster Subsystem in JBoss AS7</a></span></dt><dt><span class="section"><a href="#ModClusterSubSystemMiniConfiguration">7.2. ModCluster Subsystem minimal configuration</a></span></dt><dt><span class="section"><a href="#ModClusterSubSystemConfiguration">7.3. ModCluster Subsystem configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#AS7ModClusterConfig">7.3.1. mod-cluster-config Attributes</a></span></dt><dt><span class="section"><a href="#SimpleLoadProvider">7.3.2. simple-load-provider Attributes</a></span></dt><dt><span class="section"><a href="#DynamicLoadProvider">7.3.3. dynamic-load-provider Attributes</a></span></dt><dt><span class="section"><a href="#LoadMetric">7.3.4. load-metric Configuration</a></span></dt><dt><span class="section"><a href="#CustomLoadMetric">7.3.5. custom-load-metric Configuration</a></span></dt><dt><span class="section"><a href="#UsingJBossConsole">7.3.6. load-metric Configuration with the jboss admin console</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ModClusterSubSystem"/>7.1. ModCluster Subsystem in JBoss AS7</h2></div></div></div><p>The mod_cluster integration is done via the modcluster subsystem. In AS7 only 1.1.x is supported.
          Addition HA is not supported in AS version 7.0.x but in it will be in version 7.1.x and after.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ModClusterSubSystemMiniConfiguration"/>7.2. ModCluster Subsystem minimal configuration</h2></div></div></div><p>The minimal configuration is having the modcluster <code class="code">schemaLocation</code> in the <code class="code">schemaLocation</code> list:
    </p><pre class="programlisting">urn:jboss:domain:modcluster:1.0 jboss-mod-cluster.xsd</pre><p>
    and the <code class="code">extension module</code> in the <code class="code">extensions</code> list:
    </p><pre class="programlisting">&lt;extension module="org.jboss.as.modcluster"/&gt;</pre><p>
    and <code class="code">subsystem</code> declaration like:
    </p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:modcluster:1.0"/&gt;</pre><p>
    With that configuration modcluster will listen for advertise on <code class="code">224.0.1.105:23364</code> use the <code class="code">simple-load-provider</code> with
    a load factor of 1.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ModClusterSubSystemConfiguration"/>7.3. ModCluster Subsystem configuration</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="AS7ModClusterConfig"/>7.3.1. mod-cluster-config Attributes</h3></div></div></div><p>The attributs correspond to the <a href="#java.properties" title="Chapter 9. Server-side Configuration Properties">properties</a>
       </p><p>Proxy Discovery Configuration</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>Property</th><th>Default</th></tr></thead><tbody><tr><td>proxy-list</td><td>proxyList</td><td><span class="emphasis"><em>None</em></span></td></tr><tr><td>proxy-url</td><td>proxyURL</td><td><span class="emphasis"><em>None</em></span></td></tr><tr><td>advertise</td><td>advertise</td><td><span class="emphasis"><em>true</em></span></td></tr><tr><td>advertise-security-key</td><td>advertiseSecurityKey</td><td><span class="emphasis"><em>None</em></span></td></tr><tr><td>excluded-contexts</td><td>excludedContexts</td><td><span class="emphasis"><em>None</em></span></td></tr><tr><td>auto-enable-contexts</td><td>autoEnableContexts</td><td><span class="emphasis"><em>true</em></span></td></tr><tr><td>stop-context-timeout</td><td>stopContextTimeout</td><td><span class="emphasis"><em>10 seconds (in seconds)</em></span></td></tr><tr><td>socket-timeout</td><td>nodeTimeout</td><td><span class="emphasis"><em>20 seconds (in milli seconds)</em></span></td></tr></tbody></table></div><p>Proxy Configuration</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>Property</th><th>Default</th></tr></thead><tbody><tr><td>sticky-session</td><td>stickySession</td><td><span class="emphasis"><em>true</em></span></td></tr><tr><td>sticky-session-remove</td><td>stickySessionRemove</td><td><span class="emphasis"><em>false</em></span></td></tr><tr><td>sticky-session-force</td><td>stickySessionForce</td><td><span class="emphasis"><em>true</em></span></td></tr><tr><td>node-timeout</td><td>workerTimeout</td><td><span class="emphasis"><em>-1</em></span></td></tr><tr><td>max-attempts</td><td>maxAttempts</td><td><span class="emphasis"><em>1</em></span></td></tr><tr><td>flush-packets</td><td>flushPackets</td><td><span class="emphasis"><em>false</em></span></td></tr><tr><td>flush-wait</td><td>flushWait</td><td><span class="emphasis"><em>-1</em></span></td></tr><tr><td>ping</td><td>ping</td><td><span class="emphasis"><em>10</em></span></td></tr><tr><td>smax</td><td>smax</td><td><span class="emphasis"><em>-1</em></span> it uses default value</td></tr><tr><td>ttl</td><td>ttl</td><td><span class="emphasis"><em>-1</em></span> it uses default value</td></tr><tr><td>domain</td><td>loadBalancingGroup</td><td><span class="emphasis"><em>None</em></span></td></tr><tr><td>load-balancing-group</td><td>loadBalancingGroup</td><td><span class="emphasis"><em>None</em></span></td></tr></tbody></table></div><p>SSL Configuration</p><p>SSL configuration part needs to be added here too</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="SimpleLoadProvider"/>7.3.2. simple-load-provider Attributes</h3></div></div></div><p>The simple load provider always send the same load factor. That is the default one. Example:</p><pre class="programlisting">
&lt;subsystem xmlns="urn:jboss:domain:modcluster:1.0"&gt;
  &lt;mod-cluster-config&gt;
    &lt;simple-load-provider load="1"/&gt;
  &lt;/mod-cluster-config&gt;
&lt;/subsystem&gt;
     </pre><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>Property</th><th>Default</th></tr></thead><tbody><tr><td>factor</td><td>LoadBalancerFactor</td><td><span class="emphasis"><em>1</em></span></td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="DynamicLoadProvider"/>7.3.3. dynamic-load-provider Attributes</h3></div></div></div><p>The dynamic load provide allows to have <code class="code">load-metric</code> as well as <code class="code">custom-load-metric</code> defined. For example:</p><pre class="programlisting">
&lt;subsystem xmlns="urn:jboss:domain:modcluster:1.0"&gt;
  &lt;mod-cluster-config advertise-socket="mod_cluster"&gt;
    &lt;dynamic-load-provider history="10" decay="2"&gt;
       &lt;load-metric type="cpu" weight="2" capacity="1"/&gt;
       &lt;load-metric type="sessions" weight="1" capacity="512"/&gt;
       &lt;custom-load-metric class="mypackage.myclass" weight="1" capacity="512"&gt;
          &lt;property name="myproperty" value="myvalue" /&gt;
          &lt;property name="otherproperty" value="othervalue" /&gt;
       &lt;/custom-load-metric&gt;
    &lt;/dynamic-load-provider&gt;
  &lt;/mod-cluster-config&gt;
&lt;/subsystem&gt;
     </pre><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>Property</th><th>Default</th></tr></thead><tbody><tr><td>history</td><td>history</td><td>512</td></tr><tr><td>decay</td><td>decayFactor</td><td>512</td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="LoadMetric"/>7.3.4. load-metric Configuration</h3></div></div></div><p>The load-metric are the "classes" collecting information to allow computation of the load factor sent to httpd</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>Property</th><th>Default</th></tr></thead><tbody><tr><td>type</td><td>A Server-Side Load Metrics</td><td><span class="emphasis"><em>Mandatory</em></span></td></tr><tr><td>weight</td><td>weight</td><td><span class="emphasis"><em>9</em></span></td></tr><tr><td>capacity</td><td>capacity</td><td><span class="emphasis"><em>512</em></span></td></tr></tbody></table></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="CustomLoadMetricType"/>7.3.4.1. Supported load metric types</h4></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th>type</th><th>Corresponding Server-Side Load Metric</th></tr></thead><tbody><tr><td>cpu</td><td><a href="#AverageSystemLoadMetric" title="10.2.1. AverageSystemLoadMetric">AverageSystem</a>LoadMetric</td></tr><tr><td>mem</td><td><a href="#SystemMemoryUsageLoadMetric" title="10.2.2. SystemMemoryUsageLoadMetric">SystemMemoryUsage</a>LoadMetric</td></tr><tr><td>heap</td><td><a href="#HeapMemoryUsageLoadMetric" title="10.2.3. HeapMemoryUsageLoadMetric">HeapMemoryUsage</a>LoadMetric</td></tr><tr><td>sessions</td><td><a href="#ActiveSessionsLoadMetric" title="10.1.1. ActiveSessionsLoadMetric">ActiveSessions</a>LoadMetric</td></tr><tr><td>requests</td><td><a href="#RequestCountLoadMetric" title="10.1.5. RequestCountLoadMetric">ActiveSessions</a>LoadMetric</td></tr><tr><td>send-traffic</td><td><a href="#SendTrafficLoadMetric" title="10.1.4. SendTrafficLoadMetric">SendTraffic</a>LoadMetric</td></tr><tr><td>receive-traffic</td><td><a href="#ReceiveTrafficLoadMetric" title="10.1.3. ReceiveTrafficLoadMetric">ReceiveTraffic</a>LoadMetric</td></tr><tr><td>busyness</td><td><a href="#BusyConnectorsLoadMetric" title="10.1.2. BusyConnectorsLoadMetric">BusyConnectors</a>LoadMetric</td></tr><tr><td>connection-pool</td><td><a href="#ConnectionPoolUsageLoadMetric" title="10.3.1. ConnectionPoolUsageLoadMetric">ConnectionPoolUsage</a>LoadMetric</td></tr></tbody></table></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="CustomLoadMetric"/>7.3.5. custom-load-metric Configuration</h3></div></div></div><p>The custom-load-metric are for user defined "classes" collecting information. They are like the load-metric except <code class="code">type</code>
           is replaced by <code class="code">class</code>:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>Property</th><th>Default</th></tr></thead><tbody><tr><td>class</td><td>Name of your class</td><td><span class="emphasis"><em>Mandatory</em></span></td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="UsingJBossConsole"/>7.3.6. load-metric Configuration with the jboss admin console</h3></div></div></div><p>The load-metric have 4 commands to add / remove metrics</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="AddMetric"/>7.3.6.1. add-metric</h4></div></div></div><p>Allows to add a <code class="code">load-metric</code> to the <code class="code">dynamic-load-provider</code></p><p>For example:</p><pre class="programlisting">
       ./:add-metric(type=cpu, weight=2, capacity=1)
       </pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="RemoveMetric"/>7.3.6.2. remove-metric</h4></div></div></div><p>Allows to remove a <code class="code">load-metric</code> from the <code class="code">dynamic-load-provider</code></p><p>For example:</p><pre class="programlisting">
       ./:remove-metric(type=cpu)
       </pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="AddCustomMetric"/>7.3.6.3. add-custom-metric</h4></div></div></div><p>Allows to add a <code class="code">load-custom-metric</code> to the <code class="code">dynamic-load-provider</code></p><p>For example:</p><pre class="programlisting">
       ./:add-custom-metric(class=myclass, weight=2, capacity=1, property=[("pool" =&gt; "mypool"), ("var" =&gt; "myvariable")])
       </pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="RemoveCustomMetric"/>7.3.6.4. remove-custom-metric</h4></div></div></div><p>Allows to remove a <code class="code">load-custom-metric</code> from the <code class="code">dynamic-load-provider</code></p><p>For example:</p><pre class="programlisting">
       ./:remove-custom-metric(class=myclass)
       </pre></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="java.building"/>Chapter 8. Building Server-Side Components</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e1655">8.1. Requirements</a></span></dt><dt><span class="section"><a href="#d0e1667">8.2. Building</a></span></dt><dt><span class="section"><a href="#d0e1692">8.3. Build Artifacts</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1655"/>8.1. Requirements</h2></div></div></div><p>
      Building mod_cluster's server-side components from source requires the following tools:
    </p><div class="itemizedlist"><ul><li><p>JDK 5.0+</p></li><li><p>Maven 2.0+</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1667"/>8.2. Building</h2></div></div></div><p>Steps to build:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Download the mod_cluster sources</p><p>
          </p><pre class="programlisting">git clone git://github.com/modcluster/mod_cluster.git</pre><p>
        </p></li><li><p>Use maven "dist" profile to build:</p><p>
</p><pre class="programlisting">cd mod_cluster
mvn -P dist package</pre><p>
        </p></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
        Some unit tests require UDP port 23365.
        Make sure your local firewall allows the port.
      </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1692"/>8.3. Build Artifacts</h2></div></div></div><p>The build produces the following output in the target directory:</p><div class="variablelist"><dl><dt><span class="term">mod-cluster.sar</span></dt><dd><p>Exploded format sar to copy to the deploy dir in your JBoss AS install</p></dd><dt><span class="term">JBossWeb-Tomcat/lib directory</span></dt><dd><p>Jar files to copy to the lib directory in your JBossWeb or Tomcat install to support use of mod_cluster</p></dd><dt><span class="term">demo directory</span></dt><dd><p>The <a href="#demo" title="Chapter 15. Load Balancing Demo Application">load balancing demo</a> application</p></dd><dt><span class="term">mod-cluster-XXX.tar.gz</span></dt><dd><p>The full distribution tarball; includes the above elements</p></dd></dl></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="java.properties"/>Chapter 9. Server-side Configuration Properties</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#mcmp">9.1. Proxy Discovery Configuration</a></span></dt><dt><span class="section"><a href="#proxy">9.2. Proxy Configuration</a></span></dt><dt><span class="section"><a href="#ssl">9.3. SSL Configuration</a></span></dt><dt><span class="section"><a href="#load">9.4. Load Configuration for JBoss Web and Tomcat</a></span></dt></dl></div><p>The tables below enumerate the configuration properties available to an application server node. The location for these properties depends on <a href="#java.config" title="Chapter 6. Server-side Configuration">how mod_cluster is configured</a>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mcmp"/>9.1. Proxy Discovery Configuration</h2></div></div></div><p>The list of proxies from which an application expects to receive AJP connections is either defined statically, via the addresses defined in the <a href="#proxyList">proxyList</a> configuration property; or discovered dynamically via the advertise mechanism. Using a special mod_advertise module, proxies can advertise their existence by periodically broadcasting a multicast message containing its address/port. This functionality is enabled via the <a href="#advertise">advertise</a> configuration property. If configured to listen, a server can learn of the proxy's existence, then notify that proxy of its own existence, and update its configuration accordingly. This frees both the proxy <span class="emphasis"><em>and</em></span> the server from having to define static, environment-specific configuration values.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>AS7 Attribute</th><th>Default</th><th>Scope</th><th>Description</th></tr></thead><tbody><tr><td><a id="proxyList"/>proxyList</td><td>proxy-list</td><td><span class="emphasis"><em>None</em></span></td><td>Configuration</td><td>
              <p>Defines a comma delimited list of httpd proxies with which this node will initially communicate. Value should be of the form: </p>
              <p><span class="emphasis"><em>address1</em></span>:<span class="emphasis"><em>port1</em></span>,<span class="emphasis"><em>address2</em></span>:<span class="emphasis"><em>port2</em></span></p>
              <p>Using the default configuration, this property can by manipulated via the jboss.mod_cluster.proxyList system property.</p>
            </td></tr><tr><td><a id="excludedContexts"/>excludedContexts</td><td>excluded-contexts</td><td>ROOT, admin-console, invoker, bossws, jmx-console, juddi, web-console</td><td>Configuration</td><td>
              <p>List of contexts to exclude from httpd registration, of the form: </p>
              <p><span class="emphasis"><em>host1</em></span>:<span class="emphasis"><em>context1</em></span>,<span class="emphasis"><em>host2</em></span>:<span class="emphasis"><em>context2</em></span>,<span class="emphasis"><em>host3</em></span>:<span class="emphasis"><em>context3</em></span></p>
              <p>If no host is indicated, it is assumed to be the default host of the server (e.g. localhost). "ROOT" indicates the root context. Using the default configuration, this property can by manipulated via the jboss.mod_cluster.excludedContexts system property.</p>
            </td></tr><tr><td>autoEnableContexts</td><td>auto-enable-contexts</td><td>true</td><td>Configuration</td><td>
              <p>If false the contexts are registered disabled in httpd, they need to be enabled via the enable() mbean method or via mod_cluster_manager.</p>
            </td></tr><tr><td><a id="stopContextTimeout"/>stopContextTimeout</td><td>stop-context-timeout</td><td>10</td><td>Configuration</td><td>
              <p>The amount of time, measure in units specified by <a href="#stopContextTimeoutUnit">stopContextTimeoutUnit</a>, for which to wait for clean shutdown of a context (completion of pending requests for a distributable context; or destruction/expiration of active sessions for a non-distributable context).</p>
            </td></tr><tr><td><a id="stopContextTimeoutUnit"/>stopContextTimeoutUnit</td><td><span class="emphasis"><em>None</em></span></td><td>TimeUnit.SECONDS</td><td>Configuration</td><td>
              <p>The unit of time for use with <a href="#stopContextTimeout">stopContextTimeout</a></p>
            </td></tr><tr><td>sessionDrainingStrategy</td><td><span class="emphasis"><em>None</em></span></td><td>org.jboss.modcluster.SessionDrainingStrategyEnum.DEFAULT</td><td>Configuration</td><td>
              <p>
                Indicates the session draining strategy used during undeployment of a web application.
                There are three possible values:
              </p>
              <div class="variablelist"><dl><dt><span class="term">DEFAULT</span></dt><dd><p>Drain sessions before web application undeploy only if the web application is non-disributable.</p></dd><dt><span class="term">ALWAYS</span></dt><dd><p>Always drain sessions before web application undeploy, even for distributable web applications.</p></dd><dt><span class="term">NEVER</span></dt><dd><p>Do not drain sessions before web application undeploy, even for non-distributable web application.</p></dd></dl></div>
            </td></tr><tr><td>proxyURL</td><td>proxy-url</td><td><span class="emphasis"><em>None</em></span></td><td>Apache HTTPD</td><td>
              <p>If defined, this value will be prepended to the URL of MCMP commands.</p>
            </td></tr><tr><td>socketTimeout</td><td>socket-timeout</td><td>20000</td><td>Configuration</td><td>
              <p>Number of milliseconds to wait for a response from an httpd proxy to MCMP commands before timing out, and flagging the proxy as in error.</p>
            </td></tr><tr><td><a id="advertise"/>advertise</td><td>advertise</td><td>true, if <a href="#proxyList">proxyList</a> is undefined, false otherwise</td><td>Configuration</td><td>
              <p>If enabled, httpd proxies will be auto-discovered via multicast announcements. This can be used either in concert or in place of a static <a href="#proxyList">proxyList</a>.</p>
            </td></tr><tr><td>advertiseGroupAddress</td><td>advertise-socket</td><td>224.0.1.105</td><td>Apache HTTPD</td><td>
              <p>UDP address on which to listen for httpd proxy multicast advertisements</p>
              <p>In AS7 that corresponding to the name of a socket-binding</p>
            </td></tr><tr><td>advertisePort</td><td>See advertise-socket</td><td>23364</td><td>Apache HTTPD</td><td>
              <p>UDP port on which to listen for httpd proxy multicast advertisements</p>
            </td></tr><tr><td>advertiseSecurityKey</td><td>advertise-security-key</td><td><span class="emphasis"><em>None</em></span></td><td>Apache HTTPD</td><td>
              <p>If specified, httpd proxy advertisements checksums will be verified using this value as a salt</p>
            </td></tr><tr><td>advertiseThreadFactory</td><td><span class="emphasis"><em>None</em></span></td><td>Executors.defaultThreadFactory()</td><td>Configuration</td><td>
              <p>The thread factory used to create the background advertisement listener.</p>
            </td></tr><tr><td>jvmRouteFactory</td><td><span class="emphasis"><em>None</em></span></td><td>new SystemPropertyJvmRouteFactory(new UUIDJvmRouteFactory(), "jboss.mod_cluster.jvmRoute")</td><td>Configuration</td><td>
             Defines the strategy for determing the jvm route of a node, if none was specified in server.xml.
             The default factory first consults the <code class="code">jboss.mod_cluster.jvmRoute</code> system property.
             If this system property is undefined, the jvm route is assiged a UUID.
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="proxy"/>9.2. Proxy Configuration</h2></div></div></div><p>The following configuration values are sent to proxies during server startup, when a proxy is detected via the advertise mechanism, or during the resetting of a proxy's configuration during error recovery.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>AS7 Attribute</th><th>Default</th><th>Scope</th><th>Description</th></tr></thead><tbody><tr><td><a id="stickySession"/>stickySession</td><td>sticky-session</td><td>true</td><td>Balancer</td><td>
              <p>Indicates whether subsequent requests for a given session should be routed to the same node, if possible.</p>
            </td></tr><tr><td>stickySessionRemove</td><td>sticky-session-remove</td><td>false</td><td>Balancer</td><td>
              <p>Indicates whether the httpd proxy should remove session stickiness in the event that the balancer is unable to route a request to the node to which it is stuck. This property is ignored if <a href="#stickySession">stickySession</a> is false.</p>
            </td></tr><tr><td>stickySessionForce</td><td>sticky-session-force</td><td>false</td><td>Balancer</td><td>
              <p>Indicates whether the httpd proxy should return an error in the event that the balancer is unable to route a request to the node to which it is stuck. This property is ignored if <a href="#stickySession">stickySession</a> is false.</p>
            </td></tr><tr><td>workerTimeout</td><td>worker-timeout</td><td>-1</td><td>Balancer</td><td>
              <p>Number of seconds to wait for a worker to become available to handle a request. When no workers of a balancer are usuable, mod_cluster will retry after a while (workerTimeout/100). That is timeout in the balancer mod_proxy documentation. A value of -1 indicates that the httpd will not wait for a worker to be available and will return an error if none is available.</p>
            </td></tr><tr><td>maxAttempts</td><td>max-attempts</td><td>1</td><td>Balancer</td><td>
              <p>Number of times an httpd proxy will attempt to send a given request to a worker before giving up. The minimum value is 1, meaning try only once. (Note that mod_proxy default is also 1: no retry).</p>
            </td></tr><tr><td>flushPackets</td><td>flush-packets</td><td>false</td><td>Node</td><td>
              <p>Enables/disables packet flushing</p>
            </td></tr><tr><td>flushWait</td><td>flush-wait</td><td>-1</td><td>Node</td><td>
              <p>
                Time to wait before flushing packets in millseconds.
                A value of -1 means wait forever.
              </p>
            </td></tr><tr><td>ping</td><td>ping</td><td>10</td><td>Node</td><td>
              <p>Time (in seconds) in which to wait for a pong answer to a ping</p>
            </td></tr><tr><td>smax</td><td>smax</td><td>Determined by httpd configuration</td><td>Node</td><td>
              <p>Soft maximum idle connection count (that is the smax in worker mod_proxy documentation). The maximum value depends on the httpd thread configuration (ThreadsPerChild or 1).</p>
            </td></tr><tr><td>ttl</td><td>ttl</td><td>60</td><td>Node</td><td>
              <p>Time to live (in seconds) for idle connections above smax</p>
            </td></tr><tr><td>nodeTimeout</td><td>node-timeout</td><td>-1</td><td>Node</td><td>
              <p>
                Timeout (in seconds) for proxy connections to a node.
                That is the time mod_cluster will wait for the back-end response before returning error.
                That corresponds to timeout in the worker mod_proxy documentation.
                A value of -1 indicates no timeout.
                Note that mod_cluster always uses a cping/cpong before forwarding a request and the connectiontimeout value used by mod_cluster is the ping value.
              </p>
            </td></tr><tr><td>balancer</td><td>balancer</td><td>mycluster</td><td>Node</td><td>
              <p>The balancer name</p>
            </td></tr><tr><td><a id="lbGroup"/>loadBalancingGroup</td><td>domain load-balancing-group</td><td><span class="emphasis"><em>None</em></span></td><td>Node</td><td>
              <p>
                If specified, load will be balanced among jvmRoutes withing the same load balancing group.
                A loadBalancingGroup is conceptually equivalent to a mod_jk domain directive.
                This is primarily used in conjunction with partitioned session replication (e.g. buddy replication).
              </p>
            </td></tr></tbody></table></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
        When nodeTimeout is not defined the ProxyTimeout directive Proxy is used.
        If ProxyTimeout is not defined the server timeout (Timeout) is used (default 300 seconds).
        nodeTimeout, ProxyTimeout or Timeout is set at the socket level.
      </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ssl"/>9.3. SSL Configuration</h2></div></div></div><p>
      The communication channel between application servers and httpd proxies uses HTTP by default.
      This channel can be secured using HTTPS by setting the <a href="#ssl-property">ssl</a> property to true.
    </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
        This HTTP/HTTPS channel should not be confused with the processing of HTTP/HTTPS client requests.
      </p></div><div class="informaltable"><table border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>AS7 Attribute</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><a id="ssl-property"/>ssl</td><td><span class="emphasis"><em>None</em></span></td><td>false</td><td>
              <p>Should connection to proxy use a secure socket layer</p>
            </td></tr><tr><td>sslCiphers</td><td>cipher-suite</td><td><span class="emphasis"><em>The default JSSE cipher suites</em></span></td><td>
              <p>Overrides the cipher suites used to init an SSL socket ignoring any unsupported ciphers</p>
            </td></tr><tr><td>sslProtocol</td><td>protocol</td><td>TLS (ALL in AS7)</td><td>
              <p>Overrides the default SSL socket protocol.</p>
            </td></tr><tr><td>sslCertificateEncodingAlgorithm</td><td><span class="emphasis"><em>None</em></span></td><td><span class="emphasis"><em>The default JSSE key manager algorithm</em></span></td><td>
              <p>The algorithm of the key manager factory</p>
            </td></tr><tr><td>sslKeyStore</td><td>certificate-key-file</td><td><code class="code">System.getProperty("user.home") + "/.keystore"</code></td><td>
              <p>The location of the key store containing client certificates</p>
            </td></tr><tr><td>sslKeyStorePassword</td><td>password</td><td>changeit</td><td>
              <p>The password granting access to the key store (and trust store in AS7)</p>
            </td></tr><tr><td>sslKeyStoreType</td><td><span class="emphasis"><em>None</em></span></td><td>JKS</td><td>
              <p>The type of key store</p>
            </td></tr><tr><td>sslKeyStoreProvider</td><td><span class="emphasis"><em>None</em></span></td><td><span class="emphasis"><em>The default JSSE security provider</em></span></td><td>
              <p>The key store provider</p>
            </td></tr><tr><td>sslTrustAlgorithm</td><td><span class="emphasis"><em>None</em></span></td><td><span class="emphasis"><em>The default JSSE trust manager algorithm</em></span></td><td>
              <p>The algorithm of the trust manager factory</p>
            </td></tr><tr><td>sslKeyAlias</td><td>key-alias</td><td> </td><td>
              <p>The alias of the key holding the client certificates in the key store</p>
            </td></tr><tr><td>sslCrlFile</td><td>ca-revocation-url</td><td> </td><td>
              <p>Certificate revocation list</p>
            </td></tr><tr><td>sslTrustMaxCertLength</td><td><span class="emphasis"><em>None</em></span></td><td>5</td><td>
              <p>The maximum length of a certificate held in the trust store</p>
            </td></tr><tr><td>sslTrustStore</td><td><span class="emphasis"><em>None</em></span></td><td><code class="code">System.getProperty("javax.net.ssl.trustStorePassword")</code></td><td>
              <p>The location of the file containing the trust store</p>
            </td></tr><tr><td>sslTrustStorePassword</td><td><span class="emphasis"><em>None</em></span></td><td><code class="code">System.getProperty("javax.net.ssl.trustStore")</code></td><td>
              <p>The password granting access to the trust store.</p>
            </td></tr><tr><td>sslTrustStoreType</td><td><span class="emphasis"><em>None</em></span></td><td><code class="code">System.getProperty("javax.net.ssl.trustStoreType")</code></td><td>
              <p>The trust store type</p>
            </td></tr><tr><td>sslTrustStoreProvider</td><td><span class="emphasis"><em>None</em></span></td><td><code class="code">System.getProperty("javax.net.ssl.trustStoreProvider")</code></td><td>
              <p>The trust store provider</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="load"/>9.4. Load Configuration for JBoss Web and Tomcat</h2></div></div></div><p>Additional configuration properties used when mod_cluster is configured in JBoss Web standalone or Tomcat.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Attribute</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>loadMetricClass</td><td>org.jboss.modcluster.load.metric.impl.BusyConnectorsLoadMetric</td><td>
              <p>Class name of an object implementing org.jboss.load.metric.LoadMetric</p>
            </td></tr><tr><td>loadMetricCapacity</td><td>1</td><td>
              <p>The capacity of the load metric defined via the loadMetricClass property</p>
            </td></tr><tr><td>loadHistory</td><td>9</td><td>
              <p>The number of historic load values to consider in the load balance factor computation.</p>
            </td></tr><tr><td>loadDecayFactor</td><td>2</td><td>
              <p>The factor by which a historic load values should degrade in significance.</p>
            </td></tr></tbody></table></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="java.load"/>Chapter 10. Server-Side Load Metrics</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e2646">10.1. Web Container metrics</a></span></dt><dd><dl><dt><span class="section"><a href="#ActiveSessionsLoadMetric">10.1.1. <code class="code">ActiveSessionsLoadMetric</code></a></span></dt><dt><span class="section"><a href="#BusyConnectorsLoadMetric">10.1.2. <code class="code">BusyConnectorsLoadMetric</code></a></span></dt><dt><span class="section"><a href="#ReceiveTrafficLoadMetric">10.1.3. <code class="code">ReceiveTrafficLoadMetric</code></a></span></dt><dt><span class="section"><a href="#SendTrafficLoadMetric">10.1.4. <code class="code">SendTrafficLoadMetric</code></a></span></dt><dt><span class="section"><a href="#RequestCountLoadMetric">10.1.5. <code class="code">RequestCountLoadMetric</code></a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2761">10.2. System/JVM metrics</a></span></dt><dd><dl><dt><span class="section"><a href="#AverageSystemLoadMetric">10.2.1. <code class="code">AverageSystemLoadMetric</code></a></span></dt><dt><span class="section"><a href="#SystemMemoryUsageLoadMetric">10.2.2. <code class="code">SystemMemoryUsageLoadMetric</code></a></span></dt><dt><span class="section"><a href="#HeapMemoryUsageLoadMetric">10.2.3. <code class="code">HeapMemoryUsageLoadMetric</code></a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2815">10.3. Other metrics</a></span></dt><dd><dl><dt><span class="section"><a href="#ConnectionPoolUsageLoadMetric">10.3.1. <code class="code">ConnectionPoolUsageLoadMetric</code></a></span></dt></dl></dd></dl></div><p>
    A major feature of mod_cluster is the ability to use server-side load metrics to determine how best to balance requests.
  </p><p>
    The <code class="code">DynamicLoadBalanceFactorProvider</code> bean computes the load balance factor of a node from a defined set of load metrics.
  </p><pre class="programlisting">
&lt;bean name="DynamicLoadBalanceFactorProvider" class="org.jboss.modcluster.load.impl.DynamicLoadBalanceFactorProvider" mode="On Demand"&gt;
  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=LoadBalanceFactorProvider",exposedInterface=org.jboss.modcluster.load.impl.DynamicLoadBalanceFactorProviderMBean.class)&lt;/annotation&gt;
  &lt;constructor&gt;
    &lt;parameter&gt;
      &lt;set elementClass="org.jboss.modcluster.load.metric.LoadMetric"&gt;
        &lt;inject bean="BusyConnectorsLoadMetric"/&gt;
        &lt;inject bean="HeapMemoryUsageLoadMetric"/&gt;
      &lt;/set&gt;
    &lt;/parameter&gt;
  &lt;/constructor&gt;
  &lt;property name="history"&gt;9&lt;/property&gt;
  &lt;property name="decayFactor"&gt;2&lt;/property&gt;
&lt;/bean&gt;</pre><p>
    Load metrics can be configured with an associated weight and capacity.
  </p><p>
    The weight (default is 1) indicates the significance of a metric with respect to the other metrics.
    For example, a metric of weight 2 will have twice the impact on the overall load factor than a metric of weight 1.
  </p><p>The capacity of a metric serves 2 functions:</p><div class="itemizedlist"><ul><li><p>
        To normalize the load values from each metric.
        In some load metrics, capacity is already reflected in the load values.
        The capacity of a metric should be configured such that 0 &lt;= (load / capacity) &gt;= 1.
      </p></li><li><p>
        To favor some nodes over others.
        By setting the metric capacities to different values on each node, proxies will effectively favor nodes with higher capacities, since they will return smaller load values.
        This adds an interesting level of granularity to node weighting.
        Consider a cluster of two nodes, one with more memory, and a second with a faster CPU; and two metrics, one memory-based and the other CPU-based.
        In the memory-based metric, the first node would be given a higher load capacity than the second node.
        In a CPU-based metric, the second node would be given a higher load capacity than the first node.
      </p></li></ul></div><p>
    Each load metric contributes a value to the overall load factor of a node.
    The load factors from each metric are aggregated according to their weights.
  </p><p>
    In general, the load factor contribution of given metric is: (load / capacity) * weight / total weight.
  </p><p>
    The DynamicLoadBalanceFactorProvider applies a time decay function to the loads returned by each metric.
    The aggregate load, with respect to previous load values, can be expressed by the following formula:
  </p><div class="informalequation"><span class="mathphrase">L = (L<sub>0</sub> + L<sub>1</sub>/D + L<sub>2</sub>/D<sup>2</sup> + L<sub>3</sub>/D<sup>3</sup> + ... + L<sub>H</sub>/D<sup>H</sup>) * (1 + D + D<sup>2</sup> + D<sup>3</sup> + ... D<sup>H</sup>)</span></div><p>... or more concisely as:</p><div class="informalequation"><span class="mathphrase">L = (∑<sup>H</sup><sub>i=0</sub> L<sub>i</sub>/D<sup>i</sup>) * (∑<sup>H</sup><sub>i=0</sub> D<sup>i</sup>)</span></div><p>... where D = decayFactor, and H = history.</p><p>
    Setting history = 0 effectively disables the time decay function and only the current load for each metric will be considered in the load balance factor computation.
  </p><p>
    The mod_cluster load balancer expects the load factor to be an integer between 0 and 100, where 0 indicates max load and 100 indicates zero load. Therefore, the final load factor sent to the load balancer
    </p><div class="informalequation"><span class="mathphrase">L<sub>Final</sub> = 100 - (L * 100)</span></div><p>
  </p><p>
    While you are free to write your own load metrics, the following LoadMetrics are available out of the box:
  </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2646"/>10.1. Web Container metrics</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ActiveSessionsLoadMetric"/>10.1.1. <code class="code">ActiveSessionsLoadMetric</code></h3></div></div></div><div class="itemizedlist"><ul><li><p>Requires an explicit capacity</p></li><li><p>Uses <code class="code">SessionLoadMetricSource</code> to query session managers</p></li><li><p>Analogous to method=S in mod_jk</p></li></ul></div><p>e.g.</p><pre class="programlisting">&lt;bean name="ActiveSessionsLoadMetric" class="org.jboss.modcluster.load.metric.impl.ActiveSessionsLoadMetric" mode="On Demand"&gt;
  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=ActiveSessionsLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;
  &lt;constructor&gt;
    &lt;parameter&gt;&lt;inject bean="SessionLoadMetricSource"/&gt;&lt;/parameter&gt;
  &lt;/constructor&gt;
  &lt;property name="capacity"&gt;1000&lt;/property&gt;
&lt;/bean&gt;
&lt;bean name="SessionLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.SessionLoadMetricSource" mode="On Demand"&gt;
  &lt;constructor&gt;
    &lt;parameter class="javax.management.MBeanServer"&gt;
      &lt;inject bean="JMXKernel" property="mbeanServer"/&gt;
    &lt;/parameter&gt;
  &lt;/constructor&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="BusyConnectorsLoadMetric"/>10.1.2. <code class="code">BusyConnectorsLoadMetric</code></h3></div></div></div><div class="itemizedlist"><ul><li><p>Returns the percentage of connector threads from the thread pool that are busy servicing requests</p></li><li><p>Uses <code class="code">ThreadPoolLoadMetricSource</code> to query connector thread</p></li><li><p>Analogous to method=B in mod_jk</p></li></ul></div><p>e.g.</p><pre class="programlisting">&lt;bean name="BusyConnectorsLoadMetric" class="org.jboss.modcluster.load.metric.impl.BusyConnectorsLoadMetric" mode="On Demand"&gt;
  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=BusyConnectorsLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;
  &lt;constructor&gt;
    &lt;parameter&gt;&lt;inject bean="ThreadPoolLoadMetricSource"/&gt;&lt;/parameter&gt;
  &lt;/constructor&gt;
&lt;/bean&gt;
&lt;bean name="ThreadPoolLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.ThreadPoolLoadMetricSource" mode="On Demand"&gt;
  &lt;constructor&gt;
    &lt;parameter class="javax.management.MBeanServer"&gt;
      &lt;inject bean="JMXKernel" property="mbeanServer"/&gt;
    &lt;/parameter&gt;
  &lt;/constructor&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ReceiveTrafficLoadMetric"/>10.1.3. <code class="code">ReceiveTrafficLoadMetric</code></h3></div></div></div><div class="itemizedlist"><ul><li><p>Returns the incoming request POST traffic in KB/sec (the application needs to read POST data)</p></li><li><p>Requires an explicit capacity</p></li><li><p>Uses <code class="code">RequestProcessorLoadMetricSource</code> to query request processors</p></li><li><p>Analogous to method=T in mod_jk</p></li></ul></div><p>e.g.</p><pre class="programlisting">&lt;bean name="ReceiveTrafficLoadMetric" class="org.jboss.modcluster.load.metric.impl.ReceiveTrafficLoadMetric" mode="On Demand"&gt;
  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=ReceiveTrafficLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;
  &lt;constructor&gt;
    &lt;parameter class="org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource"&gt;
      &lt;inject bean="RequestProcessorLoadMetricSource"/&gt;
    &lt;/parameter&gt;
  &lt;/constructor&gt;
  &lt;property name="capacity"&gt;1024&lt;/property&gt;
&lt;/bean&gt;
&lt;bean name="RequestProcessorLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource" mode="On Demand"&gt;
  &lt;constructor&gt;
    &lt;parameter class="javax.management.MBeanServer"&gt;
      &lt;inject bean="JMXKernel" property="mbeanServer"/&gt;
    &lt;/parameter&gt;
  &lt;/constructor&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="SendTrafficLoadMetric"/>10.1.4. <code class="code">SendTrafficLoadMetric</code></h3></div></div></div><div class="itemizedlist"><ul><li><p>Returns the outgoing request traffic in KB/sec</p></li><li><p>Requires an explicit capacity</p></li><li><p>Uses <code class="code">RequestProcessorLoadMetricSource</code> to query request processors</p></li><li><p>Analogous to method=T in mod_jk</p></li></ul></div><pre class="programlisting">&lt;bean name="SendTrafficLoadMetric" class="org.jboss.modcluster.load.metric.impl.SendTrafficLoadMetric" mode="On Demand"&gt;
  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=SendTrafficLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;
  &lt;constructor&gt;
    &lt;parameter class="org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource"&gt;
      &lt;inject bean="RequestProcessorLoadMetricSource"/&gt;
    &lt;/parameter&gt;
  &lt;/constructor&gt;
  &lt;property name="capacity"&gt;512&lt;/property&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="RequestCountLoadMetric"/>10.1.5. <code class="code">RequestCountLoadMetric</code></h3></div></div></div><div class="itemizedlist"><ul><li><p>Returns the number of requests/sec</p></li><li><p>Requires an explicit capacity</p></li><li><p>Uses <code class="code">RequestProcessorLoadMetricSource</code> to query request processors</p></li><li><p>Analogous to method=R in mod_jk</p></li></ul></div><p>e.g.</p><pre class="programlisting">&lt;bean name="RequestCountLoadMetric" class="org.jboss.modcluster.load.metric.impl.RequestCountLoadMetric" mode="On Demand"&gt;
  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=RequestCountLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;
  &lt;constructor&gt;
    &lt;parameter class="org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource"&gt;
      &lt;inject bean="RequestProcessorLoadMetricSource"/&gt;
    &lt;/parameter&gt;
  &lt;/constructor&gt;
  &lt;property name="capacity"&gt;1000&lt;/property&gt;
&lt;/bean&gt;</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2761"/>10.2. System/JVM metrics</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="AverageSystemLoadMetric"/>10.2.1. <code class="code">AverageSystemLoadMetric</code></h3></div></div></div><div class="itemizedlist"><ul><li><p>Returns CPU load</p></li><li><p>Requires Java 1.6+</p></li><li><p>Uses <code class="code">OperatingSystemLoadMetricSource</code> to generically read attributes</p></li></ul></div><p>e.g.</p><pre class="programlisting">&lt;bean name="AverageSystemLoadMetric" class="org.jboss.modcluster.load.metric.impl.AverageSystemLoadMetric" mode="On Demand"&gt;
  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=AverageSystemLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;
  &lt;constructor&gt;
    &lt;parameter&gt;&lt;inject bean="OperatingSystemLoadMetricSource"/&gt;&lt;/parameter&gt;
  &lt;/constructor&gt;
&lt;/bean&gt;
&lt;bean name="OperatingSystemLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.OperatingSystemLoadMetricSource" mode="On Demand"&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="SystemMemoryUsageLoadMetric"/>10.2.2. <code class="code">SystemMemoryUsageLoadMetric</code></h3></div></div></div><div class="itemizedlist"><ul><li><p>Returns system memory usage</p></li><li><p>Requires com.sun.management.OperatingSystemMXBean (available in Sun's JDK or OpenJDK)</p></li><li><p>Uses OperatingSystemLoadMetricSource to generically read attributes</p></li></ul></div><p>e.g.</p><pre class="programlisting">&lt;bean name="SystemMemoryUsageLoadMetric" class="org.jboss.modcluster.load.metric.impl.SystemMemoryUsageLoadMetric" mode="On Demand"&gt;
  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=SystemMemoryUsageLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;
  &lt;constructor&gt;
    &lt;parameter&gt;&lt;inject bean="OperatingSystemLoadMetricSource"/&gt;&lt;/parameter&gt;
  &lt;/constructor&gt;
&lt;/bean&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="HeapMemoryUsageLoadMetric"/>10.2.3. <code class="code">HeapMemoryUsageLoadMetric</code></h3></div></div></div><div class="itemizedlist"><ul><li><p>Returns the heap memory usage as a percentage of max heap size</p></li></ul></div><p>e.g.</p><pre class="programlisting">&lt;bean name="HeapMemoryUsageLoadMetric" class="org.jboss.modcluster.load.metric.impl.HeapMemoryUsageLoadMetric" mode="On Demand"&gt;
  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=HeapMemoryUsageLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;
&lt;/bean&gt;</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2815"/>10.3. Other metrics</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ConnectionPoolUsageLoadMetric"/>10.3.1. <code class="code">ConnectionPoolUsageLoadMetric</code></h3></div></div></div><div class="itemizedlist"><ul><li><p>Returns the percentage of connections from a connection pool that are in use</p></li><li><p>Uses ConnectionPoolLoadMetricSource to query JCA connection pools</p></li></ul></div><p>e.g.</p><pre class="programlisting">&lt;bean name="ConnectionPoolUsageMetric" class="org.jboss.modcluster.load.metric.impl.ConnectionPoolUsageLoadMetric" mode="On Demand"&gt;
  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=ConnectionPoolUsageLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;
  &lt;constructor&gt;
    &lt;parameter&gt;&lt;inject bean="ConnectionPoolLoadMetricSource"/&gt;&lt;/parameter&gt;
  &lt;/constructor&gt;
&lt;/bean&gt;
&lt;bean name="ConnectionPoolLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.ConnectionPoolLoadMetricSource" mode="On Demand"&gt;
  &lt;constructor&gt;
    &lt;parameter class="javax.management.MBeanServer"&gt;
      &lt;inject bean="JMXKernel" property="mbeanServer"/&gt;
    &lt;/parameter&gt;
  &lt;/constructor&gt;
&lt;/bean&gt;</pre></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="java.install"/>Chapter 11. Installing Server-Side Components</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e2840">11.1. Installing in JBoss AS 6.0.0.M1 and up</a></span></dt><dt><span class="section"><a href="#d0e2845">11.2. Installing in JBoss AS 5.x</a></span></dt><dt><span class="section"><a href="#d0e2852">11.3. Installing in Tomcat</a></span></dt></dl></div><p>
    First, extract the server-side binary to a temporary directory.
    The following assumes it was extracted to /tmp/mod_cluster
  </p><p>
    Your next step depends on whether your target server is JBoss AS or JBossWeb/Tomcat.
  </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2840"/>11.1. Installing in JBoss AS 6.0.0.M1 and up</h2></div></div></div><p>
      You don't need to do anything to install the java-side binaries in AS 6.x;
      it's part of the AS distribution's default, standard and all configurations.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2845"/>11.2. Installing in JBoss AS 5.x</h2></div></div></div><p>
      Assuming $JBOSS_HOME indicates the root of your JBoss AS install and that you want to use mod_cluster in the AS's all config:
    </p><pre class="programlisting">cp -r /tmp/mod_cluster/mod_cluster.sar $JBOSS_HOME/server/all/deploy</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2852"/>11.3. Installing in Tomcat</h2></div></div></div><p>
      Assuming $CATALINA_HOME indicates the root of your Tomcat install:
    </p><pre class="programlisting">
    cp /tmp/mod_cluster/JBossWeb-Tomcat/lib/jboss-logging.jar $CATALINA_HOME/lib/
    cp /tmp/mod_cluster/JBossWeb-Tomcat/lib/mod_cluster-container-catalina* $CATALINA_HOME/lib/
    cp /tmp/mod_cluster/JBossWeb-Tomcat/lib/mod_cluster-container-spi* $CATALINA_HOME/lib/
    cp /tmp/mod_cluster/JBossWeb-Tomcat/lib/mod_cluster-core* $CATALINA_HOME/lib/
    </pre>
    and additionally for Tomcat6:
    <pre class="programlisting">cp /tmp/mod_cluster/JBossWeb-Tomcat/lib/mod_cluster-container-tomcat6* $CATALINA_HOME/lib </pre>
    and additionally for Tomcat7:
    <pre class="programlisting">cp /tmp/mod_cluster/JBossWeb-Tomcat/lib/mod_cluster-container-tomcat7* $CATALINA_HOME/lib </pre></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="UsingSSL"/>Chapter 12. Using SSL in mod_cluster</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e2870">12.1. Using SSL between JBossWEB and httpd</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e2875">12.1.1. Apache httpd configuration part</a></span></dt><dt><span class="sect2"><a href="#d0e2890">12.1.2. ClusterListener configuration part</a></span></dt><dt><span class="sect2"><a href="#d0e2904">12.1.3. mod-cluster-jboss-beans configuration part</a></span></dt><dt><span class="sect2"><a href="#d0e2914">12.1.4. How the diferent files were created</a></span></dt></dl></dd><dt><span class="sect1"><a href="#mod_proxy_https">12.2. Using SSL between httpd and JBossWEB</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d0e3020">12.2.1. How the diferent files were created</a></span></dt></dl></dd><dt><span class="sect1"><a href="#d0e3069">12.3. Forwarding SSL browser informations when using http/https between
    httpd and JBossWEB</a></span></dt></dl></div><p>There are 2 connections between the cluster and the front-end. Both
  could be encrypted. That chapter describes how to encrypt both
  connections.</p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2870"/>12.1. Using SSL between JBossWEB and httpd</h2></div></div></div><p>As the ClusterListener allows to configure httpd it is adviced to
    use SSL for that connection. The most easy is to use a virtual host that
    will only be used to receive information from JBossWEB. Both side need
    configuration.</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2875"/>12.1.1. Apache httpd configuration part</h3></div></div></div><p><a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://httpd.apache.org/docs/2.2/mod/mod_ssl.html">mod_ssl</a>
      of httpd is using to do that. See in one example how easy the
      configuration is:</p><pre class="programlisting"> Listen 6666
 &lt;VirtualHost 10.33.144.3:6666&gt;
     SSLEngine on
     SSLCipherSuite AES128-SHA:ALL:!ADH:!LOW:!MD5:!SSLV2:!NULL
     SSLCertificateFile conf/server.crt
     SSLCertificateKeyFile conf/server.key
     SSLCACertificateFile conf/server-ca.crt
     SSLVerifyClient require
     SSLVerifyDepth  10 
 &lt;/VirtualHost&gt;</pre><p>The conf/server.crt file is the PEM-encoded Certificate file for
      the VirtualHost it must be signed by a Certificate Authority (CA) whose
      certificate is stored in the sslTrustStore of the ClusterListener
      parameter.</p><p>The conf/server.key file is the file containing the private
      key.</p><p>The conf/server-ca.crt file is the file containing the certicate
      of the CA that have signed the client certificate JBossWEB is using.
      That is the CA that have signed the certificate corresponding to the
      sslKeyAlias stored in the sslKeyStore of the ClusterListener
      parameters.</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2890"/>12.1.2. ClusterListener configuration part</h3></div></div></div><p>There is a <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/community/docs/DOC-9300">wiki</a>
      describing the SSL parameters of the ClusterListener. See in one example
      how easy the configuration is:</p><pre class="programlisting"> &lt;Listener className="org.jboss.web.cluster.ClusterListener"
           ssl="true"
           sslKeyStorePass="changeit"
           sslKeyStore="/home/jfclere/CERTS/CA/test.p12"
           sslKeyStoreType="PKCS12"
           sslTrustStore="/home/jfclere/CERTS/CA/ca.p12"
           sslTrustStoreType="PKCS12" sslTrustStorePassword="changeit"
           /&gt;</pre><p>The sslKeyStore file contains the private key and the signed
      certificate of the client certificate JBossWEB uses to connect to httpd.
      The certificate must be signed by a Cerficate Authority (CA) who
      certificate is in the conf/server-ca.crt file of the httpd</p><p>The sslTrustStore file contains the CA certificate of the CA that
      signed the certificate contained in conf/server.crt file.</p></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2904"/>12.1.3. mod-cluster-jboss-beans configuration part</h3></div></div></div><p>The mod-cluster-jboss-beans.xml in
      $JBOSS_HOME/server/<span class="emphasis"><em>profile</em></span>/deploy/mod-cluster.sar/META-INF
      in the ClusterConfig you are using you should have something
      like:</p><pre class="programlisting">      &lt;property name="ssl"&gt;true&lt;/property&gt;
      &lt;property name="sslKeyStorePass"&gt;changeit&lt;/property&gt;
      &lt;property name="sslKeyStore"&gt;/home/jfclere/CERTS/test.p12&lt;/property&gt;
      &lt;property name="sslKeyStoreType"&gt;pkcs12&lt;/property&gt;
      &lt;property name="sslTrustStore"&gt;/home/jfclere/CERTS/ca.p12&lt;/property&gt;
      &lt;property name="sslTrustStoreType"&gt;pkcs12&lt;/property&gt;
      &lt;property name="sslTrustStorePassword"&gt;changeit&lt;/property&gt;</pre></div><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2914"/>12.1.4. How the diferent files were created</h3></div></div></div><p>The files were created using OpenSSL utilities see <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.openssl.org/">OpenSSL</a> CA.pl
      (/etc/pki/tls/misc/CA for example) has been used to create the test
      Certificate authority, the certicate requests and private keys as well
      as signing the certicate requests.</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="createca"/>12.1.4.1. Create the CA</h4></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Create a work directory and work for there:</p><pre class="programlisting">mkdir -p CERTS/Server
cd CERTS/Server</pre></li><li><p>Create a new CA:</p><pre class="programlisting">/etc/pki/tls/misc/CA -newca </pre><p>That creates a directory for example ../../CA that contains
            a cacert.pem file which content have to be added to the
            conf/server-ca.crt described above.</p></li><li><p>Export the CA certificate to a .p12 file:</p><pre class="programlisting">openssl pkcs12 -export -nokeys -in ../../CA/cacert.pem -out ca.p12</pre><p>That reads the file cacert.pem that was created in the previous step and convert it into a pkcs12 file the JVM is able to read.</p><p>That is the ca.p12 file used in the <span class="emphasis"><em>sslTrustStore</em></span> parameter above.</p></li></ol></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="createsc"/>12.1.4.2. Create the server certificate</h4></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Create a new request:</p><pre class="programlisting">/etc/pki/tls/misc/CA -newreq </pre><p>That creates 2 files named newreq.pem and newkey.pem.
            newkey.pem is the file conf/server.key described above.</p></li><li><p>Sign the request:</p><pre class="programlisting"> /etc/pki/tls/misc/CA -signreq </pre><p>That creates a file named newcert.pem. newcert.pem is the
            file conf/server.crt described above. At that point you have
            created the SSL stuff needed for the VirtualHost in httpd. You
            should use a browser to test it after importing in the browser the
            content of the cacert.pem file.</p></li></ol></div></div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2968"/>12.1.4.3. Create the client certificate</h4></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Create a work directory and work for there:</p><pre class="programlisting">mkdir -p CERTS/Client
cd CERTS/Client</pre></li><li><p>Create request and key for the JBossWEB part.</p><pre class="programlisting">/etc/pki/tls/misc/CA -newreq</pre><p>
             That creates 2 files: Request is in newreq.pem, private key is in newkey.pem
            </p></li><li><p>Sign the request.</p><pre class="programlisting">/etc/pki/tls/misc/CA -signreq</pre><p>
             That creates a file: newcert.pem</p></li><li><p>Don't use a passphrase when creating the client certicate or
            remove it before exporting:</p><pre class="programlisting">openssl rsa -in newkey.pem -out key.txt.pem
mv key.txt.pem newkey.pem</pre></li><li><p>Export the client certificate and key into a p12
            file.</p><pre class="programlisting">openssl pkcs12 -export -inkey newkey.pem -in newcert.pem -out test.p12</pre><p>That is the sslKeyStore file described above
        (/home/jfclere/CERTS/CA/test.p12)</p></li></ol></div></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mod_proxy_https"/>12.2. Using SSL between httpd and JBossWEB</h2></div></div></div><p>Using https allows to encrypt communications betwen httpd and
    JBossWEB. But due to the ressources it needs that no advised to use it in
    high load configuration.</p><p>(See <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/community/docs/DOC-9701">Encrypting connection
    between httpd and TC</a> for detailed instructions).</p><p>httpd is configured to be a client for AS/TC so it should provide a certificate AS/TC
    will accept and have a private key to encrypt the data, it also needs a CA certificate to valid
    the certificate AS/TC will use for the connection.</p><pre class="programlisting">SSLProxyEngine On
SSLProxyVerify require
SSLProxyCACertificateFile conf/cacert.pem
SSLProxyMachineCertificateFile conf/proxy.pem</pre><p>conf/proxy.pem should contain both key and certificate. The
  certificate must be trusted by Tomcat via the CA in truststoreFile of &lt;connector/&gt;.</p><p>conf/cacert.pem must contain the certificat of the CA
  that signed the AS/TC certificate. The correspond key and certificate are the pair specificed by keyAlias and truststoreFile
  of the &lt;connector/&gt;. Of course the &lt;connector/&gt; must be the https one (normally on port 8443).</p><div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3020"/>12.2.1. How the diferent files were created</h3></div></div></div><p>The files were created using OpenSSL utilities see <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.openssl.org/">OpenSSL</a> CA.pl
      (/etc/pki/tls/misc/CA for example) has been used to create the test
      Certificate authority, the certicate requests and private keys as well
      as signing the certicate requests.</p><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3028"/>12.2.1.1. Create the CA</h4></div></div></div>
        (See <a href="#createca" title="12.1.4.1. Create the CA">above</a>)
      </div><div class="sect3" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3035"/>12.2.1.2. Create the server certificate</h4></div></div></div>
         (See <a href="#createsc" title="12.1.4.2. Create the server certificate">above</a>)
         <p>The certificate and key need to be imported into the java keystore using keytool</p><p>make sure you don't use a passphare for the key (don't forget to clean the file when done)</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li>
             Convert the key and certificate to p12 file:
             <pre class="programlisting">openssl pkcs12 -export -inkey key.pem -in newcert.pem -out test.p12</pre>
             make sure you use the keystore password as Export passphrase.
           </li><li>
             Import the contents of the p12 file in the keystore:
             <pre class="programlisting">keytool -importkeystore -srckeystore test.p12 -srcstoretype PKCS12</pre></li><li>
             Import the CA certificate in the java trustore: (Fedora13 example).
             <pre class="programlisting">keytool -import -trustcacerts -alias "caname" \
-file  ../../CA/cacert.pem -keystore /etc/pki/java/cacerts</pre></li><li>
             Edit server.xml to have a &lt;connector/&gt; similar to:
<pre class="programlisting">
&lt;Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"
           keyAlias="1" 
           truststoreFile="/etc/pki/java/cacerts"
           maxThreads="150" scheme="https" secure="true"
           clientAuth="true" sslProtocol="TLS" /&gt;
</pre></li><li>
             Start TC/AS and use openssl s_client to test the connection:
             <pre class="programlisting">openssl s_client -CAfile /home/jfclere/CA/cacert.pem -cert newcert.pem -key newkey.pem \
-host localhost -port 8443</pre>
             There shouldn't be any error and you should be able to see your CA in the "Acceptable client certificate CA names".
           </li></ol></div></div></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3069"/>12.3. Forwarding SSL browser informations when using http/https between
    httpd and JBossWEB</h2></div></div></div><p>When using http or https beween httpd and JBossWEB you need to use
    the SSLValve and export the SSL variable as header in the request in
    httpd. If you are using AJP, mod_proxy_ajp will read the SSL variables and
    forward them to JBossWEB automaticaly.</p><p>(See <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/community/docs/DOC-11988">Forwarding SSL
    environment when using http/https proxy</a> for detailed
    instructions).</p><p>The SSL variable used by mod_proxy_ajp are the following:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>"HTTPS" SSL indicateur.</p></li><li><p>"SSL_CLIENT_CERT" Chain of client certificates.</p></li><li><p>"SSL_CIPHER" Cipher used.</p></li><li><p>"SSL_SESSION_ID" Id of the session.</p></li><li><p>"SSL_CIPHER_USEKEYSIZE" Size of the key used.</p></li></ol></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mod_jk"/>Chapter 13. Migration from mod_jk</h2></div></div></div><p>Mod_cluster only support Apache httpd, there are no plan to support
  IIS or Iplanet.</p><p>The migration from mod_jk to mod_cluster is not very complex. Only
  very few worker properties can't be mapped to mod_cluster parameters.</p><p>Here is the table of worker properties and how to transfer them in the
  ClusterListener parameters.</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th><p>mod_jk worker property</p></th><th><p>ClusterListener parameter</p></th><th><p>Remarks</p></th></tr></thead><tbody><tr><td><p>host</p></td><td><p>-</p></td><td><p>It is read from the &lt;Connector/&gt; Address
          information</p></td></tr><tr><td><p>port</p></td><td><p>-</p></td><td><p>It is read from the &lt;Connector/&gt; Port
          information</p></td></tr><tr><td><p>type</p></td><td><p>-</p></td><td><p>It is read from the &lt;Connector/&gt; Protocol
          information</p></td></tr><tr><td><p>route</p></td><td><p>-</p></td><td><p>It is read from the &lt;Engine/&gt; JVMRoute
          information</p></td></tr><tr><td><p>domain</p></td><td><p>domain</p></td><td><p>That is not supported in this version</p></td></tr><tr><td><p>redirect</p></td><td><p>-</p></td><td><p>The nodes with loadfactor = 0 are standby nodes they
          will be used no other nodes are available</p></td></tr><tr><td><p>socket_timeout</p></td><td><p>nodeTimeout</p></td><td><p>Default 10 seconds</p></td></tr><tr><td><p>socket_keepalive</p></td><td><p>-</p></td><td><p>KEEP_ALIVE os is always on in
          mod_cluster</p></td></tr><tr><td><p>connection_pool_size</p></td><td><p>-</p></td><td><p>The max size is calculated to be AP_MPMQ_MAX_THREADS+1
          (max)</p></td></tr><tr><td><p>connection_pool_minsize</p></td><td><p>smax</p></td><td><p>The defaut is max</p></td></tr><tr><td><p>connection_pool_timeout</p></td><td><p>ttl</p></td><td><p>Time to live when over smax connections. The defaut is
          60 seconds</p></td></tr><tr><td><p>-</p></td><td><p>workerTimeout</p></td><td><p>Max time to wait for a free worker default 1
          second</p></td></tr><tr><td><p>retries</p></td><td><p>maxAttempts</p></td><td><p>Max retries before returning an error Default:
          3</p></td></tr><tr><td><p>recovery_options</p></td><td><p>-</p></td><td><p>mod_cluster behave like mod_jk with value
          7</p></td></tr><tr><td><p>fail_on_status</p></td><td><p>-</p></td><td><p>Not supported</p></td></tr><tr><td><p>max_packet_size</p></td><td><p>iobuffersize/receivebuffersize</p></td><td><p>Not supported in this version. Use
          ProxyIOBufferSize</p></td></tr><tr><td><p>max_reply_timeouts</p></td><td><p>-</p></td><td><p>Not supported</p></td></tr><tr><td><p>recovert_time</p></td><td><p>-</p></td><td><p>The ClusterListener will tell (via a STATUS message)
          mod_cluster that the node is up again</p></td></tr><tr><td><p>activation</p></td><td><p>-</p></td><td><p>mod_cluster receives this information via
          ENABLE/DISABLE/STOP messages</p></td></tr><tr><td><p>distance</p></td><td><p>-</p></td><td><p>mod_cluster handles this via the loadfactor
          logic</p></td></tr><tr><td><p>mount</p></td><td><p>-</p></td><td><p>The context "mounted" automaticly via the ENABLE-APP
          messages. ProxyPass could be used too</p></td></tr><tr><td><p>secret</p></td><td><p>-</p></td><td><p>Not supported</p></td></tr><tr><td><p>connect_timeout</p></td><td><p>-</p></td><td><p>Not supported. Use ProxyTimeout or server TimeOut
          (Default 300 seconds)</p></td></tr><tr><td><p>prepost_timeout</p></td><td><p>ping</p></td><td><p>Default 10 seconds</p></td></tr><tr><td><p>reply_timeout</p></td><td><p>-</p></td><td><p>Not supported. Use ProxyTimeout or server TimeOut?
          directive (Default 300 seconds)</p></td></tr></tbody></table></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="mod_proxy"/>Chapter 14. Migration from mod_proxy</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d0e3379">14.1. Workers</a></span></dt><dt><span class="sect1"><a href="#d0e3576">14.2. Balancers</a></span></dt></dl></div><p>As mod_cluster is a sophisticated balancer migration from mod_proxy to
  mod_cluster is strait forward. mod_cluster replaces a reverse proxy with
  loadbalancing. A reversed proxy is configured like:</p><pre class="programlisting">ProxyRequests Off
&lt;Proxy *&gt;
Order deny,allow
Allow from all
&lt;/Proxy&gt;
ProxyPass /foo http://foo.example.com/bar
ProxyPassReverse /foo http://foo.example.com/bar</pre><p>All the general proxy parameters could be used in mod_cluster they
  work like in mod_proxy, only the balancers and the workers definitions are
  slightly different.</p><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3379"/>14.1. Workers</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th><p>Mod_proxy Parameter</p></th><th><p>ClusterListener parameter</p></th><th><p>Remarks</p></th></tr></thead><tbody><tr><td><p>min</p></td><td><p>-</p></td><td><p>Not supported in this version</p></td></tr><tr><td><p>max</p></td><td><p>-</p></td><td><p>mod_cluster uses mod_proxy default
            value</p></td></tr><tr><td><p>smax</p></td><td><p>smax</p></td><td><p>Same as mod_proxy</p></td></tr><tr><td><p>ttl</p></td><td><p>ttl</p></td><td><p>Same as mod_proxy</p></td></tr><tr><td><p>acquire</p></td><td><p>workerTimeout</p></td><td><p>Same as mod_proxy acquire but in
            seconds</p></td></tr><tr><td><p>disablereuse</p></td><td><p>-</p></td><td><p>mod_cluster will disable the node in case of error
            and the ClusterListener will for the reuse via the STATUS
            message</p></td></tr><tr><td><p>flushPackets</p></td><td><p>flushPackets</p></td><td><p>Same as mod_proxy</p></td></tr><tr><td><p>flushwait</p></td><td><p>flushwait</p></td><td><p>Same as mod_proxy</p></td></tr><tr><td><p>keepalive</p></td><td><p>-</p></td><td><p>Always on: OS KEEP_ALIVE is always used. Use
            connectionTimeout in the &lt;Connector&gt; if
            needed</p></td></tr><tr><td><p>lbset</p></td><td><p>-</p></td><td><p>Not supported</p></td></tr><tr><td><p>ping</p></td><td><p>ping</p></td><td><p>Same as mod_proxy Default value 10
            seconds</p></td></tr><tr><td><p>lbfactor</p></td><td><p>-</p></td><td><p>The load factor is received by mod_cluster from a
            calculated value in the ClusterListener</p></td></tr><tr><td><p>redirect</p></td><td><p>-</p></td><td><p>Not supported lbfactor sent to 0 makes a standby
            node</p></td></tr><tr><td><p>retry</p></td><td><p>-</p></td><td><p>ClusterListener will test when the node is back
            online</p></td></tr><tr><td><p>route</p></td><td><p>JVMRoute</p></td><td><p>In fact JBossWEB via the JVMRoute in the Engine will
            add it</p></td></tr><tr><td><p>status</p></td><td><p>-</p></td><td><p>mod_cluster has a finer status handling: by context
            via the ENABLE/STOP/DISABLE/REMOVE application messages.
            hot-standby is done by lbfactor = 0 and Error by lbfactor = 1 both
            values are sent in STATUS message by the
            ClusterListener</p></td></tr><tr><td><p>timeout</p></td><td><p>nodeTimeout</p></td><td><p>Default wait for ever
            (http://httpd.apache.org/docs/2.2/mod/mod_proxy.html is wrong
            there)</p></td></tr><tr><td><p>ttl</p></td><td><p>ttl</p></td><td><p>Default 60 seconds</p></td></tr></tbody></table></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3576"/>14.2. Balancers</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th><p>Mod_proxy Parameter</p></th><th><p>ClusterListener parameter</p></th><th><p>Remarks</p></th></tr></thead><tbody><tr><td><p>lbmethod</p></td><td><p>-</p></td><td><p>There is only one load balancing method in
            mod_cluster "cluster_byrequests"</p></td></tr><tr><td><p>maxattempts</p></td><td><p>maxAttempts</p></td><td><p>Default 1</p></td></tr><tr><td><p>nofailover</p></td><td><p>stickySessionForce</p></td><td><p>Same as in mod_proxy</p></td></tr><tr><td><p>stickysession</p></td><td><p>StickySessionCookie/StickySessionPath</p></td><td><p>The 2 parameters in the ClusterListener are combined
            in one that behaves like in mod_proxy</p></td></tr><tr><td><p>timeout</p></td><td><p>workerTimeout</p></td><td><p>Default 1 seconds</p></td></tr></tbody></table></div><p/></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="demo"/>Chapter 15. Load Balancing Demo Application</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e3647">15.1. Overview</a></span></dt><dt><span class="section"><a href="#d0e3671">15.2. Basic Usage</a></span></dt><dt><span class="section"><a href="#client-config">15.3. Client Driver Configuration Options</a></span></dt><dt><span class="section"><a href="#load-generation">15.4. Load Generation Scenarios</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3647"/>15.1. Overview</h2></div></div></div><p>
      The mod_cluster distribution includes a demo application that helps demonstrate how different server-side scenarios affect the routing of client requests by the load balancer.
      The demo application is located in the mod_cluster distribution's demo directory.
    </p><p>The demo application consists of two components:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
          The first component is a war file that needs to be deployed in JBossWeb/Tomcat/JBoss AS.
          The war includes a number of servlets.</p></li><li><p>
          The second component is a GUI application that allows a user to launch a pool of threads that repeatedly make requests to the load balancer.
          The requests are ultimately routed to the demo war's primary servlet.
          The application tracks which servers are handling the requests and displays this information in a chart.
        </p><p>
          The application can also send separate requests to the demo war's load generation servlets,
          allowing the user to see how different load conditions affect the balancing of requests.
        </p></li></ol></div><p>
       Note that the demo application does not actually depend on mod_cluster in any way.
       Its only dependency is on JBossWeb/Tomcat.
       <sup>[<a id="d0e3665" href="#ftn.d0e3665">1</a>]</sup>
       Consequently, the demo can be used to demonstrate the effect of different server-side scenarios on the routing decisions made by any load balancer, including mod_jk, mod_proxy or the various hardware load balancers.
    </p><p>
      Note also that this demo application is not intended to be used as a load testing tool;
      i.e. something that can demonstrate the maximum load a cluster configuration can handle.
      Using it as such has a good chance of showing you the maximum load the client can generate rather than the maximum load your cluster can handle.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3671"/>15.2. Basic Usage</h2></div></div></div><p>To run the demo application:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p><a id="first"/>
          Unpack the mod_cluster distribution on your filesystem.
          Here we assume it has been unzipped to ~/mod_cluster or C:\mod_cluster.
        </p></li><li><p>
          Install mod_cluster into your httpd server as described at <a href="#native.install" title="Chapter 5. Installing httpd modules">Installation of the httpd part</a>
        </p></li><li><p>
          Install mod_cluster into your JBossAS/JBossWeb/Tomcat servers as described at <a href="#java.install" title="Chapter 11. Installing Server-Side Components">Installation on the Java side</a>
        </p></li><li><p>
          In AS7 you have to set org.apache.tomcat.util.ENABLE_MODELER to true, Something like:
          </p><pre class="programlisting">
    &lt;system-properties&gt;
       &lt;property name="org.apache.tomcat.util.ENABLE_MODELER" value="true"/&gt;
    &lt;/system-properties&gt;
          </pre><p>
        </p></li><li><p>Start httpd and your JBossAS/JBossWeb/Tomcat servers</p></li><li><p>Deploy the load-demo.war found in the distribution's demo/server folder to your JBossAS/JBossWeb/Tomcat servers.</p></li><li><p>
          Start the demo application:
        </p><div class="orderedlist"><ol><li><p>On *nix:</p><pre class="programlisting">cd ~/mod_cluster/demo/client
./run-demo.sh</pre><p>
            </p></li><li><p>On Windows:</p><pre class="programlisting">C:\&gt;cd mod_cluster\demo\client
C:\mod_cluster\demo\client&gt;run-demo</pre></li></ol></div><div class="mediaobject" align="center"><img src="images/demo-client-control.jpg" align="middle"/></div></li><li><p>
          Configure the hostname and address of the httpd server, the number of client threads, etc and click the "Start" button.
          See <a href="#client-config" title="15.3. Client Driver Configuration Options">Client Driver Configuration Options</a> for details on the configuration options.
        </p></li><li><p>
          Switch to the "Request Balancing" tab to see how many requests are going to each of your JBossAS/JBossWeb/Tomcat servers.
        </p></li><li><p>
          Switch to the "Session Balancing" tab to see how many active sessions
          <a href="#">
            <sup>[</sup></a><a id="d0e3738" href="#ftn.d0e3738">2</a><a href="#"><sup>]</sup>
          </a> are being hosted by each of your JBossAS/JBossWeb/Tomcat servers.
        </p></li><li><p>
          Stop some of your JBossAS/JBossWeb/Tomcat servers and/or undeploy the load-demo.war from some of the servers and see the effect this has on load balancing.
        </p></li><li><p>
          Restart some of your JBossAS/JBossWeb/Tomcat servers and/or re-deploy the load-demo.war to some of the servers and see the effect this has on load balancing.
        </p></li><li><p>
          Experiment with adding artificial load to one or more servers to see what effect that has on load balancing.
          See <a href="#load-generation" title="15.4. Load Generation Scenarios">Load Generation Scenarios</a> for details.
        </p></li></ol></div><p>
      Most of the various panels in application interface also present information on the current status on any client threads.
      "Total Clients" is the number of client threads created since the last time the "Start" button was pushed.
      "Live Clients" is the number of threads currently running.
      "Failed Clients" is the number of clients that terminated abnormally; 
      i.e. made a request that resulted in something other than an HTTP 200 response.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="client-config"/>15.3. Client Driver Configuration Options</h2></div></div></div><p>
      The configuration of the client is driver is done via the application's "Clent Control" tab.
    </p><div class="mediaobject" align="center"><img src="images/demo-client-control.jpg" align="middle"/></div><p>The panel includes the following options:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
          Proxy Hostname:
          Hostname of the load balancer or the IP address on which it is listening for requests
          <sup>[<a id="d0e3771" href="#ftn.d0e3771">3</a>]</sup>
        </p></li><li><p>
          Proxy Port:
          Port on which the load balancer is listening for requests
          <sup>[<a id="d0e3784" href="#ftn.d0e3784">4</a>]</sup>
        </p></li><li><p>
          Context Path:
          Portion of the request URL that specifies the request is for the load-demo.war
        </p></li><li><p>
          Session Life:
          Number of seconds a client thread should use a session before invalidating or abandoning it.
          Generally it is good to keep this to a small value; otherwise the use of session stickiness will prevent changes in server load from affecting the load balancer's routing decisions.
          With sticky sessions enabled (strongly recommended), it is the creation of a new session that allows the load balancer to try to balance load.
        </p></li><li><p>
          Invalidate:
          Controls what the client thread should do when it stops using a session because Session Life has passed.
          If checked, the driver will send a request that results in the session being invalidated.
          If unchecked, the session will just be abandoned, and will continue to exist on the server until Session Timeout seconds have passed.
          In the future this will likely be changed to a percentage input, so X% can be invalidated, the rest abandoned.
        </p></li><li><p>
          Session Timeout:
          Number of seconds a session can remain unused before the server is free to expire it.
          Unchecking Invalidate and setting a high value relative to Session Life allows a significant number of unused sessions to accumulate on the server.
        </p></li><li><p>
          Num Threads:
          Number of client threads to launch.
          Each thread repeatedly makes requests until the "Stop" button is pushed or a request receives a response other than HTTP 200.
        </p></li><li><p>
          Sleep Time:
          Number of ms the client threads should sleep between requests.
        </p></li><li><p>
          Startup Time:
          Number of seconds over which the application should stagger the start of the client threads.
          Staggering the start advised as it avoids the unnatural situation where for the life of the demonstation all sessions start at about the same time and then are invalidated or abandoned at the same time.
          Staggering the start allows the load balancer to continually see new sessions and decide how to route them.
        </p></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="load-generation"/>15.4. Load Generation Scenarios</h2></div></div></div><p>
      You can use the application's GUI to instruct individual servers to artificially generate various types of load, and then track how that load affects request and session balancing.
      Load generation is controlled via the application's "Server Load Control" tab.
    </p><div class="mediaobject" align="center"><img src="images/demo-server-load.jpg" align="middle"/></div><p>The panel includes the following options:</p><div class="itemizedlist"><ul><li><p>
          Target Hostname and Target Port:
          The hostname or IP address of the server on which you want load generated.
          There are two strategies for setting these:
        </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
              You can use the hostname and port of the load balancer, in which case the load balancer will pick a backend server and route the request to it.
              Note the client application does not maintain a session cookie for these requests, so if you invoke another server load generation request, you shouldn't expect the same server to handle it.
            </p></li><li><p>
              If the JBoss AS/JBossWeb/Tomcat servers are running the HttpConnector as well as the AJP connector, you can specify the address and port on which a particular server's HttpConnector is listening.
              The standard port is 8080.
            </p></li></ol></div></li><li><p>
          Load Creation Action:
          Specifies the type of load the target server should generate.
          See below for details on the available load types.
        </p></li><li><p>
          Params:
          Zero or more parameters to pass to the specified load creation servlet.
          For example, in the screenshot above, Number of Connections and Duration.
          How many parameters are displayed, their name and their meaning depend on the selected Load Creation Action.
          The label for each parameter includes a tooltip that explains its use.
        </p><p>The available Load Creation Actions are as follows:</p><div class="variablelist"><dl><dt><span class="term">Active Sessions</span></dt><dd><p>Generates server load by causing session creation on the target server.</p></dd><dt><span class="term">Datasource Use</span></dt><dd><p>Generates server load by taking connections from the java:DefaultDS datasource for a period</p></dd><dt><span class="term">Connection Pool Use</span></dt><dd><p>Generates server load by tieing up threads in the webserver connections pool for a period</p></dd><dt><span class="term">Heap Memory Pool Use</span></dt><dd><p>Generates server load by filling 50% of free heap memory for a period</p></dd><dt><span class="term">CPU Use</span></dt><dd><p>Generates server CPU load by initiating a tight loop in a thread</p></dd><dt><span class="term">Server Receive Traffic</span></dt><dd><p>Generates server traffic receipt load by POSTing a large byte array to the server once per second for a period</p></dd><dt><span class="term">Server Send Traffic</span></dt><dd><p>Generates server traffic send load by making a request once per second to which the server responds with a large byte array</p></dd><dt><span class="term">Request Count</span></dt><dd><p>Generates server load by making numerous requests, increasing the request count on the target server</p></dd></dl></div></li></ul></div></div><div xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="footnotes"><br/><hr/><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p><sup>[<a id="ftn.d0e3665" href="#d0e3665">1</a>] </sup>The demo's "Datasource Use" load generation scenario requires the use of JBoss Application Server.</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p><sup>[<a id="ftn.d0e3738" href="#d0e3738">2</a>] </sup>
                For purposes of this chart, a session is considered "active" if a client thread will ever again send a request associated with the session.
                When client threads stop using a session, they can either send a request to invalidate it or just abandon it by no longer including its session cookie in requests.
                After a session is abandoned, it will not be reflected in the "Session Balancing" chart, but it will continue to exist on the JBossWeb/Tomcat/JBoss AS server until it is removed due to timeout.
              </p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p><sup>[<a id="ftn.d0e3771" href="#d0e3771">3</a>] </sup>
              The default value for this field is controlled by the <code class="code">mod_cluster.proxy.host</code> system property, or localhost if not set.
              Editing the run-demo.sh or run-demo.bat file to change the <code class="code">-Dmod_cluster.proxy.host=localhost</code> passed to java will allow you to avoid re-typing this value every time you launch the demo application.
            </p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p><sup>[<a id="ftn.d0e3784" href="#d0e3784">4</a>] </sup>
              The default value for this field is controlled by the <code class="code">mod_cluster.proxy.port</code> system property, or 8000 if not set.
              Editing the run-demo.sh or run-demo.bat file to change the <code class="code">-Dmod_cluster.proxy.port=8000</code> passed to java will allow you to avoid re-typing this value every time you launch the demo application.
            </p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="changelog"/>Chapter 16. Change Log</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e3896">16.1. 1.2.6.Final (07 September 2013)</a></span></dt><dt><span class="section"><a href="#d0e3912">16.2. 1.2.5.Final (30 August 2013)</a></span></dt><dt><span class="section"><a href="#d0e4008">16.3. 1.2.4.Final (24 April 2013)</a></span></dt><dt><span class="section"><a href="#d0e4054">16.4. 1.2.3.Final (18 October 2012)</a></span></dt><dt><span class="section"><a href="#d0e4090">16.5. 1.2.2.Final (06 September 2012)</a></span></dt><dt><span class="section"><a href="#d0e4176">16.6. 1.2.1.Final (03 May 2012)</a></span></dt><dt><span class="section"><a href="#d0e4272">16.7. 1.2.0.Final (06 February 2012)</a></span></dt><dt><span class="section"><a href="#d0e4328">16.8. 1.2.0.Beta4 (26 January 2012)</a></span></dt><dt><span class="section"><a href="#d0e4444">16.9. 1.2.0.Beta3 (03 January 2012)</a></span></dt><dt><span class="section"><a href="#d0e4449">16.10. 1.2.0.Beta2 (11 December 2011)</a></span></dt><dt><span class="section"><a href="#d0e4465">16.11. 1.2.0.Beta1 (06 December 2011)</a></span></dt><dt><span class="section"><a href="#d0e4521">16.12. 1.1.3.Final (12 August 2011)</a></span></dt><dt><span class="section"><a href="#d0e4567">16.13. 1.1.2.Final (21 April 2011)</a></span></dt><dt><span class="section"><a href="#d0e4673">16.14. 1.1.1.Final (31 January 2011)</a></span></dt><dt><span class="section"><a href="#d0e4799">16.15. 1.1.0.Final (13 August 2010)</a></span></dt><dt><span class="section"><a href="#d0e4925">16.16. 1.1.0.CR3 (15 June 2010)</a></span></dt><dt><span class="section"><a href="#d0e5021">16.17. 1.1.0.CR2 (11 May 2010)</a></span></dt><dt><span class="section"><a href="#d0e5117">16.18. 1.1.0.CR1 (22 March 2010)</a></span></dt><dt><span class="section"><a href="#d0e5323">16.19. 1.1.0.Beta1 (30 October 2009)</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3896"/>16.1. 1.2.6.Final (07 September 2013)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-360 mod_proxy_cluster.h doesn't contain the right information</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3912"/>16.2. 1.2.5.Final (30 August 2013)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-334 mod_cluster core when use ProxyPass / balancer://bal and CreateBalancers 1</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-335 Regression in ProxyPass integration</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-339 "proxy: DNS lookup failure" with IPv6 on Solaris</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-345 http_handle_cping_cpong with EnableOptions and HTTPS connector</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-347 mod_cluster-manager may break up aliases from a single VirtualHost, causing a messy page</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-332 Add Engine.getExecutor() to container SPI</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>HTTP httpd-2.4.x doesn't like the extra CRLF.</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-349 mod_manager truncates ENABLE-APP messages.</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Fix ap_proxy_make_fake_req in 2.4.x</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4008"/>16.3. 1.2.4.Final (24 April 2013)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-315 Convert project to use i18n logging and exceptions</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-328 mod_cluster doesn't recognize ? as a proper context delimiter causing 503s on requests with query strings </p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>JBPAPP-9493 mod_cluster returns "Bad Gateway" HTTP ErrorCode 502 with https</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-326 rename NMAKEmakefile to NMAKEmakefile.example</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4054"/>16.4. 1.2.3.Final (18 October 2012)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>JBPAPP-9788 Tomcat with mod_cluster refuses to shut down</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>JBPAPP-10168 Option sessionDrainingStrategy in mod_cluster listener in tomcat causes an exception</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>JBPAPP-10147 The shutdown port of tomcat is released before performing actual shut down</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4090"/>16.5. 1.2.2.Final (06 September 2012)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>JBPAPP-9493 mod_cluster returns "Bad Gateway" HTTP ErrorCode 502 with https</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>JBPAPP-9791 mod_rewrite + mod_cluster: one kind of "proxying" RewriteRules don't work on Windows</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-224 when using tomcat manager webapp to stop/start an application the start is ignored by mod_cluster</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-322 Using AverageSystemLoadMetric can improperly cause a Load Factor of 0</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-312 port JBPAPP-8956 to 1.2.x</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-311 mod_manager doesn't handle multiple virtualhosts per node</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-309 mod_proxy_cluster not checking all available balancers (but only the first one) for an available route</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>JBPAPP-8957 Segmentation Faut when you run two or more JBoss Server Cluster behind *ONE* Apache Server on RHEL 6</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4176"/>16.6. 1.2.1.Final (03 May 2012)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-304 Port to httpd 2.4</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-305 ProxyPass can break StickySession</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-297 Warnings when compiling mod_cluster</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-192 Add SSL stuff in the FAQ</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-298 mod_cluster doesn't work with IPv6.</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-289 MemManagerFile creates directory but put files in ..</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-290 mod_cluster's mod_advertise can not start on IPv6-only box</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-279 mod_cluster returns 503s after STATUS</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>MODCLUSTER-281 Make stickySessionForce default to false in native part from 1.2.0 release</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4272"/>16.7. 1.2.0.Final (06 February 2012)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Fix CVE-2011-4608: Add EnableMCPMReceive in configuration. (JBPAPP-7708)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>mod_proxy code for old httpd versions needs to be updated. (MODCLUSTER-227)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Missing Documentation For mod_cluster with JBoss AS5. (MODCLUSTER-248)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>sticky-session-force change requires httpd restart. (MODCLUSTER-273)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>mod_cluster management console/Status does not show exact mod_cluster version. (MODCLUSTER-256)</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4328"/>16.8. 1.2.0.Beta4 (26 January 2012)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>read-attribute and :write-attribute Error in AS7. (MODCLUSTER-246)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>routing table lookup creates performance issues.. (MODCLUSTER-252)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Error 503 using mod_cluster: CVE-2011-3348. (MODCLUSTER-258)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>warning while compiling on some lab boxes. (MODCLUSTER-266)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>String index out of range: -1 with a lot of nodes/deploymentswarning while compiling on some lab boxes. (MODCLUSTER-266)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>404 while/just after removing a node. (MODCLUSTER-272)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>ProxyPass doesn't work with mod_cluster whne mixing mod_cluster and other scheme handlers404 while/just after removing a node. (MODCLUSTER-274)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>mod_cluster forgets removed node too fast. (MODCLUSTER-231)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>Allow context lengths greater than 40 (MODCLUSTER-236)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>Increase the MAXMESSSIZE and allow it to be configurable via a parameter. (MODCLUSTER-244)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>Calculate the MAXMESSSIZE dynamically. (MODCLUSTER-245)</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4444"/>16.9. 1.2.0.Beta3 (03 January 2012)</h2></div></div></div><p>Code reorganisation</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4449"/>16.10. 1.2.0.Beta2 (11 December 2011)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Load-demo application does not work with AS7. (MODCLUSTER-259)</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4465"/>16.11. 1.2.0.Beta1 (06 December 2011)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Modify jbossweb metrics to use service provider spi, instead of jmx. (MODCLUSTER-151)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>mod_cluster throws warnings at shutdown in AS7. (MODCLUSTER-143)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>Refactor mod_cluster to allow implementations for other application servers. (MODCLUSTER-105)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>AS7 integration. (MODCLUSTER-219)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>Refactor project into modules for HA, catalina, core, etc. (MODCLUSTER-112)</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4521"/>16.12. 1.1.3.Final (12 August 2011)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>request hang with a node is stopped in EC2 (MODCLUSTER-217) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Extra ENABLE-APP/REMOVE-APP event after failover (MODCLUSTER-220) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>mod_cluster does not work with Tomcat 7 due to API Change in Connector (MODCLUSTER-240) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>kill -HUP httpd process increase the number of open locks (MODCLUSTER-241) (jfclere)</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4567"/>16.13. 1.1.2.Final (21 April 2011)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>mod_cluster failover does not work for a /webappcontext when the / root context exists (MODCLUSTER-188) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>UseAlias broken (MODCLUSTER-212) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>mod_rewrite PT doesn't work (MODCLUSTER-213) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>memory usage growning in httpd (MODCLUSTER-214) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Second attempt to connect from Jboss to apache module sends incomplete Host Header (MODCLUSTER-216) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>when using tomcat manager webapp to stop/start an application the start is ignored by mod_cluster (MODCLUSTER-224) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Unable to override load properties when running in Tomcat 6 (MODCLUSTER-232) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Documentation contains wrong default loadMetric class name (MODCLUSTER-233) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>mod_cluster should issue a warning when Maxcontext is reached and no more context will be taken (MODCLUSTER-223) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>add a note explaining where Maxcontext must be put in httpd.conf and issue error if in wrong location (MODCLUSTER-225) (jfclere)</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4673"/>16.14. 1.1.1.Final (31 January 2011)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>NPE when overriding default load metric in ModClusterListener (MODCLUSTER-183) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>mod_cluster failover does not work for a /webappcontext when the / root context exists (MODCLUSTER-188) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>mod_cluster issues an ENABLE-APP too early in the webapp lifecycle (MODCLUSTER-190) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>mod_cluster 1.1.0 docs step 11.1.4.3 is wrong (MODCLUSTER-193) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Incorrect routing of requests when one context root is the prefix of another (MODCLUSTER-196) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Can only rewrite from the root context in httpd if there is a root context deployed in JBoss (MODCLUSTER-198) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>the STATUS MCMP message is send before the connector is started (MODCLUSTER-202) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>The windoze bundle don't have the default configuration (MODCLUSTER-205) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>httpd cores after graceful restart after the mod_cluster configuration is added (MODCLUSTER-206) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>Make logging on Tomcat use JDK14LoggerPlugin by default (MODCLUSTER-185) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>update mod_cluster to use HTTP/1.1 (MODCLUSTER-201) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>Add support for system properties used in 1.0.x (MODCLUSTER-207) (pferraro)</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4799"/>16.15. 1.1.0.Final (13 August 2010)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Demo servlets throw InstanceNotFoundException against EAP5 (MODCLUSTER-170) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>mod_advertise: Invalid ServerAdvertise Address too often (MODCLUSTER-172) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Fix class name of MBeanAttributeRatioLoadMetric in MC config (MODCLUSTER-174) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Wrong configuration could cause an httpd core (MODCLUSTER-175) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Advertise not configured error message in log is actually a warning (MODCLUSTER-176) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>Better no servers connected message (MODCLUSTER-165) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>How does the UI deal with 20 or more servers (MODCLUSTER-165) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>mod_cluster should use hostname provided in address instead a IP address (MODCLUSTER-168) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>Read only view of mod_cluster-manager (MODCLUSTER-181) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Demo client throws Bus Error when run with JDK 1.6 on OSX (MODCLUSTER-169) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Use versioned docs (MODCLUSTER-141) (jfclere, pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>Deprecate use of term "domain" (MODCLUSTER-177) (jfclere, pferraro)</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4925"/>16.16. 1.1.0.CR3 (15 June 2010)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Rpc failure can lead to failure to deploy a webapp (MODCLUSTER-140) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Quotes in jsessionId causing sticky sessions to fail (MODCLUSTER-146) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>ManagerBalancerName doesn't work (MODCLUSTER-153) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Parsing of IPv6 loopback address fails (MODCLUSTER-156) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>SystemMemoryUsageLoadMetric returns wrong load metric (MODCLUSTER-157) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Clean shutdown logic can still inadvertently kill requests for non-distributed contexts. (MODCLUSTER-159) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>NoClassDefFoundError running demo app against AS6 (MODCLUSTER-161) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Allow override of default clean shutdown behavior (MODCLUSTER-139) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Avoid unnecessary open sockets for non-master nodes (MODCLUSTER-158) (pferraro)</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5021"/>16.17. 1.1.0.CR2 (11 May 2010)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Add the lifecycle listener dynamically (MODCLUSTER-20) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Use UUID for auto-generated jvmRoute (MODCLUSTER-142) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>improve packaging so that the bundle can run in ~ too (MODCLUSTER-150) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>jboss.mod_cluster.proxyList: invalid hosts cause mod-cluster startup to be delayed (MODCLUSTER-155) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>mod_cluster 1.1.0.CR1 doesn't work with Tomcat (MODCLUSTER-143) (jfclere/pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Allow configuration of stopContextTimeout units (MODCLUSTER-138) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Add a solaris10 64 bits sparc in the bundles (MODCLUSTER-137) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>INFO and mod_cluster_manager/ displays milliseconds and DUMP second (MODCLUSTER-128) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Make mod_cluster manager tolerant to F5 page refresh when disabled context (MODCLUSTER-124) (jfclere)</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5117"/>16.18. 1.1.0.CR1 (22 March 2010)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Update httpd to 2.2.25. (MODCLUSTER-134) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Apache with mod_cluster refuses to start at first, but after 7 retries it starts up (MODCLUSTER-120) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Add getLoad() to load metric mbean interface (MODCLUSTER-130) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Disable "cnone" request parameter to ease remote invocation on mod_cluster-manager (MODCLUSTER-127) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Microcontainer does not always choose the right constructor when creating ModClusterService (MODCLUSTER-116) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Microcontainer does not choose the right constructor when creating RequestCountLoadMetric (MODCLUSTER-126) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Mod_cluster does support more that 3 Alias in &lt;Host/&gt; (MODCLUSTER-121) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Allow toggling of context auto-enable during mod_cluster startup. (MODCLUSTER-125) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>STATUS should retry the worker even if there was an error before. (MODCLUSTER-133) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Split ModClusterServiceMBean.ping(String) into 3 methods (MODCLUSTER-110) (pferraro/jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Use clean shutdown by default, leveraging STOP-APP-RSP for &lt;distributable/&gt; contexts and session draining for non-distributable contexts.  mod_cluster shutdown now triggered earlier via Connector JMX notification.  (MODCLUSTER-131) (pferraro/jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>move the web site to magnolia (MODCLUSTER-114) (.org team)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>ping and nodeTimeout interact. (MODCLUSTER-132) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>update mod_jk to 1.2.30  (MODCLUSTER-138) (jfclere) </p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>query string is truncated to (MODCLUSTER-118) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>AdvertiseBindAddress does not default to the 23364 port (MODCLUSTER-119) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Skip load balance factor calculation if there are no proxies to receive status message (MODCLUSTER-103) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Disabling contexts does not work (MODCLUSTER-123) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>advertise doesn't use new AdvertiseSecurityKey on graceful restarts. (MODCLUSTER-129) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Load-demo.war specifies obsolete servlet in web.xml  (MODCLUSTER-113) (pferraro)</p>
            </td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5323"/>16.19. 1.1.0.Beta1 (30 October 2009)</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Interaction with mod_rewrite looks weird for end-users. (MODCLUSTER-86) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>admin-console should be in the excludedContexts. (MODCLUSTER-87) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>ClassCastException upon redeploy after mod-cluster-jboss-beans.xml modification. (MODCLUSTER-88) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Alias from webapps/jboss-web.xml are not handled correctly in mod_cluster. (MODCLUSTER-89) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Display version. (MODCLUSTER-90) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Connector bind address of 0.0.0.0 propagated to proxy. (MODCLUSTER-91) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Display status of the worker. (MODCLUSTER-92) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Update httpd to lastest version. (MODCLUSTER-93) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>getProxyInfo failed when there are too many nodes. (MODCLUSTER-94) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>mod_cluster-manager display corrupted with jboss starting. (MODCLUSTER-95) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>DISABLE application active as STOPPED. (MODCLUSTER-96) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Httpd should remove workers it can't ping. (MODCLUSTER-97) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Linux mod_cluster_manager display zero instead values. (MODCLUSTER-98) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>mod_cluster_manager doesn't seem to ENABLE/DISABLE the right context. (MODCLUSTER-99) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>load balancing logic doesn't allow manual demo of load-balancing. (MODCLUSTER-100) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>404 errors when load is increasing. (MODCLUSTER-102) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/fix.jpg" align="middle"/></div></td><td>
              <p>Advertise security key verification does not work. (MODCLUSTER-104) (jfclere)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>Allow advertise listener to listen on a specific network interface. (MODCLUSTER-106) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/add.jpg" align="middle"/></div></td><td>
              <p>Allow thread factory injection for advertise listener. (MODCLUSTER-108) (pferraro)</p>
            </td></tr><tr><td><div class="mediaobject" align="center"><img src="images/update.jpg" align="middle"/></div></td><td>
              <p>Create SPI and isolate tomcat/jbossweb usage into service provider implementation. (MODCLUSTER-111) (pferraro)</p>
            </td></tr></tbody></table></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="faq"/>Chapter 17. Frequently Asked questions</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#advertisemessage">17.1. What is Advertise</a></span></dt><dt><span class="section"><a href="#d0e5551">17.2. What to do if I don't want to use Advertise (multicast):</a></span></dt><dt><span class="section"><a href="#d0e5566">17.3. I am using Tomcat 7 / 6 what should I do:</a></span></dt><dt><span class="section"><a href="#d0e5574">17.4. It is not working what should I do:</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5579">17.4.1. No error</a></span></dt><dt><span class="section"><a href="#d0e5630">17.4.2. Error in server.log or catalina.out</a></span></dt><dt><span class="section"><a href="#d0e5656">17.4.3. Error in error_log</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5671">17.5. I have "HTTP/1.1 501 Method Not Implemented"</a></span></dt><dt><span class="section"><a href="#d0e5681">17.6. Redirect is not working:</a></span></dt><dt><span class="section"><a href="#d0e5689">17.7. I have more than one Connector mod_cluster does use the right one</a></span></dt><dt><span class="section"><a href="#d0e5700">17.8. Chrome can't diplay /mod_cluster_manager page</a></span></dt><dt><span class="section"><a href="#d0e5711">17.9. Using mod_cluster and SELinux.</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="advertisemessage"/>17.1. What is Advertise</h2></div></div></div><p>
      Advertise allows autodiscovery of httpd proxies by the cluster nodes.
      It is done by sending multicast messages from httpd to the cluster.
      The httpd specialized module: mod_advertise sends UDP message on a multicast group,
      both mod_advertise and the cluster listener joined the multicast group and the cluster receives the messages.
    </p><p>Example for mod_advertise message:</p><pre class="programlisting">HTTP/1.0 200 OK
Date: Wed, 08 Apr 2009 12:26:32 GMT
Sequence: 16
Digest: f2d5f806a53effa6c67973d2ddcdd233
Server: 1b60092e-76f3-49fd-9f99-a51c69c89e2d
X-Manager-Address: 127.0.0.1:6666
X-Manager-Url: /bla
X-Manager-Protocol: http
X-Manager-Host: 10.33.144.3</pre><p>
      The X-Manager-Address header value is used by the cluster logic to send information about the cluster to the proxy.
      It is the IP and port of the VirtualHost where mod_advertise is configured or URL parameter of the ServerAdvertise directive.
    </p><p>
      See <a href="#advertise">Proxy Discovery</a> in Configuration Properties and <a href="#mod_advertise" title="3.6. mod_advertise">mod_advertise</a> in Apache httpd configuration.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5551"/>17.2. What to do if I don't want to use Advertise (multicast):</h2></div></div></div><p>In the VirtualHost receiving the MCPM of httpd.conf don't use any Advertise directive or use:</p><pre class="programlisting">ServerAdvertise Off</pre><p>
      In mod_cluster-jboss-beans.xml add the addresses and ports of the VirtualHost to the proxyList property and set advertise to false, for example:
    </p><pre class="programlisting">&lt;property name="proxyList"&gt;10.33.144.3:6666,10.33.144.1:6666&lt;/property&gt;
&lt;property name="advertise"&gt;false&lt;/property&gt;</pre><p>In server.xml (with JBossweb/Tomcat) </p><pre class="programlisting">&lt;Listener className="org.jboss.modcluster.container.catalina.standalone.ModClusterListener" advertise="true"/&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5566"/>17.3. I am using Tomcat 7 / 6 what should I do:</h2></div></div></div><p>
      See at the end of <a href="#java.config" title="Chapter 6. Server-side Configuration">java configuration</a>.
      You can't use the mod_cluster clustered mode with Tomcat so you get a loadbalancing logic similar to mod_jk but with a dynamic configuration.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5574"/>17.4. It is not working what should I do:</h2></div></div></div><p>
      Most likely you have a configuration problem.
      Check the log of the cluster nodes and error_log of httpd.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5579"/>17.4.1. No error</h3></div></div></div><p>
        That happens when Advertise is not working: The nodes don't get the <a href="#advertisemessage" title="17.1. What is Advertise">advertise messages</a> from httpd.
      </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
            Check the modules are loaded and Advertise is started.
            In httpd.conf activate extended information display, add:
          </p><pre class="programlisting">AllowDisplay On</pre><p>
            When accessing to the <a href="#SetHandlermod_cluster-manager" title="3.5.14. SetHandler mod_cluster-manager">mod_cluster_manager</a> you should get something like:
          </p><div class="mediaobject" align="center"><img src="images/mod_status_ext.jpg" align="middle"/></div><p>
            If not, go to the <a href="#MinimalExample" title="3.7. Minimal Example">Minimal Example</a> and add the missing directive(s).
          </p></li><li><p>
            Check that Advertise message are received on the cluster node.
            A <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://github.com/modcluster/mod_cluster/blob/master/test/java/Advertize.java">small Java</a> utility could be used to check Advertise.
            It is in the mod_cluster repository and can be compiled using javac.
            A compiled version can be found under in /opt/jboss/httpd/tools in the bundles.
            Run it using java Advertise multicastaddress port.
            The output should be something like:
          </p><pre class="programlisting">[jfclere@jfcpc java]$ java Advertize 224.0.1.105 23364
ready waiting...
received: HTTP/1.0 200 OK
Date: Mon, 28 Jun 2010 07:30:31 GMT
Sequence: 1
Digest: df8a4321fa99e5098174634f2fe2f87c
Server: 1403c3be-837a-4e76-85b1-9dfe5ddb4378
X-Manager-Address: test.example.com:6666
X-Manager-Url: /1403c3be-837a-4e76-85b1-9dfe5ddb4378
X-Manager-Protocol: http
X-Manager-Host: test.example.com</pre></li><li><p>No Advertise messages</p><p>
            Check firewall (don't forget the boxes firewall).
            Advertise uses UDP port 23364 and multicast addresse 224.0.1.105
          </p></li><li><p>Can't get Advertise messages</p><p>
            Use ProxyList property.
            In case Advertise can't work you put the address and port of the VirtualHost used in httpd to receive the MCMP.
            In server/profile/deploy/mod_cluster.sar/META-INF/mod_cluster-jboss-beans.xml
          </p><pre class="programlisting">&lt;property name="proxyList"&gt;test.example.com:6666&lt;/property&gt;</pre><p>or in server.xml:</p><pre class="programlisting">&lt;Listener className="org.jboss.modcluster.container.catalina.standalone.ModClusterListener" proxyList="test.example.com:6666"/&gt;</pre></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5630"/>17.4.2. Error in server.log or catalina.out</h3></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>"IO error sending command ":</p><p>
            Check firewall and error_log if there is nothing error_log then it is a firewall problem.
            If you have something like:
          </p><pre class="programlisting">18:36:14,533 INFO  [DefaultMCMPHandler] IO error sending command INFO to proxy jfcpc/10.33.144.3:8888</pre><p>
            You can use telnet hostname/address port to check by hands that it is OK for example:
          </p><pre class="programlisting">[jfclere@jfcpc docs]$ telnet 10.33.144.3 8888
Trying 10.33.144.3...
Connected to jfcpc.
Escape character is '^]'.
GET /
&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;Connection closed by foreign host.</pre><p>
            Check that the address and port are the expected ones you may use ServerAdvertise On http://hostname:port, like:
          </p><pre class="programlisting">ServerAdvertise On http://localhost:6666</pre><p>
            Or use the servlet testhttpd in the testhttpd.war of the bundle (in /opt/jboss/httpd/tools).
            Install/deploy it in in the node and start the AS/Tomcat on the node, than access to the node directly and call /testhttpd/testhttpd 
          </p><div class="mediaobject" align="center"><img src="images/testhttpd.jpg" align="middle"/></div><p>
            If you don't get a similar page the output should help to find that is wrong.
          </p></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5656"/>17.4.3. Error in error_log</h3></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>"client denied by server configuration":</p><p>
            The directory in the VirtualHost is not allowed for the client.
            If you have something like:
          </p><pre class="programlisting">Mon Jun 28 18:08:47 2010] [error] [client 10.33.144.3] client denied by server configuration: /</pre><p>
            You need to have something like:
          </p><pre class="programlisting">&lt;Directory /&gt;
  Order deny,allow
  Deny from all
  Allow from 10.33.144.3
&lt;/Directory&gt;</pre></li></ol></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5671"/>17.5. I have "HTTP/1.1 501 Method Not Implemented"</h2></div></div></div><p>You need to configure <a href="#EnableMCPMReceive" title="3.5.1. EnableMCPMReceive">EnableMCPMReceive</a> in
      the VirtualHost where you received the MCMP elements in the Apache httpd configuration.
      Something like:
    </p><pre class="programlisting">
&lt;VirtualHost localhost:6666&gt;
    &lt;Directory /&gt;
     Order deny,allow
     Deny from all
     Allow from 127.0.0.1
    &lt;/Directory&gt;
    ServerAdvertise on http://localhost:6666
    EnableMCPMReceive
&lt;/VirtualHost&gt;
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5681"/>17.6. Redirect is not working:</h2></div></div></div><p>
      When using http/https instead AJP proxyname, proxyhost and redirect must be configured in the Connector.
      Something like:
      </p><pre class="programlisting">    &lt;Connector port="8080" protocol="HTTP/1.1" 
               connectionTimeout="20000"
               proxyName="httpd_host_name"
               proxyPort="8000"
               redirectPort="443" /&gt;</pre><p>
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5689"/>17.7. I have more than one Connector mod_cluster does use the right one</h2></div></div></div><p>
      Mod_cluster tries to use the first AJP connector configured. If there isn't any AJP connector
      it uses the http or https that has the biggest maxthreads value. That is "maxThreads" in Tomcat and JBossAS4/5/6:
      </p><pre class="programlisting">    &lt;Connector port="8080" protocol="HTTP/1.1" maxThreads="201" /&gt;</pre><p>
      Or "max-connections" in AS7: (32 * processor + 1 for native and 512 * processor + 1 for JIO).
      </p><pre class="programlisting">    &lt;connector name="http" protocol="HTTP/1.1" scheme="http" socket-binding="http" max-connections="513" /&gt;</pre><p>
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5700"/>17.8. Chrome can't diplay /mod_cluster_manager page</h2></div></div></div><p>
      When using chrome with mod_cluster_manager the page is not displayed and the following error is displayed:
      </p><pre class="programlisting"> Error 312 (net::ERR_UNSAFE_PORT): Unknown error. </pre><p>
      you can change the port of the VirtualHost to 7777 or any value chrome accepts or
      add:
      </p><pre class="programlisting"> --explicitly-allowed-ports=6666 </pre><p> to the start parameters of chrome.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5711"/>17.9. Using mod_cluster and SELinux.</h2></div></div></div><p>
     Mod_cluster needs to open port and create shared memory and files, therefore some permissions
     have to be added, you need to configure something like:
</p><pre class="programlisting">
policy_module(mod_cluster, 1.0)

require {
        type unconfined_java_t;
        type httpd_log_t;
        type httpd_t;
        type http_port_t;
        class udp_socket node_bind;
        class file write;
}

#============= httpd_t ==============

allow httpd_t httpd_log_t:file write;
corenet_tcp_bind_generic_port(httpd_t)
corenet_tcp_bind_soundd_port(httpd_t)
corenet_udp_bind_generic_port(httpd_t)
corenet_udp_bind_http_port(httpd_t)

#============= unconfined_java_t ==============
allow unconfined_java_t http_port_t:udp_socket node_bind;
</pre><p>
     Put the above in a file for example mod_cluster.te and generate the mod_cluster.pp file (for example in Fedora 16):
</p><pre class="programlisting">
[jfclere@jfcpc docs]$ make -f /usr/share/selinux/devel/Makefile
Compiling targeted mod_cluster module
/usr/bin/checkmodule:  loading policy configuration from tmp/mod_cluster.tmp
/usr/bin/checkmodule:  policy configuration loaded
/usr/bin/checkmodule:  writing binary representation (version 14) to tmp/mod_cluster.mod
Creating targeted mod_cluster.pp policy package
rm tmp/mod_cluster.mod.fc tmp/mod_cluster.mod
</pre><p>
     The mod_cluster.pp file should be proceeded by semodule as root:
</p><pre class="programlisting">
root@jfcpc docs]# semodule -i mod_cluster.pp
[root@jfcpc docs]# 
</pre><p>
    </p></div></div></div></body></html>