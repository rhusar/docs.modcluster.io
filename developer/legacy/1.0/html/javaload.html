<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 9. Load Metrics</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="Mod_cluster doc"/><link rel="up" href="index.html" title="Mod_cluster doc"/><link rel="prev" href="javaproperties.html" title="Chapter 8. java properties"/><link rel="next" href="javainstall.html" title="Chapter 10. Installation of the java part"/></head><body><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="javaproperties.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="javainstall.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="javaload"/>Chapter 9. Load Metrics</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="javaload.html#d0e1816">9.1. Server-Side Load Metrics</a></span></dt><dt><span class="sect1"><a href="javaload.html#d0e1883">9.2. Web Container metrics</a></span></dt><dt><span class="sect1"><a href="javaload.html#d0e2051">9.3. System/JVM metrics</a></span></dt><dt><span class="sect1"><a href="javaload.html#d0e2121">9.4. Other metrics</a></span></dt></dl></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1816"/>9.1. Server-Side Load Metrics</h2></div></div></div><p>A major feature of mod_cluster is the ability to use server-side
    load metrics to determine how best to balance requests.</p><p>The DynamicLoadBalanceFactorProvider bean computes the load balance
    factor of a node from a defined set of load metrics.</p><pre class="programlisting"><p>&lt;bean name="DynamicLoadBalanceFactorProvider" class="org.jboss.modcluster.load.impl.DynamicLoadBalanceFactorProvider" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=LoadBalanceFactorProvider",exposedInterface=org.jboss.modcluster.load.impl.DynamicLoadBalanceFactorProviderMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter&gt;</p><p>      &lt;set elementClass="org.jboss.modcluster.load.metric.LoadMetric"&gt;</p><p>        &lt;inject bean="BusyConnectorsLoadMetric"/&gt;</p><p>        &lt;inject bean="HeapMemoryUsageLoadMetric"/&gt;</p><p>      &lt;/set&gt;</p><p>    &lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>  &lt;property name="history"&gt;9&lt;/property&gt;</p><p>  &lt;property name="decayFactor"&gt;2&lt;/property&gt;</p><p>&lt;/bean&gt;</p></pre><p>Load metrics can be configured with an associated weight and
    capacity:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>The weight (default is 1) indicates the significance of a metric
        with respect to the other metrics. For example, a metric of weight 2
        will have twice the impact on the overall load factor than a metric of
        weight 1.</p></li><li><p>The capacity of a metric serves 2 functions:</p></li></ol></div><p>Each load metric contributes a value to the overall load factor of a
    node. The load factors from each metric are aggregated according to their
    weights.</p><p>In general, the load factor contribution of given metric is: (load /
    capacity) * weight / total weight.</p><p>The DynamicLoadBalanceFactorProvider applies a time decay function
    to the loads returned by each metric. The aggregate load, with respect to
    previous load values, can be expressed by the following formula:</p><p>    L = (L0 + L1/D + L2/D2 + L3/D3 + ... + LH/DH) * (1 + D + D2 + D3
    + ... DH)</p><p>... or more concisely as:</p><p>    H         H</p><p>L = ∑ Li/Di *  ∑ Di</p><p>   i=0       i=0</p><p>... where D = decayFactor and H = history.</p><p>Setting history = 0 effectively disables the time decay function and
    only the current load for each metric will be considered in the load
    balance factor computation.</p><p>The mod_cluster proxy module expects the load factor to be an
    integer between 0 and 100, where 0 indicates max load and 100 indicates
    zero load. Therefore, the final load balance factor sent to the proxy =
    100 - (L * 100).</p><p>While you are free to write your own load metrics, the following
    LoadMetrics are available out of the box:</p></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1883"/>9.2. Web Container metrics</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>ActiveSessionsLoadMetric</p><p> * Requires an explicit capacity</p><p> * Uses SessionLoadMetricSource to query session managers</p><p> * Analogous to method=S in mod_jk </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="ActiveSessionsLoadMetric" class="org.jboss.modcluster.load.metric.impl.ActiveSessionsLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=ActiveSessionsLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter&gt;&lt;inject bean="SessionLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>  &lt;property name="capacity"&gt;1000&lt;/property&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean name="SessionLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.SessionLoadMetricSource" mode="On Demand"&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="javax.management.MBeanServer"&gt;&lt;inject bean="JMXKernel" property="mbeanServer"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p></pre></li><li><p>BusyConnectorsLoadMetric</p><p> * Returns the percentage of connector threads from the thread
        pool that are busy servicing requests</p><p> * Uses ThreadPoolLoadMetricSource to query connector thread
        pools</p><p> * Analogous to method=B in mod_jk </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="BusyConnectorsLoadMetric" class="org.jboss.modcluster.load.metric.impl.BusyConnectorsLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=BusyConnectorsLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter&gt;&lt;inject bean="ThreadPoolLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean name="ThreadPoolLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.ThreadPoolLoadMetricSource" mode="On Demand"&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="javax.management.MBeanServer"&gt;&lt;inject bean="JMXKernel" property="mbeanServer"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p></pre></li><li><p>ReceiveTrafficLoadMetric</p><p> * Returns the incoming request traffic in KB/sec</p><p> * Requires an explicit capacity</p><p> * Uses RequestProcessorLoadMetricSource to query request
        processors</p><p> * Analogous to method=T in mod_jk </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="ReceiveTrafficLoadMetric" class="org.jboss.modcluster.load.metric.impl.ReceiveTrafficLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=ReceiveTrafficLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource"&gt;&lt;inject bean="RequestProcessorLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>  &lt;property name="capacity"&gt;1024&lt;/property&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean name="RequestProcessorLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource" mode="On Demand"&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="javax.management.MBeanServer"&gt;&lt;inject bean="JMXKernel" property="mbeanServer"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p></pre></li><li><p>SendTrafficLoadMetric</p><p> * Returns the outgoing request traffic in KB/sec</p><p> * Requires an explicit capacity</p><p> * Uses RequestProcessorLoadMetricSource to query request
        processors</p><p> * Analogous to method=T in mod_jk </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="SendTrafficLoadMetric" class="org.jboss.modcluster.load.metric.impl.SendTrafficLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=SendTrafficLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource"&gt;&lt;inject bean="RequestProcessorLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>  &lt;property name="capacity"&gt;512&lt;/property&gt;</p><p>&lt;/bean&gt;</p></pre></li><li><p>RequestCountLoadMetric</p><p> * Returns the number of requests/sec</p><p> * Requires an explicit capacity</p><p> * Uses RequestProcessorLoadMetricSource to query request
        processors</p><p> * Analogous to method=R in mod_jk </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="RequestCountLoadMetric" class="org.jboss.modcluster.load.metric.impl.RequestCountLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=RequestCountLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource"&gt;&lt;inject bean="RequestProcessorLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>  &lt;property name="capacity"&gt;1000&lt;/property&gt;</p><p>&lt;/bean&gt;</p></pre></li></ol></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2051"/>9.3. System/JVM metrics</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>AverageSystemLoadMetric</p><p> * Returns CPU load</p><p> * Requires Java 1.6+.</p><p> * Uses OperatingSystemLoadMetricSource to generically read
        attributes </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="AverageSystemLoadMetric" class="org.jboss.modcluster.load.metric.impl.AverageSystemLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=AverageSystemLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter&gt;&lt;inject bean="OperatingSystemLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean name="OperatingSystemLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.OperatingSystemLoadMetricSource" mode="On Demand"&gt;</p><p>&lt;/bean&gt;</p></pre></li><li><p>SystemMemoryUsageLoadMetric</p><p> * Returns system memory usage</p><p> * Requires com.sun.management.OperatingSystemMXBean (available
        in Sun's JDK or OpenJDK)</p><p> * Uses OperatingSystemLoadMetricSource to generically read
        attributes </p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="SystemMemoryUsageLoadMetric" class="org.jboss.modcluster.load.metric.impl.SystemMemoryUsageLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=SystemMemoryUsageLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter&gt;&lt;inject bean="OperatingSystemLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p></pre></li><li><p>HeapMemoryUsageLoadMetric</p><p>* Returns the heap memory usage as a percentage of max heap
        size</p><p>e.g.</p><pre class="programlisting"><p>&lt;bean name="HeapMemoryUsageLoadMetric" class="org.jboss.modcluster.load.metric.impl.HeapMemoryUsageLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=HeapMemoryUsageLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>&lt;/bean&gt;</p></pre></li></ol></div></div><div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2121"/>9.4. Other metrics</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>ConnectionPoolUsageLoadMetric</p><p> * Returns the percentage of connections from a connection pool
        that are in use.</p><p> * Uses ConnectionPoolLoadMetricSource to query JCA connection
        pools </p><p>e.g.</p></li></ol></div><pre class="programlisting"><p>&lt;bean name="ConnectionPoolUsageMetric" class="org.jboss.modcluster.load.metric.impl.ConnectionPoolUsageLoadMetric" mode="On Demand"&gt;</p><p>  &lt;annotation&gt;@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.web:service=ConnectionPoolUsageLoadMetric",exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)&lt;/annotation&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter&gt;&lt;inject bean="ConnectionPoolLoadMetricSource"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean name="ConnectionPoolLoadMetricSource" class="org.jboss.modcluster.load.metric.impl.ConnectionPoolLoadMetricSource" mode="On Demand"&gt;</p><p>  &lt;constructor&gt;</p><p>    &lt;parameter class="javax.management.MBeanServer"&gt;&lt;inject bean="JMXKernel" property="mbeanServer"/&gt;&lt;/parameter&gt;</p><p>  &lt;/constructor&gt;</p><p>&lt;/bean&gt;</p></pre></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="javaproperties.html"><strong>Prev</strong>Chapter 8. java properties</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="javainstall.html"><strong>Next</strong>Chapter 10. Installation of the java part</a></li></ul></body></html>